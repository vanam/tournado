import{S as A,C as be,a as ve,D as we,b as We}from"./ConfirmModal-p4Kc4V--.js";import{r as P,j as p}from"./react-vendor-DmXkgcPG.js";import{c as E,b as Ae,u as Ne,D as ee,B as R}from"./index-lbt8OJ0v.js";import{l as re,m as ie,n as Me}from"./radix-ui-BYwnsWBt.js";import{b as Te}from"./icons-CuKFc0l-.js";function z(e=0){let n=e;return{nextId(t=""){return n+=1,t+String(n)},reset(){n=e}}}function D(e,n={}){return{id:e,player1Id:null,player2Id:null,scores:[],winnerId:null,walkover:!1,nextMatchId:null,dummy:!1,...n}}function Re(e){let n=1;for(;n<e;)n*=2;return n}function j(e){return e?.dummy??!1}function De(e){if(e===1)return[0];const n=Array.from({length:e}),t=e/2,s=[];for(let o=1;o<=t;o+=2)s.push(o);for(let o=2;o<=t;o+=2)s.push(o);for(const[o,r]of s.entries()){const i=r-1,a=e-r;n[i]=o*2,n[a]=o*2+1}return n}const ne=z();function ke(e,n,t){const s=Array.from({length:n},()=>null);for(let o=0;o<n;o++){const r=t[o];if(r!==void 0&&o<e.length){const i=e[o];i&&(s[r]=i.id)}}return s}function Pe(e,n){const t=[];for(let s=0;s<e.length;s+=2){const o=e[s]??null,r=e[s+1]??null;t.push(D(n(),{player1Id:o,player2Id:r,position:s/2}))}return t}function He(e){for(const n of e)n.player1Id&&!n.player2Id?n.winnerId=n.player1Id:!n.player1Id&&n.player2Id&&(n.winnerId=n.player2Id)}function je(e,n,t){for(let s=1;s<n;s++){const o=e[s-1];if(!o)continue;const r=[];for(let i=0;i<o.length;i+=2){const a=o[i],d=o[i+1];if(!a||!d)continue;const l=D(t(),{player1Id:a.winnerId??null,player2Id:d.winnerId??null,position:i/2});a.nextMatchId=l.id,d.nextMatchId=l.id;const c=!!a.winnerId||!a.player1Id&&!a.player2Id,f=!!d.winnerId||!d.player1Id&&!d.player2Id;c&&f&&(l.player1Id&&!l.player2Id?l.winnerId=l.player1Id:!l.player1Id&&l.player2Id&&(l.winnerId=l.player2Id)),r.push(l)}e.push(r)}}function Le(e,n){return e>=2?D(n()):null}function Wn(e){ne.reset();const n=e.length,t=Re(n),s=Math.log2(t),o=De(t),r=()=>ne.nextId("m"),i=ke(e,t,o),a=[],d=Pe(i,r);He(d),a.push(d),je(a,s,r);const l=Le(s,r);return{rounds:a,thirdPlaceMatch:l}}function Ce(e,n){let t=0;for(const s of e){const o=s.find(r=>r.id===n)??null;if(o)return{match:o,roundIndex:t};t++}return{match:null,roundIndex:-1}}function te(e,n,t,s){e.winnerId=n,e.scores=t,e.walkover=s}function Fe(e,n,t,s){const o=e.rounds.length-2;if(e.thirdPlaceMatch&&s===o){const r=n.player1Id===t?n.player2Id:n.player1Id;n.position===0?e.thirdPlaceMatch.player1Id=r:e.thirdPlaceMatch.player2Id=r}}function Be(e,n){if(!n)return null;for(const[t,s]of e.entries()){const o=s.find(r=>r.id===n&&!j(r));if(o)return{match:o,roundIndex:t}}return null}function Oe(e,n){return e.filter(s=>!j(s)).findIndex(s=>s.id===n)}function Ee(e,n,t){n%2===0?e.player1Id=t:e.player2Id=t}function _e(e,n,t){const s=n.filter(l=>!j(l)),o=Math.floor(t/2)*2,r=s[o],i=s[o+1],a=!r||!!r.winnerId||!r.player1Id&&!r.player2Id,d=!i||!!i.winnerId||!i.player1Id&&!i.player2Id;a&&d&&(e.player1Id&&!e.player2Id?e.winnerId=e.player1Id:!e.player1Id&&e.player2Id&&(e.winnerId=e.player2Id))}function ze(e,n,t){const s=e.rounds;let o=n,r=t;for(;o.nextMatchId;){const i=Be(s,o.nextMatchId);if(!i||i.roundIndex<=r)break;const a=i.match,d=i.roundIndex,l=s[d-1];if(!l)break;const c=Oe(l,o.id);if(c===-1||(Ee(a,c,o.winnerId),_e(a,l,c),!a.winnerId))break;o=a,r=d}}function An(e,n,t,s,o=!1){if(n===e.thirdPlaceMatch?.id)return te(e.thirdPlaceMatch,t,s,o),e;const{match:r,roundIndex:i}=Ce(e.rounds,n);return r&&(te(r,t,s,o),Fe(e,r,t,i),ze(e,r,i)),e}function Nn(e,n){if(n===e.thirdPlaceMatch?.id)return!!(e.thirdPlaceMatch.player1Id&&e.thirdPlaceMatch.player2Id);for(let t=0;t<e.rounds.length;t++){const s=e.rounds[t];if(!s)continue;const o=s.find(r=>r.id===n);if(o){if(!o.nextMatchId)return!0;for(let r=t+1;r<e.rounds.length;r++){const i=e.rounds[r];if(!i)continue;const a=i.find(d=>d.id===o.nextMatchId);if(a)return!a.winnerId}return!0}}return!1}function Mn(e){const n=e.rounds.at(-1);if(!n)return null;if(n.length===1){const t=n[0];if(!t)return null;if(t.winnerId)return t.winnerId}return null}function $e(e,n){for(const[t,s]of e.rounds.entries()){if(!Array.isArray(s)||s.length===0)continue;const o=s.findIndex(r=>r.id===n);if(o!==-1)return{match:s[o]??null,roundIndex:t}}return{match:null,roundIndex:-1}}function B(e){e.winnerId=null,e.scores=[],e.walkover=!1}function Ge(e,n,t){let s=n,o=t;for(;s.nextMatchId;){let r=null,i=-1;for(let c=o+1;c<e.rounds.length;c++){const f=e.rounds[c];if(!f)continue;const y=f.findIndex(h=>h.id===s.nextMatchId&&!j(h));if(y!==-1){r=f[y]??null,i=c;break}}if(!r)break;const a=e.rounds[i-1];if(!a)break;const l=a.filter(c=>!j(c)).findIndex(c=>c.id===s.id);l!==-1&&(l%2===0?r.player1Id=null:r.player2Id=null),B(r),s=r,o=i}}function Tn(e,n){if(n===e.thirdPlaceMatch?.id)return B(e.thirdPlaceMatch),e;const{match:t,roundIndex:s}=$e(e,n);if(!t)return e;B(t);const o=e.rounds.length-2;return e.thirdPlaceMatch&&s===o&&(t.position===0?e.thirdPlaceMatch.player1Id=null:e.thirdPlaceMatch.player2Id=null,B(e.thirdPlaceMatch)),Ge(e,t,s),e}const G=P.forwardRef(({className:e,type:n,...t},s)=>p.jsx("input",{type:n,className:E("flex h-10 w-full rounded-lg border border-[var(--color-border)] bg-background text-foreground px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-primary)] disabled:cursor-not-allowed disabled:opacity-40 md:text-sm",e),ref:s,...t}));G.displayName="Input";const qe=Ae("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ae=P.forwardRef(({className:e,...n},t)=>p.jsx(re,{ref:t,className:E(qe(),e),...n}));ae.displayName=re.displayName;const le=P.forwardRef(({className:e,...n},t)=>p.jsx(ie,{ref:t,className:E("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...n,children:p.jsx(Me,{className:E("grid place-content-center text-current"),children:p.jsx(Te,{className:"h-4 w-4"})})}));le.displayName=ie.displayName;const I=111;function Ve(e,n){return e?e.winnerIndex===0?n.player1Id:n.player2Id:null}function Ye(e,n,t,s,o){if(!e)return"";if(e===n.player1Id){let i=t?.name??"";return t?.elo!=null&&o&&(i+=` (${o("players.elo",{elo:t.elo})})`),i}let r=s?.name??"";return s?.elo!=null&&o&&(r+=` (${o("players.elo",{elo:s.elo})})`),r}const Rn=({match:e,players:n,onSave:t,onClose:s,scoringMode:o=A.SETS,maxSets:r=ee})=>{const{t:i}=Ne(),a=Number.isFinite(r)&&r>0?r:ee,d=n.find(u=>u.id===e.player1Id),l=n.find(u=>u.id===e.player2Id),c=o===A.SETS,f=c,y=(()=>{if(e.scores.length>0){if(c){const{p1Sets:u,p2Sets:m}=L(e.scores,{scoringMode:A.SETS,maxSets:a});return[[u,m]]}return e.scores.map(u=>[...u])}return[[0,0]]})(),[h,W]=P.useState(y),[C,M]=P.useState(!1),[w,H]=P.useState(f?e.walkover:!1);function q(u){if(c||!Array.isArray(u))return null;for(const[m,g]of u.entries()){if(!Array.isArray(g))continue;const x=_(g[0],g[1]);if(x===1||x===2)return{index:m,winnerIndex:x-1}}return null}function $(u){if(c||!Array.isArray(u))return u;const m=q(u);if(!m)return u;const g=m.winnerIndex===0?[I,0]:[0,I];return u.map((x,S)=>{const T=Array.isArray(x)?x:[0,0];return S<m.index?[...T]:[...g]})}const b=q(h),N=L(h,{scoringMode:o,maxSets:a}),ce=Ve(b,e),V=c?N.p1Sets+N.p2Sets>0:!0,ue=w?N.p1Sets!==N.p2Sets&&V:!0,fe=!w||V&&ue;function Y(u,m,g){if(w&&!c||!c&&b&&u>=b.index)return;const x=Number.parseInt(g,10),S=Number.isFinite(x)?x:0,T=c?a:I,J=Math.min(Math.max(0,S),T),Q=h.map(Se=>[...Se]),Z=Q[u];Z&&(Z[m]=J),W($(Q))}function U(u,m,g){if(b&&u>b.index)return;const x=h.map(S=>[...S]);if(g)x[u]=m===0?[I,0]:[0,I];else{x[u]=[0,0];for(let S=u+1;S<x.length;S++){const T=x[S];if(!T)continue;_(T[0],T[1])!==0&&(x[S]=[0,0])}}W($(x))}function pe(u){f&&H(u)}function he(){if(!(h.length>=a)){if(b){const u=b.winnerIndex===0?[I,0]:[0,I];W([...h,[...u]]);return}W([...h,[0,0]])}}function ye(u){h.length>1&&!b&&W(h.filter((m,g)=>g!==u))}function X(){if(!c&&b)return ce;if(f&&w)return fe?N.p1Sets>N.p2Sets?e.player1Id:N.p2Sets>N.p1Sets?e.player2Id:null:null;const{p1Sets:u,p2Sets:m}=N;return u>m?e.player1Id:m>u?e.player2Id:null}function K(){const u=X();if(!u)return;const m=f&&w,g=h[0]??[0,0],x=c?[[g[0],g[1]]]:$(h).map(S=>[S[0],S[1]]);t(e.id,u,x,m)}function me(){M(!0)}function Ie(){M(!1),t(e.id,null,[],!1)}function xe(){M(!1)}const F=X(),ge=!!e.winnerId||e.scores.length>0||e.walkover||Ue(e.scores);return p.jsxs(p.Fragment,{children:[C&&p.jsx(be,{title:i("score.clearTitle"),message:i("score.clearMessage"),confirmLabel:i("score.clear"),cancelLabel:i("score.cancel"),onConfirm:Ie,onCancel:xe}),p.jsx(ve,{open:!0,onOpenChange:u=>{u||s()},onPrimaryAction:K,primaryActionDisabled:!F,children:p.jsxs(we,{className:"max-w-md","aria-describedby":void 0,children:[p.jsx(We,{className:"text-lg font-bold mb-5 pb-3 border-b border-[var(--color-border-soft)]",children:i("score.title")}),p.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center mb-4",children:[p.jsx("div",{className:"text-right font-medium text-xs sm:text-sm min-w-0 truncate",children:d?p.jsxs(p.Fragment,{children:[d.name,d.elo!=null&&p.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:d.elo})})]}):null}),p.jsx("div",{className:"text-[var(--color-faint)] text-sm",children:i("score.vs")}),p.jsx("div",{className:"font-medium text-xs sm:text-sm min-w-0 truncate",children:l?p.jsxs(p.Fragment,{children:[l.name,l.elo!=null&&p.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:l.elo})})]}):null})]}),f&&p.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[p.jsx(le,{id:"walkover",checked:w,onCheckedChange:u=>{pe(u===!0)}}),p.jsx(ae,{htmlFor:"walkover",className:"text-sm text-[var(--color-text)]",children:"WO"})]}),p.jsx("div",{className:"space-y-2 mb-4",children:h.map((u,m)=>{const g=!!(!c&&b&&m>=b.index),x=!!(!c&&b&&m>b.index);return p.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] gap-2 items-center",children:[p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(G,{type:"number","aria-label":`${d?.name??""} ${c?i("score.setsResult"):i("score.set",{n:m+1})}`,min:c?0:void 0,max:c?a:I,value:u[0],onChange:S=>{Y(m,0,S.target.value)},disabled:g||w&&!c,className:"text-center disabled:bg-[var(--color-soft)]"}),!c&&p.jsx(R,{type:"button",size:"sm",variant:u[0]===I&&u[1]===0?"primary":"primary-outlined",onClick:()=>{U(m,0,!(u[0]===I&&u[1]===0))},disabled:x,className:"px-2 py-1 text-xs",children:"WO"})]}),p.jsx("span",{className:"text-[var(--color-faint)] text-sm",children:c?i("score.setsResult"):i("score.set",{n:m+1})}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsx(G,{type:"number","aria-label":`${l?.name??""} ${c?i("score.setsResult"):i("score.set",{n:m+1})}`,min:c?0:void 0,max:c?a:I,value:u[1],onChange:S=>{Y(m,1,S.target.value)},disabled:g||w&&!c,className:"text-center disabled:bg-[var(--color-soft)]"}),!c&&p.jsx(R,{type:"button",size:"sm",variant:u[1]===I&&u[0]===0?"primary":"primary-outlined",onClick:()=>{U(m,1,!(u[1]===I&&u[0]===0))},disabled:x,className:"px-2 py-1 text-xs",children:"WO"})]}),!c&&h.length>1&&!w&&!b&&p.jsx(R,{variant:"ghost",size:"sm",onClick:()=>{ye(m)},className:"text-[var(--color-accent)] hover:text-[var(--color-primary-dark)]",children:"Ã—"})]},m)})}),!c&&h.length<a&&p.jsx(R,{variant:"link",onClick:he,className:"text-sm mb-4 px-0",children:i("score.addSet")}),F&&p.jsx("p",{className:"text-sm text-[var(--color-primary-dark)] font-medium bg-[var(--color-soft)] rounded-lg px-3 py-2 mb-4",children:i("score.winner",{name:Ye(F,e,d,l,i)})}),p.jsxs("div",{className:"flex flex-wrap gap-2 justify-end pt-4 mt-2 border-t border-[var(--color-border-soft)]",children:[ge&&p.jsx(R,{variant:"secondary-ghost",onClick:me,children:i("score.clear")}),p.jsx(R,{variant:"primary-ghost",onClick:s,children:i("score.cancel")}),p.jsx(R,{variant:"primary",onClick:K,disabled:!F,children:i("score.save")})]})]})})]})};function v(e){const n=Number(e);return Number.isFinite(n)&&Math.abs(n)===I}function _(e,n){return!v(e)&&!v(n)||e===I&&n===I||e===-I&&n===-I?0:e===I||n===-I?1:n===I||e===-I?2:0}function Ue(e){return Array.isArray(e)?e.some(n=>Array.isArray(n)&&(v(n[0])||v(n[1]))):!1}function L(e,n={}){const{maxSets:t=5,scoringMode:s=A.POINTS}=n;if(!Array.isArray(e)||e.length===0)return{p1Sets:0,p2Sets:0};const o=e.filter(a=>Array.isArray(a));if(o.length===0)return{p1Sets:0,p2Sets:0};if(s===A.SETS){const a=o[0];if(!a)return{p1Sets:0,p2Sets:0};const d=a[0],l=a[1];return Number.isFinite(d)&&Number.isFinite(l)&&d>=0&&l>=0&&d<=t&&l<=t?{p1Sets:d,p2Sets:l}:{p1Sets:0,p2Sets:0}}let r=0,i=0;for(const a of o){const d=a[0],l=a[1],c=_(d,l);if(c===1){r++;continue}if(c===2){i++;continue}d>l?r++:l>d&&i++}return{p1Sets:r,p2Sets:i}}function Dn(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return"";const s=e.filter(r=>Array.isArray(r));return s.length===0?"":s.map(r=>{const i=t?r[1]:r[0],a=t?r[0]:r[1];return v(i)||v(a)?"WO":`${i}-${a}`}).join(", ")}function kn(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return[];const s=e.filter(o=>Array.isArray(o));return s.length===0?[]:s.map(o=>{const r=o[0],i=o[1];if(v(r)||v(i)){const l=_(r,i);return l===0?null:{text:"WO",isWin:t?l===2:l===1}}const a=t?i:r,d=t?r:i;return!Number.isFinite(a)||!Number.isFinite(d)?null:{text:String(a).padStart(2," "),isWin:a>d}}).filter(o=>o!==null)}function Pn(e,n={}){const{idPrefix:t="rr"}=n,s=z();s.reset();function o(){return s.nextId(t)}const r=e.map(f=>f.id);r.length%2!==0&&r.push(null);const i=r.length,a=i-1,d=[],l=r[0];if(l===void 0)return{rounds:[]};const c=r.slice(1);for(let f=0;f<a;f++){const y=[l,...c],h=[];let W=null;for(let M=0;M<i/2;M++){const w=y[M]??null,H=y[i-1-M]??null;if(w==null){W=H;continue}if(H==null){W=w;continue}h.push(D(o(),{player1Id:w,player2Id:H}))}d.push({roundNumber:f+1,byePlayerId:W,matches:h});const C=c.pop();C!==void 0&&c.unshift(C)}return{rounds:d}}function Xe(e,n,t,s){if(!e.winnerId)return;const o=e.player1Id,r=e.player2Id;if(!o||!r)return;const i=n[o],a=n[r];if(!i||!a)return;i.played++,a.played++;const{p1Sets:d,p2Sets:l}=L(e.scores,{scoringMode:t,maxSets:s});if(i.setsWon+=d,i.setsLost+=l,a.setsWon+=l,a.setsLost+=d,t===A.POINTS){const c=Array.isArray(e.scores)?e.scores.filter(f=>Array.isArray(f)):[];for(const f of c){const y=f[0],h=f[1];!Number.isFinite(y)||!Number.isFinite(h)||v(y)||v(h)||(i.pointsWon+=y,i.pointsLost+=h,a.pointsWon+=h,a.pointsLost+=y)}}e.winnerId===e.player1Id?(i.wins++,i.points+=1,a.losses++):(a.wins++,a.points+=1,i.losses++)}function Ke(e,n){let t=0,s=0;if(n===A.POINTS){const o=Array.isArray(e.scores)?e.scores.filter(r=>Array.isArray(r)):[];for(const r of o){const i=r[0],a=r[1];!Number.isFinite(i)||!Number.isFinite(a)||v(i)||v(a)||(t+=i,s+=a)}}return[t,s]}function Je(e,n,t){const s={};for(const o of e.rounds)for(const r of o.matches){if(!r.winnerId||!r.player1Id||!r.player2Id)continue;const i=[r.player1Id,r.player2Id].toSorted((y,h)=>y.localeCompare(h)).join("-"),{p1Sets:a,p2Sets:d}=L(r.scores,{scoringMode:n,maxSets:t}),[l,c]=Ke(r,n),f=r.player1Id.localeCompare(r.player2Id)<0;s[i]={winnerId:r.winnerId,p1Sets:f?a:d,p2Sets:f?d:a,p1Points:f?l:c,p2Points:f?c:l}}return s}function Qe(e){return[...e].toSorted((n,t)=>{if(t.points!==n.points)return t.points-n.points;const s=n.setsWon-n.setsLost,o=t.setsWon-t.setsLost;return o!==s?o-s:t.setsWon-n.setsWon})}function Ze(e,n,t){const s={points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const o of n){if(o===e)continue;const r=[e,o].toSorted((d,l)=>d.localeCompare(l)).join("-"),i=t[r];if(!i)continue;const a=e.localeCompare(o)<0;i.winnerId===e&&s.points++,a?(s.setsWon+=i.p1Sets,s.setsLost+=i.p2Sets,s.pointsWon+=i.p1Points,s.pointsLost+=i.p2Points):(s.setsWon+=i.p2Sets,s.setsLost+=i.p1Sets,s.pointsWon+=i.p2Points,s.pointsLost+=i.p1Points)}return s}function en(e,n,t,s){const o=Ze(e.playerId,n,t);return{headToHead:o.points,headToHeadSetDiff:o.setsWon-o.setsLost,headToHeadSetsWon:o.setsWon,setDiff:e.setsWon-e.setsLost,setsWon:e.setsWon,pointsDiff:e.pointsWon-e.pointsLost,pointsDiffApplicable:s,tiebreakApplied:[]}}function nn(e,n){return n.headToHead!==e.headToHead?n.headToHead-e.headToHead:n.headToHeadSetDiff!==e.headToHeadSetDiff?n.headToHeadSetDiff-e.headToHeadSetDiff:n.headToHeadSetsWon!==e.headToHeadSetsWon?n.headToHeadSetsWon-e.headToHeadSetsWon:n.setDiff!==e.setDiff?n.setDiff-e.setDiff:n.setsWon!==e.setsWon?n.setsWon-e.setsWon:e.pointsDiffApplicable&&n.pointsDiffApplicable&&n.pointsDiff!==e.pointsDiff?n.pointsDiff-e.pointsDiff:0}function tn(e,n){const t=[];if(e.headToHead!==n.headToHead)return t.push("headToHead"),t;if(t.push("headToHead"),e.headToHeadSetDiff!==n.headToHeadSetDiff)return t.push("headToHeadSetDiff"),t;if(t.push("headToHeadSetDiff"),e.headToHeadSetsWon!==n.headToHeadSetsWon)return t.push("headToHeadSetsWon"),t;if(t.push("headToHeadSetsWon"),e.setDiff!==n.setDiff)return t.push("setDiff"),t;if(t.push("setDiff"),e.setsWon!==n.setsWon)return t.push("setsWon"),t;if(t.push("setsWon"),e.pointsDiffApplicable&&n.pointsDiffApplicable){if(e.pointsDiff!==n.pointsDiff)return t.push("pointsDiff"),t;t.push("pointsDiff")}return t}function sn(e,n,t){if(e.length===0)return e;const s=e.map(i=>i.playerId);for(const i of e)i.tiebreakDetails=en(i,s,n,t);const o=[...e].toSorted((i,a)=>{const d=i.tiebreakDetails,l=a.tiebreakDetails;return!d||!l?0:nn(d,l)});let r=0;for(;r<o.length;){let i=r+1;for(;i<o.length&&o[i]?.points===o[r]?.points;)i++;if(i-r>1){const d=o[r],l=o[i-1];if(d?.tiebreakDetails&&l?.tiebreakDetails){const c=tn(d.tiebreakDetails,l.tiebreakDetails);for(let f=r;f<i;f++){const y=o[f];y?.tiebreakDetails&&(y.tiebreakDetails.tiebreakApplied=c)}}}else{const d=o[r];d?.tiebreakDetails&&(d.tiebreakDetails.tiebreakApplied=[])}r=i}return o}function on(e,n,t){let s=0;for(;s<e.length;){let o=s+1;const r=e[s];if(!r)break;for(;o<e.length&&e[o]?.points===r.points;)o++;const i=e.slice(s,o),a=sn(i,n,t);for(const[d,l]of a.entries())e[s+d]=l;s=o}return e}function Hn(e,n,t={}){const{scoringMode:s=A.POINTS,maxSets:o}=t,r={};for(const l of n)r[l.id]={playerId:l.id,name:l.name,elo:typeof l.elo=="number"&&Number.isFinite(l.elo)?l.elo:void 0,played:0,wins:0,losses:0,points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const l of e.rounds)for(const c of l.matches)Xe(c,r,s,o);const i=Je(e,s,o),a=s===A.POINTS;let d=Object.values(r);return d=Qe(d),d=on(d,i,a),d}function jn(e){return e.rounds.every(n=>n.matches.every(t=>t.winnerId))}const se="__BYE__";function Ln(e){return Math.ceil(Math.log2(e))}function rn(e,n="sw"){const t=z();t.reset();const s=[...e].toSorted((l,c)=>(c.elo??1e3)-(l.elo??1e3)),o=s.length%2!==0;let r=null;o&&(r=s.at(-1)?.id??null);const i=o?s.slice(0,-1):s,a=i.length/2,d=[];for(let l=0;l<a;l++){const c=i[l],f=i[a+l];!c||!f||d.push(D(t.nextId(n),{player1Id:c.id,player2Id:f.id}))}return{roundNumber:1,byePlayerId:r,matches:d}}function Cn(e){return{rounds:[rn(e)]}}function an(e){const n=new Map;function t(s,o){let r=n.get(s);r||(r=new Set,n.set(s,r)),r.add(o)}for(const s of e.rounds){s.byePlayerId&&(t(s.byePlayerId,se),t(se,s.byePlayerId));for(const o of s.matches)o.player1Id&&o.player2Id&&(t(o.player1Id,o.player2Id),t(o.player2Id,o.player1Id))}return n}function oe(){return{wins:0,losses:0,played:0,opponents:[],wonAgainst:new Set,h2hWins:new Map,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0}}function ln(e,n,t){const s=Array.isArray(t)?t.filter(o=>Array.isArray(o)):[];for(const o of s){const r=o[0],i=o[1];!Number.isFinite(r)||!Number.isFinite(i)||v(r)||v(i)||(e.pointsWon+=r,e.pointsLost+=i,n.pointsWon+=i,n.pointsLost+=r)}}function dn(e,n,t,s,o,r){const{scoringMode:i=A.SETS,maxSets:a}=r;e.played+=1,n.played+=1,e.opponents.push(s),n.opponents.push(t);const{p1Sets:d,p2Sets:l}=L(o.scores,{scoringMode:i,maxSets:a});e.setsWon+=d,e.setsLost+=l,n.setsWon+=l,n.setsLost+=d,i===A.POINTS&&ln(e,n,o.scores),o.winnerId===t?(e.wins+=1,n.losses+=1,e.wonAgainst.add(s),e.h2hWins.set(s,(e.h2hWins.get(s)??0)+1)):(n.wins+=1,e.losses+=1,n.wonAgainst.add(t),n.h2hWins.set(t,(n.h2hWins.get(t)??0)+1))}function cn(e,n,t){for(const s of e){if(s.byePlayerId){const o=n.get(s.byePlayerId);o&&(o.wins+=1,t.maxSets!==void 0&&(o.setsWon+=Math.ceil(t.maxSets/2)))}for(const o of s.matches){const{player1Id:r,player2Id:i,winnerId:a}=o;if(!r||!i||!a)continue;const d=n.get(r),l=n.get(i);!d||!l||dn(d,l,r,i,o,t)}}}function un(e,n,t){let s=0,o=0;for(const a of n.opponents)s+=t.get(a)?.wins??0;for(const a of n.wonAgainst)o+=t.get(a)?.wins??0;const r=n.setsWon+n.setsLost,i=n.pointsWon+n.pointsLost;return{playerId:e.id,elo:e.elo,wins:n.wins,losses:n.losses,played:n.played,setsWon:n.setsWon,setsLost:n.setsLost,pointsWon:n.pointsWon,pointsLost:n.pointsLost,buchholz:s,sonnebornBerger:o,setRatio:r>0?n.setsWon/r:0,ballRatio:i>0?n.pointsWon/i:0,headToHead:0}}const O=["buchholz","sonnebornBerger","headToHead","setRatio","ballRatio"];function k(e,n){switch(n){case"buchholz":return e.buchholz;case"sonnebornBerger":return e.sonnebornBerger;case"headToHead":return e.headToHead;case"setRatio":return e.setRatio;case"ballRatio":return e.ballRatio}}function fn(e,n,t){const s=t.get(e);if(!s)return 0;let o=0;for(const[r,i]of s)n.has(r)&&(o+=i);return o}function pn(e,n){const t=O.indexOf("headToHead"),s=O.slice(0,t);return e.map(r=>{const i=new Set(e.filter(a=>s.every(d=>k(a,d)===k(r,d))).map(a=>a.playerId));return{...r,headToHead:fn(r.playerId,i,n)}}).toSorted((r,i)=>{for(const a of O){const d=k(i,a)-k(r,a);if(d!==0)return d}return(i.elo??1e3)-(r.elo??1e3)})}function hn(e){const n=new Map;for(const t of e)n.set(t.playerId,new Set);for(let t=0;t<e.length-1;t++){const s=e[t],o=e[t+1];if(s?.wins===o?.wins&&!(s===void 0||o===void 0)){for(const r of O)if(n.get(s.playerId)?.add(r),n.get(o.playerId)?.add(r),!(k(s,r)===k(o,r)))break}}return new Map([...n.entries()].map(([t,s])=>[t,[...s]]))}function yn(e,n,t){const s=t.get(e.playerId)??[],o={playerId:e.playerId,name:n.get(e.playerId)??"",elo:e.elo,played:e.played,wins:e.wins,losses:e.losses,points:e.wins,setsWon:e.setsWon,setsLost:e.setsLost,pointsWon:e.pointsWon,pointsLost:e.pointsLost,buchholz:e.buchholz};return s.length>0&&(o.tiebreakDetails={buchholz:e.buchholz,sonnebornBerger:e.sonnebornBerger,headToHead:e.headToHead,setRatio:e.setRatio,ballRatio:e.ballRatio,tiebreakApplied:s}),o}function mn(e,n,t={}){const s=new Map;for(const c of n)s.set(c.id,oe());cn(e.rounds,s,t);const o=new Map,r=[];for(const c of n){const f=s.get(c.id)??oe();o.set(c.id,f.h2hWins),r.push(un(c,f,s))}const i=new Map;for(const c of r){const f=i.get(c.wins);f?f.push(c):i.set(c.wins,[c])}const a=[];for(const[,c]of[...i.entries()].toSorted((f,y)=>y[0]-f[0]))a.push(...pn(c,o));const d=hn(a),l=new Map(n.map(c=>[c.id,c.name]));return a.map(c=>yn(c,l,d))}function In(e,n){if(e.length%2===0)return null;const t=new Set;for(const s of n.rounds)s.byePlayerId&&t.add(s.byePlayerId);for(let s=e.length-1;s>=0;s--){const o=e[s];if(o&&!t.has(o.playerId))return o.playerId}return e.at(-1)?.playerId??null}function de(e,n,t,s,o){if(e.length===0)return[];const r=e[0];if(!r)return null;for(let i=1;i<e.length;i++){const a=e[i];if(!a||n.get(r)?.has(a))continue;const d=e.filter((c,f)=>f!==0&&f!==i),l=de(d,n,t,s);if(l!==null)return[D(t.nextId(s),{player1Id:r,player2Id:a}),...l]}return null}function Fn(e){const{schedule:n,players:t}=e,s=n.rounds.length+1,o="sw",r=z(n.rounds.reduce((y,h)=>y+h.matches.length,0)),i=mn(n,t),a=In(i,n),d=an(n),l=i.map(y=>y.playerId).filter(y=>y!==a),c=de(l,d,r,o);let f;if(c===null){f=[];for(let y=0;y<l.length-1;y+=2){const h=l[y],W=l[y+1];!h||!W||f.push(D(r.nextId(o),{player1Id:h,player2Id:W}))}}else f=c;return{roundNumber:s,byePlayerId:a,matches:f}}function xn(e){const n=e.rounds.at(-1);return n?n.matches.every(t=>t.winnerId!==null):!1}function Bn(e){return xn(e.schedule)&&e.schedule.rounds.length>=e.totalRounds}function On(e){return e.map((n,t)=>({playerId:n.playerId,name:n.name,rankStart:t+1,rankEnd:t+1}))}export{le as C,G as I,ae as L,Rn as S,Cn as a,Pn as b,Ln as c,Mn as d,Hn as e,Nn as f,Wn as g,An as h,Tn as i,Ue as j,L as k,jn as l,mn as m,xn as n,Bn as o,On as p,Fn as q,v as r,_ as s,Dn as t,kn as u,D as v,j as w,z as x,Re as y};
