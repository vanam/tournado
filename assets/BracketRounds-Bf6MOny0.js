import{C as Je,b as Ze,D as en,c as nn,S as P,a as O,B as tn}from"./ConfirmModal-DihrUlho.js";import{r as _,j as f}from"./react-vendor-B7IL4Whh.js";import{c as ne,b as rn,u as ue,D as Se,B as j}from"./index-eCmkk7TN.js";import{l as Le,m as je,n as sn}from"./radix-ui-BObq5o7x.js";import{b as on}from"./icons-kaZEYU8o.js";function q(e=0){let n=e;return{nextId(t=""){return n+=1,t+String(n)},reset(){n=e}}}function A(e,n={}){return{id:e,player1Id:null,player2Id:null,scores:[],winnerId:null,walkover:!1,nextMatchId:null,dummy:!1,...n}}function Fe(e){let n=1;for(;n<e;)n*=2;return n}function W(e){return e?.dummy??!1}function an(e){if(e===1)return[0];const n=Array.from({length:e}),t=e/2,r=[];for(let s=1;s<=t;s+=2)r.push(s);for(let s=2;s<=t;s+=2)r.push(s);for(const[s,o]of r.entries()){const i=o-1,a=e-o;n[i]=s*2,n[a]=s*2+1}return n}const we=q();function ln(e,n,t){const r=Array.from({length:n},()=>null);for(let s=0;s<n;s++){const o=t[s];if(o!==void 0&&s<e.length){const i=e[s];i&&(r[o]=i.id)}}return r}function cn(e,n){const t=[];for(let r=0;r<e.length;r+=2){const s=e[r]??null,o=e[r+1]??null;t.push(A(n(),{player1Id:s,player2Id:o,position:r/2}))}return t}function dn(e){for(const n of e)n.player1Id&&!n.player2Id?n.winnerId=n.player1Id:!n.player1Id&&n.player2Id&&(n.winnerId=n.player2Id)}function un(e,n,t){for(let r=1;r<n;r++){const s=e[r-1];if(!s)continue;const o=[];for(let i=0;i<s.length;i+=2){const a=s[i],l=s[i+1];if(!a||!l)continue;const c=A(t(),{player1Id:a.winnerId??null,player2Id:l.winnerId??null,position:i/2});a.nextMatchId=c.id,l.nextMatchId=c.id;const d=!!a.winnerId||!a.player1Id&&!a.player2Id,u=!!l.winnerId||!l.player1Id&&!l.player2Id;d&&u&&(c.player1Id&&!c.player2Id?c.winnerId=c.player1Id:!c.player1Id&&c.player2Id&&(c.winnerId=c.player2Id)),o.push(c)}e.push(o)}}function fn(e,n){return e>=2?A(n()):null}function ie(e){we.reset();const n=e.length,t=Fe(n),r=Math.log2(t),s=an(t),o=()=>we.nextId("m"),i=ln(e,t,s),a=[],l=cn(i,o);dn(l),a.push(l),un(a,r,o);const c=fn(r,o);return{rounds:a,thirdPlaceMatch:c}}function pn(e,n){let t=0;for(const r of e){const s=r.find(o=>o.id===n)??null;if(s)return{match:s,roundIndex:t};t++}return{match:null,roundIndex:-1}}function be(e,n,t,r){e.winnerId=n,e.scores=t,e.walkover=r}function hn(e,n,t,r){const s=e.rounds.length-2;if(e.thirdPlaceMatch&&r===s){const o=n.player1Id===t?n.player2Id:n.player1Id;n.position===0?e.thirdPlaceMatch.player1Id=o:e.thirdPlaceMatch.player2Id=o}}function yn(e,n){if(!n)return null;for(const[t,r]of e.entries()){const s=r.find(o=>o.id===n&&!W(o));if(s)return{match:s,roundIndex:t}}return null}function In(e,n){return e.filter(r=>!W(r)).findIndex(r=>r.id===n)}function mn(e,n,t){n%2===0?e.player1Id=t:e.player2Id=t}function gn(e,n,t){const r=n.filter(c=>!W(c)),s=Math.floor(t/2)*2,o=r[s],i=r[s+1],a=!o||!!o.winnerId||!o.player1Id&&!o.player2Id,l=!i||!!i.winnerId||!i.player1Id&&!i.player2Id;a&&l&&(e.player1Id&&!e.player2Id?e.winnerId=e.player1Id:!e.player1Id&&e.player2Id&&(e.winnerId=e.player2Id))}function xn(e,n,t){const r=e.rounds;let s=n,o=t;for(;s.nextMatchId;){const i=yn(r,s.nextMatchId);if(!i||i.roundIndex<=o)break;const a=i.match,l=i.roundIndex,c=r[l-1];if(!c)break;const d=In(c,s.id);if(d===-1||(mn(a,d,s.winnerId),gn(a,c,d),!a.winnerId))break;s=a,o=l}}function $(e,n,t,r,s=!1){if(n===e.thirdPlaceMatch?.id)return be(e.thirdPlaceMatch,t,r,s),e;const{match:o,roundIndex:i}=pn(e.rounds,n);return o&&(be(o,t,r,s),hn(e,o,t,i),xn(e,o,i)),e}function ae(e,n){if(n===e.thirdPlaceMatch?.id)return!!(e.thirdPlaceMatch.player1Id&&e.thirdPlaceMatch.player2Id);for(let t=0;t<e.rounds.length;t++){const r=e.rounds[t];if(!r)continue;const s=r.find(o=>o.id===n);if(s){if(!s.nextMatchId)return!0;for(let o=t+1;o<e.rounds.length;o++){const i=e.rounds[o];if(!i)continue;const a=i.find(l=>l.id===s.nextMatchId);if(a)return!a.winnerId}return!0}}return!1}function le(e){const n=e.rounds.at(-1);if(!n)return null;if(n.length===1){const t=n[0];if(!t)return null;if(t.winnerId)return t.winnerId;if(t.player1Id&&!t.player2Id)return t.player1Id;if(!t.player1Id&&t.player2Id)return t.player2Id}return null}function Sn(e,n){for(const[t,r]of e.rounds.entries()){if(!Array.isArray(r)||r.length===0)continue;const s=r.findIndex(o=>o.id===n);if(s!==-1)return{match:r[s]??null,roundIndex:t}}return{match:null,roundIndex:-1}}function Z(e){e.winnerId=null,e.scores=[],e.walkover=!1}function wn(e,n,t){let r=n,s=t;for(;r.nextMatchId;){let o=null,i=-1;for(let d=s+1;d<e.rounds.length;d++){const u=e.rounds[d];if(!u)continue;const h=u.findIndex(p=>p.id===r.nextMatchId&&!W(p));if(h!==-1){o=u[h]??null,i=d;break}}if(!o)break;const a=e.rounds[i-1];if(!a)break;const c=a.filter(d=>!W(d)).findIndex(d=>d.id===r.id);c!==-1&&(c%2===0?o.player1Id=null:o.player2Id=null),Z(o),r=o,s=i}}function ce(e,n){if(n===e.thirdPlaceMatch?.id)return Z(e.thirdPlaceMatch),e;const{match:t,roundIndex:r}=Sn(e,n);if(!t)return e;Z(t);const s=e.rounds.length-2;return e.thirdPlaceMatch&&r===s&&(t.position===0?e.thirdPlaceMatch.player1Id=null:e.thirdPlaceMatch.player2Id=null,Z(e.thirdPlaceMatch)),wn(e,t,r),e}const de=_.forwardRef(({className:e,type:n,...t},r)=>f.jsx("input",{type:n,className:ne("flex h-10 w-full rounded-lg border border-[var(--color-border)] bg-background text-foreground px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-primary)] disabled:cursor-not-allowed disabled:opacity-40 md:text-sm",e),ref:r,...t}));de.displayName="Input";const bn=rn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ce=_.forwardRef(({className:e,...n},t)=>f.jsx(Le,{ref:t,className:ne(bn(),e),...n}));Ce.displayName=Le.displayName;const He=_.forwardRef(({className:e,...n},t)=>f.jsx(je,{ref:t,className:ne("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...n,children:f.jsx(sn,{className:ne("grid place-content-center text-current"),children:f.jsx(on,{className:"h-4 w-4"})})}));He.displayName=je.displayName;const S=111;function vn(e,n){return e?e.winnerIndex===0?n.player1Id:n.player2Id:null}function Mn(e,n,t,r,s){if(!e)return"";if(e===n.player1Id){let i=t?.name??"";return t?.elo!=null&&s&&(i+=` (${s("players.elo",{elo:t.elo})})`),i}let o=r?.name??"";return r?.elo!=null&&s&&(o+=` (${s("players.elo",{elo:r.elo})})`),o}const Nt=({match:e,players:n,onSave:t,onClose:r,scoringMode:s=P.SETS,maxSets:o=Se})=>{const{t:i}=ue(),a=Number.isFinite(o)&&o>0?o:Se,l=n.find(y=>y.id===e.player1Id),c=n.find(y=>y.id===e.player2Id),d=s===P.SETS,u=d,h=(()=>{if(e.scores.length>0){if(d){const{p1Sets:y,p2Sets:m}=E(e.scores,{scoringMode:P.SETS,maxSets:a});return[[y,m]]}return e.scores.map(y=>[...y])}return[[0,0]]})(),[p,I]=_.useState(h),[M,g]=_.useState(!1),[x,R]=_.useState(u?e.walkover:!1);function H(y){if(d||!Array.isArray(y))return null;for(const[m,b]of y.entries()){if(!Array.isArray(b))continue;const w=te(b[0],b[1]);if(w===1||w===2)return{index:m,winnerIndex:w-1}}return null}function B(y){if(d||!Array.isArray(y))return y;const m=H(y);if(!m)return y;const b=m.winnerIndex===0?[S,0]:[0,S];return y.map((w,v)=>{const L=Array.isArray(w)?w:[0,0];return v<m.index?[...L]:[...b]})}const k=H(p),N=E(p,{scoringMode:s,maxSets:a}),U=vn(k,e),V=d?N.p1Sets+N.p2Sets>0:!0,se=x?N.p1Sets!==N.p2Sets&&V:!0,Q=!x||V&&se;function Y(y,m,b){if(x&&!d||!d&&k&&y>=k.index)return;const w=Number.parseInt(b,10),v=Number.isFinite(w)?w:0,L=d?a:S,me=Math.min(Math.max(0,v),L),ge=p.map(Xe=>[...Xe]),xe=ge[y];xe&&(xe[m]=me),I(B(ge))}function K(y,m,b){if(k&&y>k.index)return;const w=p.map(v=>[...v]);if(b)w[y]=m===0?[S,0]:[0,S];else{w[y]=[0,0];for(let v=y+1;v<w.length;v++){const L=w[v];if(!L)continue;te(L[0],L[1])!==0&&(w[v]=[0,0])}}I(B(w))}function T(y){u&&R(y)}function qe(){if(!(p.length>=a)){if(k){const y=k.winnerIndex===0?[S,0]:[0,S];I([...p,[...y]]);return}I([...p,[0,0]])}}function Ue(y){p.length>1&&!k&&I(p.filter((m,b)=>b!==y))}function ye(){if(!d&&k)return U;if(u&&x)return Q?N.p1Sets>N.p2Sets?e.player1Id:N.p2Sets>N.p1Sets?e.player2Id:null:null;const{p1Sets:y,p2Sets:m}=N;return y>m?e.player1Id:m>y?e.player2Id:null}function Ie(){const y=ye();if(!y)return;const m=u&&x,b=p[0]??[0,0],w=d?[[b[0],b[1]]]:B(p).map(v=>[v[0],v[1]]);t(e.id,y,w,m)}function Ve(){g(!0)}function Qe(){g(!1),t(e.id,null,[],!1)}function Ye(){g(!1)}const X=ye(),Ke=!!e.winnerId||e.scores.length>0||e.walkover||fe(e.scores);return f.jsxs(f.Fragment,{children:[M&&f.jsx(Je,{title:i("score.clearTitle"),message:i("score.clearMessage"),confirmLabel:i("score.clear"),cancelLabel:i("score.cancel"),onConfirm:Qe,onCancel:Ye}),f.jsx(Ze,{open:!0,onOpenChange:y=>{y||r()},onPrimaryAction:Ie,primaryActionDisabled:!X,children:f.jsxs(en,{className:"max-w-md","aria-describedby":void 0,children:[f.jsx(nn,{className:"text-lg font-bold mb-5 pb-3 border-b border-[var(--color-border-soft)]",children:i("score.title")}),f.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center mb-4",children:[f.jsx("div",{className:"text-right font-medium text-xs sm:text-sm min-w-0 truncate",children:l?f.jsxs(f.Fragment,{children:[l.name,l.elo!=null&&f.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:l.elo})})]}):null}),f.jsx("div",{className:"text-[var(--color-faint)] text-sm",children:i("score.vs")}),f.jsx("div",{className:"font-medium text-xs sm:text-sm min-w-0 truncate",children:c?f.jsxs(f.Fragment,{children:[c.name,c.elo!=null&&f.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:c.elo})})]}):null})]}),u&&f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(He,{id:"walkover",checked:x,onCheckedChange:y=>{T(y===!0)}}),f.jsx(Ce,{htmlFor:"walkover",className:"text-sm text-[var(--color-text)]",children:"WO"})]}),f.jsx("div",{className:"space-y-2 mb-4",children:p.map((y,m)=>{const b=!!(!d&&k&&m>=k.index),w=!!(!d&&k&&m>k.index);return f.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] gap-2 items-center",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(de,{type:"number","aria-label":`${l?.name??""} ${d?i("score.setsResult"):i("score.set",{n:m+1})}`,min:d?0:void 0,max:d?a:S,value:y[0],onChange:v=>{Y(m,0,v.target.value)},disabled:b||x&&!d,className:"text-center disabled:bg-[var(--color-soft)]"}),!d&&f.jsx(j,{type:"button",size:"sm",variant:y[0]===S&&y[1]===0?"primary":"primary-outlined",onClick:()=>{K(m,0,!(y[0]===S&&y[1]===0))},disabled:w,className:"px-2 py-1 text-xs",children:"WO"})]}),f.jsx("span",{className:"text-[var(--color-faint)] text-sm",children:d?i("score.setsResult"):i("score.set",{n:m+1})}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(de,{type:"number","aria-label":`${c?.name??""} ${d?i("score.setsResult"):i("score.set",{n:m+1})}`,min:d?0:void 0,max:d?a:S,value:y[1],onChange:v=>{Y(m,1,v.target.value)},disabled:b||x&&!d,className:"text-center disabled:bg-[var(--color-soft)]"}),!d&&f.jsx(j,{type:"button",size:"sm",variant:y[1]===S&&y[0]===0?"primary":"primary-outlined",onClick:()=>{K(m,1,!(y[1]===S&&y[0]===0))},disabled:w,className:"px-2 py-1 text-xs",children:"WO"})]}),!d&&p.length>1&&!x&&!k&&f.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{Ue(m)},className:"text-[var(--color-accent)] hover:text-[var(--color-primary-dark)]",children:"Ã—"})]},m)})}),!d&&p.length<a&&f.jsx(j,{variant:"link",onClick:qe,className:"text-sm mb-4 px-0",children:i("score.addSet")}),X&&f.jsx("p",{className:"text-sm text-[var(--color-primary-dark)] font-medium bg-[var(--color-soft)] rounded-lg px-3 py-2 mb-4",children:i("score.winner",{name:Mn(X,e,l,c,i)})}),f.jsxs("div",{className:"flex flex-wrap gap-2 justify-end pt-4 mt-2 border-t border-[var(--color-border-soft)]",children:[Ke&&f.jsx(j,{variant:"secondary-ghost",onClick:Ve,children:i("score.clear")}),f.jsx(j,{variant:"primary-ghost",onClick:r,children:i("score.cancel")}),f.jsx(j,{variant:"primary",onClick:Ie,disabled:!X,children:i("score.save")})]})]})})]})};function D(e){const n=Number(e);return Number.isFinite(n)&&Math.abs(n)===S}function te(e,n){return!D(e)&&!D(n)||e===S&&n===S||e===-S&&n===-S?0:e===S||n===-S?1:n===S||e===-S?2:0}function fe(e){return Array.isArray(e)?e.some(n=>Array.isArray(n)&&(D(n[0])||D(n[1]))):!1}function E(e,n={}){const{maxSets:t=5,scoringMode:r=P.POINTS}=n;if(!Array.isArray(e)||e.length===0)return{p1Sets:0,p2Sets:0};const s=e.filter(a=>Array.isArray(a));if(s.length===0)return{p1Sets:0,p2Sets:0};if(r===P.SETS){const a=s[0];if(!a)return{p1Sets:0,p2Sets:0};const l=a[0],c=a[1];return Number.isFinite(l)&&Number.isFinite(c)&&l>=0&&c>=0&&l<=t&&c<=t?{p1Sets:l,p2Sets:c}:{p1Sets:0,p2Sets:0}}let o=0,i=0;for(const a of s){const l=a[0],c=a[1],d=te(l,c);if(d===1){o++;continue}if(d===2){i++;continue}l>c?o++:c>l&&i++}return{p1Sets:o,p2Sets:i}}function Rt(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return"";const r=e.filter(o=>Array.isArray(o));return r.length===0?"":r.map(o=>{const i=t?o[1]:o[0],a=t?o[0]:o[1];return D(i)||D(a)?"WO":`${i}-${a}`}).join(", ")}function ve(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return[];const r=e.filter(s=>Array.isArray(s));return r.length===0?[]:r.map(s=>{const o=s[0],i=s[1];if(D(o)||D(i)){const c=te(o,i);return c===0?null:{text:"WO",isWin:t?c===2:c===1}}const a=t?i:o,l=t?o:i;return!Number.isFinite(a)||!Number.isFinite(l)?null:{text:String(a).padStart(2," "),isWin:a>l}}).filter(s=>s!==null)}function kn(e,n={}){const{idPrefix:t="rr"}=n,r=q();r.reset();function s(){return r.nextId(t)}const o=e.map(u=>u.id);o.length%2!==0&&o.push(null);const i=o.length,a=i-1,l=[],c=o[0];if(c===void 0)return{rounds:[]};const d=o.slice(1);for(let u=0;u<a;u++){const h=[c,...d],p=[];let I=null;for(let g=0;g<i/2;g++){const x=h[g]??null,R=h[i-1-g]??null;if(x==null){I=R;continue}if(R==null){I=x;continue}p.push(A(s(),{player1Id:x,player2Id:R}))}l.push({roundNumber:u+1,byePlayerId:I,matches:p});const M=d.pop();M!==void 0&&d.unshift(M)}return{rounds:l}}function Wn(e,n,t,r){if(!e.winnerId)return;const s=e.player1Id,o=e.player2Id;if(!s||!o)return;const i=n[s],a=n[o];if(!i||!a)return;i.played++,a.played++;const{p1Sets:l,p2Sets:c}=E(e.scores,{scoringMode:t,maxSets:r});if(i.setsWon+=l,i.setsLost+=c,a.setsWon+=c,a.setsLost+=l,t===P.POINTS){const d=Array.isArray(e.scores)?e.scores.filter(u=>Array.isArray(u)):[];for(const u of d){const h=u[0],p=u[1];!Number.isFinite(h)||!Number.isFinite(p)||D(h)||D(p)||(i.pointsWon+=h,i.pointsLost+=p,a.pointsWon+=p,a.pointsLost+=h)}}e.winnerId===e.player1Id?(i.wins++,i.points+=1,a.losses++):(a.wins++,a.points+=1,i.losses++)}function Pn(e,n){let t=0,r=0;if(n===P.POINTS){const s=Array.isArray(e.scores)?e.scores.filter(o=>Array.isArray(o)):[];for(const o of s){const i=o[0],a=o[1];!Number.isFinite(i)||!Number.isFinite(a)||D(i)||D(a)||(t+=i,r+=a)}}return[t,r]}function Dn(e,n,t){const r={};for(const s of e.rounds)for(const o of s.matches){if(!o.winnerId||!o.player1Id||!o.player2Id)continue;const i=[o.player1Id,o.player2Id].toSorted((h,p)=>h.localeCompare(p)).join("-"),{p1Sets:a,p2Sets:l}=E(o.scores,{scoringMode:n,maxSets:t}),[c,d]=Pn(o,n),u=o.player1Id.localeCompare(o.player2Id)<0;r[i]={winnerId:o.winnerId,p1Sets:u?a:l,p2Sets:u?l:a,p1Points:u?c:d,p2Points:u?d:c}}return r}function An(e){return[...e].toSorted((n,t)=>{if(t.points!==n.points)return t.points-n.points;const r=n.setsWon-n.setsLost,s=t.setsWon-t.setsLost;return s!==r?s-r:t.setsWon-n.setsWon})}function Nn(e,n,t){const r={points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const s of n){if(s===e)continue;const o=[e,s].toSorted((l,c)=>l.localeCompare(c)).join("-"),i=t[o];if(!i)continue;const a=e.localeCompare(s)<0;i.winnerId===e&&r.points++,a?(r.setsWon+=i.p1Sets,r.setsLost+=i.p2Sets,r.pointsWon+=i.p1Points,r.pointsLost+=i.p2Points):(r.setsWon+=i.p2Sets,r.setsLost+=i.p1Sets,r.pointsWon+=i.p2Points,r.pointsLost+=i.p1Points)}return r}function Rn(e,n,t,r){const s=Nn(e.playerId,n,t);return{headToHead:s.points,headToHeadSetDiff:s.setsWon-s.setsLost,headToHeadSetsWon:s.setsWon,setDiff:e.setsWon-e.setsLost,setsWon:e.setsWon,pointsDiff:e.pointsWon-e.pointsLost,pointsDiffApplicable:r,tiebreakApplied:[]}}function Tn(e,n){return n.headToHead!==e.headToHead?n.headToHead-e.headToHead:n.headToHeadSetDiff!==e.headToHeadSetDiff?n.headToHeadSetDiff-e.headToHeadSetDiff:n.headToHeadSetsWon!==e.headToHeadSetsWon?n.headToHeadSetsWon-e.headToHeadSetsWon:n.setDiff!==e.setDiff?n.setDiff-e.setDiff:n.setsWon!==e.setsWon?n.setsWon-e.setsWon:e.pointsDiffApplicable&&n.pointsDiffApplicable&&n.pointsDiff!==e.pointsDiff?n.pointsDiff-e.pointsDiff:0}function Ln(e,n){const t=[];if(e.headToHead!==n.headToHead)return t.push("headToHead"),t;if(t.push("headToHead"),e.headToHeadSetDiff!==n.headToHeadSetDiff)return t.push("headToHeadSetDiff"),t;if(t.push("headToHeadSetDiff"),e.headToHeadSetsWon!==n.headToHeadSetsWon)return t.push("headToHeadSetsWon"),t;if(t.push("headToHeadSetsWon"),e.setDiff!==n.setDiff)return t.push("setDiff"),t;if(t.push("setDiff"),e.setsWon!==n.setsWon)return t.push("setsWon"),t;if(t.push("setsWon"),e.pointsDiffApplicable&&n.pointsDiffApplicable){if(e.pointsDiff!==n.pointsDiff)return t.push("pointsDiff"),t;t.push("pointsDiff")}return t}function jn(e,n,t){if(e.length===0)return e;const r=e.map(i=>i.playerId);for(const i of e)i.tiebreakDetails=Rn(i,r,n,t);const s=[...e].toSorted((i,a)=>{const l=i.tiebreakDetails,c=a.tiebreakDetails;return!l||!c?0:Tn(l,c)});let o=0;for(;o<s.length;){let i=o+1;for(;i<s.length&&s[i]?.points===s[o]?.points;)i++;if(i-o>1){const l=s[o],c=s[i-1];if(l?.tiebreakDetails&&c?.tiebreakDetails){const d=Ln(l.tiebreakDetails,c.tiebreakDetails);for(let u=o;u<i;u++){const h=s[u];h?.tiebreakDetails&&(h.tiebreakDetails.tiebreakApplied=d)}}}else{const l=s[o];l?.tiebreakDetails&&(l.tiebreakDetails.tiebreakApplied=[])}o=i}return s}function Fn(e,n,t){let r=0;for(;r<e.length;){let s=r+1;const o=e[r];if(!o)break;for(;s<e.length&&e[s]?.points===o.points;)s++;const i=e.slice(r,s),a=jn(i,n,t);for(const[l,c]of a.entries())e[r+l]=c;r=s}return e}function Be(e,n,t={}){const{scoringMode:r=P.POINTS,maxSets:s}=t,o={};for(const c of n)o[c.id]={playerId:c.id,name:c.name,elo:typeof c.elo=="number"&&Number.isFinite(c.elo)?c.elo:void 0,played:0,wins:0,losses:0,points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const c of e.rounds)for(const d of c.matches)Wn(d,o,r,s);const i=Dn(e,r,s),a=r===P.POINTS;let l=Object.values(o);return l=An(l),l=Fn(l,i,a),l}function Cn(e){return e.rounds.every(n=>n.matches.every(t=>t.winnerId))}const Me="__BYE__";function Tt(e){return Math.ceil(Math.log2(e))}function Hn(e,n="sw"){const t=q();t.reset();const r=[...e].toSorted((c,d)=>(d.elo??1e3)-(c.elo??1e3)),s=r.length%2!==0;let o=null;s&&(o=r.at(-1)?.id??null);const i=s?r.slice(0,-1):r,a=i.length/2,l=[];for(let c=0;c<a;c++){const d=i[c],u=i[a+c];!d||!u||l.push(A(t.nextId(n),{player1Id:d.id,player2Id:u.id}))}return{roundNumber:1,byePlayerId:o,matches:l}}function Lt(e){return{rounds:[Hn(e)]}}function Bn(e){const n=new Map;function t(r,s){let o=n.get(r);o||(o=new Set,n.set(r,o)),o.add(s)}for(const r of e.rounds){r.byePlayerId&&(t(r.byePlayerId,Me),t(Me,r.byePlayerId));for(const s of r.matches)s.player1Id&&s.player2Id&&(t(s.player1Id,s.player2Id),t(s.player2Id,s.player1Id))}return n}function ke(){return{wins:0,losses:0,played:0,opponents:[],wonAgainst:new Set,h2hWins:new Map,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0}}function On(e,n,t){const r=Array.isArray(t)?t.filter(s=>Array.isArray(s)):[];for(const s of r){const o=s[0],i=s[1];!Number.isFinite(o)||!Number.isFinite(i)||D(o)||D(i)||(e.pointsWon+=o,e.pointsLost+=i,n.pointsWon+=i,n.pointsLost+=o)}}function Gn(e,n,t,r,s,o){const{scoringMode:i=P.SETS,maxSets:a}=o;e.played+=1,n.played+=1,e.opponents.push(r),n.opponents.push(t);const{p1Sets:l,p2Sets:c}=E(s.scores,{scoringMode:i,maxSets:a});e.setsWon+=l,e.setsLost+=c,n.setsWon+=c,n.setsLost+=l,i===P.POINTS&&On(e,n,s.scores),s.winnerId===t?(e.wins+=1,n.losses+=1,e.wonAgainst.add(r),e.h2hWins.set(r,(e.h2hWins.get(r)??0)+1)):(n.wins+=1,e.losses+=1,n.wonAgainst.add(t),n.h2hWins.set(t,(n.h2hWins.get(t)??0)+1))}function _n(e,n,t){for(const r of e){if(r.byePlayerId){const s=n.get(r.byePlayerId);s&&(s.wins+=1,t.maxSets!==void 0&&(s.setsWon+=Math.ceil(t.maxSets/2)))}for(const s of r.matches){const{player1Id:o,player2Id:i,winnerId:a}=s;if(!o||!i||!a)continue;const l=n.get(o),c=n.get(i);!l||!c||Gn(l,c,o,i,s,t)}}}function En(e,n,t){let r=0,s=0;for(const a of n.opponents)r+=t.get(a)?.wins??0;for(const a of n.wonAgainst)s+=t.get(a)?.wins??0;const o=n.setsWon+n.setsLost,i=n.pointsWon+n.pointsLost;return{playerId:e.id,elo:e.elo,wins:n.wins,losses:n.losses,played:n.played,setsWon:n.setsWon,setsLost:n.setsLost,pointsWon:n.pointsWon,pointsLost:n.pointsLost,buchholz:r,sonnebornBerger:s,setRatio:o>0?n.setsWon/o:0,ballRatio:i>0?n.pointsWon/i:0,headToHead:0}}const ee=["buchholz","sonnebornBerger","headToHead","setRatio","ballRatio"];function G(e,n){switch(n){case"buchholz":return e.buchholz;case"sonnebornBerger":return e.sonnebornBerger;case"headToHead":return e.headToHead;case"setRatio":return e.setRatio;case"ballRatio":return e.ballRatio}}function $n(e,n,t){const r=t.get(e);if(!r)return 0;let s=0;for(const[o,i]of r)n.has(o)&&(s+=i);return s}function zn(e,n){const t=ee.indexOf("headToHead"),r=ee.slice(0,t);return e.map(o=>{const i=new Set(e.filter(a=>r.every(l=>G(a,l)===G(o,l))).map(a=>a.playerId));return{...o,headToHead:$n(o.playerId,i,n)}}).toSorted((o,i)=>{for(const a of ee){const l=G(i,a)-G(o,a);if(l!==0)return l}return(i.elo??1e3)-(o.elo??1e3)})}function qn(e){const n=new Map;for(const t of e)n.set(t.playerId,new Set);for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1];if(r?.wins===s?.wins&&!(r===void 0||s===void 0)){for(const o of ee)if(n.get(r.playerId)?.add(o),n.get(s.playerId)?.add(o),!(G(r,o)===G(s,o)))break}}return new Map([...n.entries()].map(([t,r])=>[t,[...r]]))}function Un(e,n,t){const r=t.get(e.playerId)??[],s={playerId:e.playerId,name:n.get(e.playerId)??"",elo:e.elo,played:e.played,wins:e.wins,losses:e.losses,points:e.wins,setsWon:e.setsWon,setsLost:e.setsLost,pointsWon:e.pointsWon,pointsLost:e.pointsLost,buchholz:e.buchholz};return r.length>0&&(s.tiebreakDetails={buchholz:e.buchholz,sonnebornBerger:e.sonnebornBerger,headToHead:e.headToHead,setRatio:e.setRatio,ballRatio:e.ballRatio,tiebreakApplied:r}),s}function Vn(e,n,t={}){const r=new Map;for(const d of n)r.set(d.id,ke());_n(e.rounds,r,t);const s=new Map,o=[];for(const d of n){const u=r.get(d.id)??ke();s.set(d.id,u.h2hWins),o.push(En(d,u,r))}const i=new Map;for(const d of o){const u=i.get(d.wins);u?u.push(d):i.set(d.wins,[d])}const a=[];for(const[,d]of[...i.entries()].toSorted((u,h)=>h[0]-u[0]))a.push(...zn(d,s));const l=qn(a),c=new Map(n.map(d=>[d.id,d.name]));return a.map(d=>Un(d,c,l))}function Qn(e,n){if(e.length%2===0)return null;const t=new Set;for(const r of n.rounds)r.byePlayerId&&t.add(r.byePlayerId);for(let r=e.length-1;r>=0;r--){const s=e[r];if(s&&!t.has(s.playerId))return s.playerId}return e.at(-1)?.playerId??null}function Oe(e,n,t,r,s){if(e.length===0)return[];const o=e[0];if(!o)return null;for(let i=1;i<e.length;i++){const a=e[i];if(!a||n.get(o)?.has(a))continue;const l=e.filter((d,u)=>u!==0&&u!==i),c=Oe(l,n,t,r);if(c!==null)return[A(t.nextId(r),{player1Id:o,player2Id:a}),...c]}return null}function jt(e){const{schedule:n,players:t}=e,r=n.rounds.length+1,s="sw",o=q(n.rounds.reduce((h,p)=>h+p.matches.length,0)),i=Vn(n,t),a=Qn(i,n),l=Bn(n),c=i.map(h=>h.playerId).filter(h=>h!==a),d=Oe(c,l,o,s);let u;if(d===null){u=[];for(let h=0;h<c.length-1;h+=2){const p=c[h],I=c[h+1];!p||!I||u.push(A(o.nextId(s),{player1Id:p,player2Id:I}))}}else u=d;return{roundNumber:r,byePlayerId:a,matches:u}}function Yn(e){const n=e.rounds.at(-1);return n?n.matches.every(t=>t.winnerId!==null):!1}function Ft(e){return Yn(e.schedule)&&e.schedule.rounds.length>=e.totalRounds}function Ct(e){return e.map((n,t)=>({playerId:n.playerId,name:n.name,rankStart:t+1,rankEnd:t+1}))}const Ge=q();function z(e){return Ge.nextId(e)}function Kn(e,n){const t=new Map;for(const r of e.rounds)for(const s of r){const o=`${n}${s.id}`;t.set(s.id,o),s.id=o}for(const r of e.rounds)for(const s of r)s.nextMatchId&&(s.nextMatchId=t.get(s.nextMatchId)??s.nextMatchId)}function C(e,n){for(const t of e){const r=t.find(s=>s.id===n&&!W(s));if(r)return r}return null}function pe(e,n){const t=C(e.winners.rounds,n);if(t)return{section:"winners",match:t};const r=C(e.losers.rounds,n);return r?{section:"losers",match:r}:e.finals.grandFinal.id===n?{section:"finals",match:e.finals.grandFinal}:e.finals.resetFinal.id===n?{section:"finals",match:e.finals.resetFinal}:null}function Xn(e){return e.rounds.at(-1)?.[0]??null}function _e(e){return e?.winnerId&&e.player1Id&&e.player2Id?e.winnerId===e.player1Id?e.player2Id:e.player1Id:null}function re(e){return!e||W(e)?!1:e.winnerId?!0:!e.player1Id&&!e.player2Id}function Ee(e){return!e||W(e)?!1:!!e.winnerId||e.walkover||e.scores.length>0}function Jn(e){const n=[],t={},r=e[0];if(!r)return{firstRound:n,loserLinks:t};for(let s=0;s<r.length;s+=2){const o=r[s],i=r[s+1];if(!o||!i)continue;const a={...A(z("l-"),{position:s/2}),winnersSources:[o.id,i.id]};n.push(a),t[o.id]={matchId:a.id,slot:"player1Id"},t[i.id]={matchId:a.id,slot:"player2Id"},n.push({id:"",player1Id:null,player2Id:null,winnersSources:[],scores:[],winnerId:null,walkover:!1,position:n.length,dummy:!0})}return{firstRound:n,loserLinks:t}}function Zn(e,n,t){const r=[];for(let s=n;s<=e.length;s+=1){const o=s-1,i=e[o];if(!i)continue;const a=i.length,l=[];for(let c=0;c<a;c+=1){const u=(c%2===0?"player1Id":"player2Id")==="player1Id"?"player2Id":"player1Id",h=i[c];if(!h)continue;const p={...A(z("l-"),{position:c}),winnersSources:[h.id],loserSlotFromWinners:u};l.push(p),t[h.id]={matchId:p.id,slot:u}}if(r.push(l),s<e.length){const c=[];for(let d=0;d<l.length;d+=2)c.push({...A(z("l-"),{position:d/2})});r.push(c)}}return r}function et(e){for(let n=0;n<e.length-1;n+=1){const t=e[n+1];if(!Array.isArray(t)||t.length===0)continue;const r=e[n];if(!Array.isArray(r)||r.length===0)continue;const s=(n+1)%2===1,o=r.filter(a=>!W(a)),i=t.filter(a=>!W(a));for(const[a,l]of o.entries()){const c=s?a:Math.floor(a/2);l.nextMatchId=i[c]?.id??null}}}function nt(e){const n=[],t=e.rounds;if(t.length<=1)return{rounds:n,loserLinks:{}};const{firstRound:r,loserLinks:s}=Jn(t);r.length>0&&n.push(r);const o=Zn(t,2,s);for(const i of o)n.push(i);return et(n),{rounds:n,loserLinks:s}}function F(e){e&&(e.winnerId=null,e.scores=[],e.walkover=!1)}function tt(e,n,t){if(W(e)||e.winnerId||!e.winnersSources||e.winnersSources.length===0||e.player1Id&&e.player2Id||!e.player1Id&&!e.player2Id||!e.winnersSources.every(s=>{const o=C(t,s);return re(o)}))return!1;if(n){const s=n.find(o=>o.nextMatchId===e.id&&!W(o));if(s&&!re(s))return!1}return!0}function rt(e,n){for(let t=1;t<n.rounds.length;t++){const r=n.rounds[t];if(r)for(const s of r){if(W(s)||!tt(s,n.rounds[t-1],e.rounds))continue;const o=s.player1Id??s.player2Id;o&&$(n,s.id,o,[])}}}function st(e){const{winners:n,losers:t,loserLinks:r}=e;it(n,t,r),at(n,t),rt(n,t)}function ot(e){const{winners:n,losers:t,finals:r}=e,s=le(n),o=Xn(n),i=t.rounds.length>0?le(t):_e(o),a=r.grandFinal,l=r.resetFinal,c=s??null,d=i??null;(c!==a.player1Id||d!==a.player2Id)&&(F(a),F(l),a.player1Id=c,a.player2Id=d),!!a.winnerId&&!!s&&a.winnerId!==s?(l.player1Id!==a.player1Id||l.player2Id!==a.player2Id)&&(F(l),l.player1Id=a.player1Id,l.player2Id=a.player2Id):(l.player1Id||l.player2Id||Ee(l))&&(F(l),l.player1Id=null,l.player2Id=null)}function he(e){return st(e),ot(e),e}function We(e){Ge.reset();const n=ie(e);Kn(n,"w-");const{rounds:t,loserLinks:r}=nt(n),s={rounds:t},o={grandFinal:A(z("f-"),{position:0}),resetFinal:A(z("f-"),{position:1})},i={winners:n,losers:s,finals:o,loserLinks:r};return he(i),i}function Ht(e,n,t,r,s=!1){const o=pe(e,n);return o&&(o.section==="winners"?$(e.winners,n,t,r,s):o.section==="losers"?$(e.losers,n,t,r,s):(n===e.finals.grandFinal.id&&(F(e.finals.resetFinal),e.finals.resetFinal.player1Id=null,e.finals.resetFinal.player2Id=null),o.match.winnerId=t,o.match.scores=r,o.match.walkover=s),he(e)),e}function Bt(e,n){const t=pe(e,n);return t&&(t.section==="winners"?ce(e.winners,n):t.section==="losers"?ce(e.losers,n):(F(t.match),e.finals.grandFinal.id===n&&(F(e.finals.resetFinal),e.finals.resetFinal.player1Id=null,e.finals.resetFinal.player2Id=null)),he(e)),e}function Ot(e){const n=e.finals.resetFinal,t=e.finals.grandFinal,r=le(e.winners);return n.winnerId?n.winnerId:t.winnerId&&r&&t.winnerId===r?t.winnerId:null}function Gt(e,n){const t=e.finals.resetFinal.winnerId??e.finals.grandFinal.winnerId,r=pe(e,n);return r?r.section==="finals"?!0:t?!1:r.section==="losers"?ae(e.losers,n):ae(e.winners,n):!1}function it(e,n,t){for(const[r,s]of Object.entries(t)){const o=C(e.rounds,r),i=C(n.rounds,s.matchId);if(!o||!i||W(i))continue;const a=_e(o),l=s.slot==="player1Id"?i.player1Id:i.player2Id;a!==l&&(Ee(i)&&ce(n,i.id),s.slot==="player1Id"?i.player1Id=a??null:i.player2Id=a??null)}}function at(e,n){const t=n.rounds[0]??[];for(const r of t){if(W(r)||r.winnersSources?.length!==2)continue;const s=r.winnersSources[0],o=r.winnersSources[1];if(!s||!o)continue;const i=C(e.rounds,s),a=C(e.rounds,o);!re(i)||!re(a)||(!r.winnerId&&r.player1Id&&!r.player2Id?$(n,r.id,r.player1Id,[]):!r.winnerId&&!r.player1Id&&r.player2Id&&$(n,r.id,r.player2Id,[]))}}const oe="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function lt(e){let n=Math.max(0,e),t="";do t=(oe[n%oe.length]??"A")+t,n=Math.floor(n/oe.length)-1;while(n>=0);return t}function J(e){return Number.isFinite(e)?e:1e3}function $e(e,n){return Array.from({length:n},(t,r)=>{const s=e?.[r];return Math.max(0,Number(s)||0)})}function Pe(e){const n=Number(e);return Number.isFinite(n)?n:Number.POSITIVE_INFINITY}function ct(e,n){const t=e.map((s,o)=>({player:s,index:o})).toSorted((s,o)=>{const i=Pe(s.player.seed),a=Pe(o.player.seed);return i!==a?i-a:s.index-o.index}).map(({player:s})=>s),r=Array.from({length:n},(s,o)=>({id:`g${o+1}`,name:`Group ${lt(o)}`,playerIds:[]}));for(const[s,o]of t.entries()){const i=r[s%n];i&&i.playerIds.push(o.id)}return r}function _t(e,n,t){const r=Math.max(1,Number.parseInt(n.groupCount,10)||1),s=$e(n.qualifiers,t?.length??r);return{groups:(t??ct(e,r)).map((a,l)=>{const c=e.filter(u=>a.playerIds.includes(u.id)),d=kn(c,{idPrefix:`${a.id}-`});return{...a,schedule:d,order:l+1}}),settings:{groupCount:r,qualifiers:s,consolation:!!n.consolation,bracketType:n.bracketType??O.SINGLE_ELIM}}}function ze(e,n){return n.filter(t=>e.playerIds.includes(t.id))}function Et(e,n,t={}){return e.groups.map(r=>{const s=ze(r,n),o=Be(r.schedule,s,t);return{groupId:r.id,standings:o}})}function $t(e){return e.groups.every(n=>Cn(n.schedule))}function dt(e){const n=e.played||0,t=n>0?n:1,r=e.pointsWon-e.pointsLost;return{pointsPct:e.points/t,setDiffPerMatch:(e.setsWon-e.setsLost)/t,setsWonPerMatch:e.setsWon/t,pointsDiffPerMatch:r/t,played:n}}function ut(e=""){let n=5381;for(let t=0;t<e.length;t+=1)n=n*33^(e.codePointAt(t)??0);return n>>>0}function ft(e){const n=`${e.id}|${e.groupId}`;return ut(n)/4294967295}function pt(e,n){const t=e.tiebreakDetails,r=n.tiebreakDetails;return r.setsWonPerMatch!==t.setsWonPerMatch?r.setsWonPerMatch-t.setsWonPerMatch:r.setDiffPerMatch!==t.setDiffPerMatch?r.setDiffPerMatch-t.setDiffPerMatch:t.pointsDiffApplicable&&r.pointsDiffApplicable&&r.pointsDiffPerMatch!==t.pointsDiffPerMatch?r.pointsDiffPerMatch-t.pointsDiffPerMatch:t.opponentAvgRank!==r.opponentAvgRank?t.opponentAvgRank-r.opponentAvgRank:t.relativeRank!==r.relativeRank?t.relativeRank-r.relativeRank:t.fairPlay!==r.fairPlay?t.fairPlay?-1:1:0}function De(e){const n=e.tiebreakDetails;return[n.setsWonPerMatch,n.setDiffPerMatch,n.pointsDiffApplicable?n.pointsDiffPerMatch:null,n.opponentAvgRank,n.relativeRank,n.fairPlay].map(r=>Number.isFinite(r)?r.toFixed(6):typeof r=="boolean"?String(r):"n/a").join("|")}function ht(e,n){if(!n)return[];const t=e.tiebreakDetails,r=n.tiebreakDetails,s=["setsWonPerMatch","setDiffPerMatch","pointsDiffPerMatch","opponentAvgRank","relativeRank","fairPlay"],o=[];for(const i of s){if(i==="pointsDiffPerMatch"&&!t.pointsDiffApplicable)continue;const a=t[i],l=r[i];let c=0;if(i==="opponentAvgRank"||i==="relativeRank")c=a-l;else if(i==="fairPlay"){const d=t.fairPlay?1:0;c=(r.fairPlay?1:0)-d}else c=l-a;if(c===0){o.push(i);continue}return o.push(i),o}return t.lotteryUsed&&o.push("lottery"),o}function yt(e){const n=new Map,t=new Map;for(const r of e.rounds)for(const s of r.matches){if(!s.winnerId)continue;const o=s.player1Id,i=s.player2Id;!o||!i||(n.has(o)||n.set(o,new Set),n.has(i)||n.set(i,new Set),n.get(o)?.add(i),n.get(i)?.add(o),(s.walkover||fe(s.scores))&&(t.set(o,!0),t.set(i,!0)))}return{opponentsByPlayer:n,walkoverByPlayer:t}}function It(e,n,t,r,s){const o=ze(e,n),i=Be(e.schedule,o,s),a=i.length||1,l=new Map(i.map((p,I)=>[p.playerId,I+1])),{opponentsByPlayer:c,walkoverByPlayer:d}=yt(e.schedule),u=[],h=[];for(const[p,I]of i.entries()){const M=n.find(H=>H.id===I.playerId);if(!M)continue;const g=dt(I),x={setsWonPerMatch:g.setsWonPerMatch,setDiffPerMatch:g.setDiffPerMatch,pointsDiffPerMatch:g.pointsDiffPerMatch,opponentAvgRank:xt(I.playerId,c,l,a),relativeRank:(p+1)/a,fairPlay:!d.get(I.playerId),pointsDiffApplicable:r,lottery:null,lotteryUsed:!1},R={...M,groupId:e.id,groupRank:p+1,stats:I,normalized:g,tiebreakDetails:x};p<t?u.push({...R,advanceType:"qualifier"}):h.push({...R,advanceType:"nonQualifier"})}return{main:u,nonQualifiers:h}}function mt(e,n){let t=0;for(;t<e.length;){let r=t+1;const s=e[t];if(!s)break;const o=De(s);for(;r<e.length;){const i=e[r];if(!i||De(i)!==o)break;r+=1}if(r-t>1){const i=e.slice(t,r).map(a=>(a.tiebreakDetails.lottery=ft(a),a.tiebreakDetails.lotteryUsed=!0,a));i.toSorted((a,l)=>(a.tiebreakDetails.lottery??0)-(l.tiebreakDetails.lottery??0));for(const[a,l]of i.entries())e[t+a]=l}t=r}for(const[r,s]of e.entries()){if(n<=0||e.length<2){s.tiebreakApplied=[];continue}const o=n-1,i=r<=o?o+1:o,a=e[i]??null;s.tiebreakApplied=ht(s,a)}}function gt(e,n,t={}){const r=$e(e.settings.qualifiers,e.groups.length);let s=[];const o=[],i=t.scoringMode===P.POINTS;for(const[p,I]of e.groups.entries()){const M=Math.min(r[p]??0,I.playerIds.length),{main:g,nonQualifiers:x}=It(I,n,M,i,t);s.push(...g),o.push(...x)}s=s.toSorted((p,I)=>p.groupRank!==I.groupRank?p.groupRank-I.groupRank:J(I.elo)-J(p.elo));const a=Fe(s.length||1),l=Math.max(0,a-s.length),c=[...o].toSorted(pt);mt(c,l);const d=c.slice(0,l).map(p=>({...p,advanceType:"lucky"})),u=new Set(d.map(p=>p.id)),h=o.filter(p=>!u.has(p.id)).toSorted((p,I)=>J(I.elo)-J(p.elo));return{main:s,luckyLosers:d,mainWithLucky:[...s,...d],consolation:h,luckyCandidates:c,bracketTargetSize:a,luckyLoserSlots:l}}function zt(e,n,t={}){const{mainWithLucky:r,consolation:s}=gt(e,n,t),o=e.settings.bracketType??O.SINGLE_ELIM,i=o===O.SINGLE_ELIM&&r.length>=2?ie(r):null,a=o===O.DOUBLE_ELIM&&r.length>=2?We(r):null,l=o===O.SINGLE_ELIM&&e.settings.consolation&&s.length>=2?ie(s):null,c=o===O.DOUBLE_ELIM&&e.settings.consolation&&s.length>=2?We(s):null;return{bracketType:o,mainBracket:i,mainDoubleElim:a,consolationBracket:l,consolationDoubleElim:c}}function xt(e,n,t,r){const s=n.get(e);if(!s||s.size===0)return r;let o=0,i=0;for(const a of s){const l=t.get(a)??r;o+=l,i+=1}return i>0?o/i:r}const Ae=({player:e,placement:n,seed:t,isWildCard:r,t:s})=>e?f.jsxs(f.Fragment,{children:[n&&f.jsx("span",{className:"mr-2 text-[10px] font-semibold text-[var(--color-muted)]",children:n}),t&&f.jsx("span",{className:"mr-2 text-[10px] font-semibold text-[var(--color-muted)]",children:t}),e.name,r&&f.jsx(tn,{variant:"accent",className:"ml-2 text-[10px] px-1.5 py-0.5",children:s("groupStage.wildCardBadge")}),e.elo!=null&&f.jsx("span",{className:"ml-2 font-normal text-[10px] text-[var(--color-muted)]",children:s("players.elo",{elo:e.elo})})]}):null,St=({entries:e})=>f.jsx("span",{className:"text-[10px] text-[var(--color-faint)] font-mono whitespace-pre text-right",children:e.map((n,t)=>f.jsxs("span",{className:n.isWin?"font-semibold text-[var(--color-text)]":"",children:[t>0?" ":"",n.text]},t))}),Ne=({showPoints:e,setPointEntries:n,isWalkover:t,sets:r})=>f.jsxs("span",{className:"ml-2 text-[var(--color-muted)] flex items-center gap-2",children:[e&&n.length>0&&f.jsx(St,{entries:n}),f.jsx("span",{className:"text-[var(--color-faintest)]",children:"|"}),f.jsx("span",{children:t?"WO":r})]}),Re=(e,n)=>e?"?":n("bracket.bye"),wt=({match:e,players:n,canEdit:t,onClick:r,wildCardIds:s,scoringMode:o=P.SETS,maxSets:i,roundIndex:a,groupPlacementByPlayerId:l,showSeedNumbers:c})=>{const{t:d}=ue(),u=n.find(T=>T.id===e.player1Id),h=n.find(T=>T.id===e.player2Id),p=u&&s?.has(u.id),I=h&&s?.has(h.id),M=!e.player1Id||!e.player2Id,g=e.player1Id&&e.player2Id&&t,x=o===P.POINTS,{p1Sets:R,p2Sets:H}=E(e.scores,{scoringMode:o,maxSets:i}),B=e.walkover||fe(e.scores),k=x?ve(e.scores):[],N=x?ve(e.scores,{swapped:!0}):[],U=a===0&&l,V=U&&u?l.get(u.id)??null:null,se=U&&h?l.get(h.id)??null:null,Q=c&&a===0,Y=Q&&u?.seed!=null?String(u.seed):null,K=Q&&h?.seed!=null?String(h.seed):null;return f.jsxs("div",{onClick:g?r:void 0,className:`border rounded-lg text-xs w-52 overflow-hidden bg-[var(--color-card)] transition-all duration-150 ${g?"cursor-pointer hover:border-[var(--color-primary)] hover:shadow-md hover:-translate-y-px":""} ${M?"opacity-40":"border-[var(--color-border)]"}`,role:g?"button":void 0,tabIndex:g?0:void 0,"aria-disabled":!g,"aria-label":g?d("bracket.editMatch"):void 0,onKeyDown:g?T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),r&&r())}:void 0,children:[f.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 border-b border-[var(--color-border-soft)] ${e.winnerId===e.player1Id?"bg-[var(--color-soft)] font-semibold border-l-3 border-l-[var(--color-primary)]":""}`,children:[f.jsx("span",{className:"truncate flex-1",children:u?f.jsx(Ae,{player:u,placement:V,seed:Y,isWildCard:p,t:d}):Re(e.player1Id,d)}),e.winnerId&&f.jsx(Ne,{showPoints:x,setPointEntries:k,isWalkover:B,sets:R})]}),f.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 ${e.winnerId===e.player2Id?"bg-[var(--color-soft)] font-semibold border-l-3 border-l-[var(--color-primary)]":""}`,children:[f.jsx("span",{className:"truncate flex-1",children:h?f.jsx(Ae,{player:h,placement:se,seed:K,isWildCard:I,t:d}):Re(e.player2Id,d)}),e.winnerId&&f.jsx(Ne,{showPoints:x,setPointEntries:N,isWalkover:B,sets:H})]})]})},bt=64,Te=8,vt=({match:e,roundIndex:n,matchHeight:t,players:r,bracket:s,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:l,canEditMatchFn:c,groupPlacementByPlayerId:d,showSeedNumbers:u})=>{if(e.dummy)return f.jsx("div",{className:"flex items-center invisible dummy",style:{height:`${t}px`}},`dummy-${n}-${e.position}`);const h=c?c(s,e.id):ae(s,e.id);return f.jsx("div",{className:"flex items-center",style:{height:`${t}px`},children:f.jsx(wt,{match:e,players:r,canEdit:h,wildCardIds:l,scoringMode:i,maxSets:a,roundIndex:n,groupPlacementByPlayerId:d,showSeedNumbers:u,onClick:()=>o?.(e)})})},Mt=({round:e,roundIndex:n,roundLabel:t,players:r,bracket:s,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:l,canEditMatchFn:c,groupPlacementByPlayerId:d,showSeedNumbers:u})=>{const h=bt*Math.pow(2,n),p=Te*Math.pow(2,n),I=Te/2*(Math.pow(2,n)-1);return f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-3 whitespace-nowrap uppercase tracking-wider",children:t}),f.jsx("div",{className:"flex flex-col",style:{gap:`${p}px`,paddingTop:`${I}px`},children:e.map(M=>f.jsx(vt,{match:M,roundIndex:n,matchHeight:h,players:r,bracket:s,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:l,canEditMatchFn:c,groupPlacementByPlayerId:d,showSeedNumbers:u},M.dummy?`dummy-${n}-${M.position}`:M.id))})]})},qt=({bracket:e,players:n,onEditMatch:t,scoringMode:r,maxSets:s,wildCardIds:o,canEditMatchFn:i,groupPlacementByPlayerId:a,showSeedNumbers:l})=>{const{t:c}=ue();if(!e)return null;const d=e.rounds.map((u,h)=>{const p=e.rounds.length;return h===p-1?c("bracket.final"):h===p-2?c("bracket.semifinals"):h===p-3?c("bracket.quarterfinals"):c("bracket.round",{n:h+1})});return f.jsx("div",{className:"overflow-x-auto pb-2",children:f.jsx("div",{className:"flex gap-1 items-start min-w-fit",children:e.rounds.map((u,h)=>f.jsx(Mt,{round:u,roundIndex:h,roundLabel:d[h],players:n,bracket:e,onEditMatch:t,scoringMode:r,maxSets:s,wildCardIds:o,canEditMatchFn:i,groupPlacementByPlayerId:a,showSeedNumbers:l},h))})})};export{gt as A,qt as B,He as C,zt as D,Vn as E,Yn as F,Ft as G,Ct as H,de as I,jt as J,Ce as L,wt as M,Nt as S,We as a,Lt as b,Tt as c,ct as d,_t as e,kn as f,ie as g,le as h,lt as i,Be as j,Ot as k,ae as l,$ as m,ce as n,Gt as o,Ht as p,Bt as q,fe as r,E as s,D as t,te as u,Rt as v,Cn as w,ze as x,Et as y,$t as z};
