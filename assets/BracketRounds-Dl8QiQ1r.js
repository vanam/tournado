import{S as j,C as Me,b as Te,D as Re,c as ke,B as Pe}from"./ConfirmModal-DMEH6cWt.js";import{r as L,j as u}from"./react-vendor-DmXkgcPG.js";import{c as Y,b as De,u as Z,D as oe,B as P}from"./index-B-xkjx0h.js";import{l as me,m as ye,n as He}from"./radix-ui-BYwnsWBt.js";import{b as Ce}from"./icons-CuKFc0l-.js";function X(e=0){let n=e;return{nextId(t=""){return n+=1,t+String(n)},reset(){n=e}}}function D(e,n={}){return{id:e,player1Id:null,player2Id:null,scores:[],winnerId:null,walkover:!1,nextMatchId:null,dummy:!1,...n}}function Le(e){let n=1;for(;n<e;)n*=2;return n}function E(e){return e?.dummy??!1}function Be(e){if(e===1)return[0];const n=Array.from({length:e}),t=e/2,s=[];for(let r=1;r<=t;r+=2)s.push(r);for(let r=2;r<=t;r+=2)s.push(r);for(const[r,o]of s.entries()){const i=o-1,a=e-o;n[i]=r*2,n[a]=r*2+1}return n}const ie=X();function Ee(e,n,t){const s=Array.from({length:n},()=>null);for(let r=0;r<n;r++){const o=t[r];if(o!==void 0&&r<e.length){const i=e[r];i&&(s[o]=i.id)}}return s}function Fe(e,n){const t=[];for(let s=0;s<e.length;s+=2){const r=e[s]??null,o=e[s+1]??null;t.push(D(n(),{player1Id:r,player2Id:o,position:s/2}))}return t}function Oe(e){for(const n of e)n.player1Id&&!n.player2Id?n.winnerId=n.player1Id:!n.player1Id&&n.player2Id&&(n.winnerId=n.player2Id)}function _e(e,n,t){for(let s=1;s<n;s++){const r=e[s-1];if(!r)continue;const o=[];for(let i=0;i<r.length;i+=2){const a=r[i],c=r[i+1];if(!a||!c)continue;const l=D(t(),{player1Id:a.winnerId??null,player2Id:c.winnerId??null,position:i/2});a.nextMatchId=l.id,c.nextMatchId=l.id;const d=!!a.winnerId||!a.player1Id&&!a.player2Id,f=!!c.winnerId||!c.player1Id&&!c.player2Id;d&&f&&(l.player1Id&&!l.player2Id?l.winnerId=l.player1Id:!l.player1Id&&l.player2Id&&(l.winnerId=l.player2Id)),o.push(l)}e.push(o)}}function $e(e,n){return e>=2?D(n()):null}function Ln(e){ie.reset();const n=e.length,t=Le(n),s=Math.log2(t),r=Be(t),o=()=>ie.nextId("m"),i=Ee(e,t,r),a=[],c=Fe(i,o);Oe(c),a.push(c),_e(a,s,o);const l=$e(s,o);return{rounds:a,thirdPlaceMatch:l}}function ze(e,n){let t=0;for(const s of e){const r=s.find(o=>o.id===n)??null;if(r)return{match:r,roundIndex:t};t++}return{match:null,roundIndex:-1}}function ae(e,n,t,s){e.winnerId=n,e.scores=t,e.walkover=s}function Ge(e,n,t,s){const r=e.rounds.length-2;if(e.thirdPlaceMatch&&s===r){const o=n.player1Id===t?n.player2Id:n.player1Id;n.position===0?e.thirdPlaceMatch.player1Id=o:e.thirdPlaceMatch.player2Id=o}}function qe(e,n){if(!n)return null;for(const[t,s]of e.entries()){const r=s.find(o=>o.id===n&&!E(o));if(r)return{match:r,roundIndex:t}}return null}function Ue(e,n){return e.filter(s=>!E(s)).findIndex(s=>s.id===n)}function Ve(e,n,t){n%2===0?e.player1Id=t:e.player2Id=t}function Ye(e,n,t){const s=n.filter(l=>!E(l)),r=Math.floor(t/2)*2,o=s[r],i=s[r+1],a=!o||!!o.winnerId||!o.player1Id&&!o.player2Id,c=!i||!!i.winnerId||!i.player1Id&&!i.player2Id;a&&c&&(e.player1Id&&!e.player2Id?e.winnerId=e.player1Id:!e.player1Id&&e.player2Id&&(e.winnerId=e.player2Id))}function Ke(e,n,t){const s=e.rounds;let r=n,o=t;for(;r.nextMatchId;){const i=qe(s,r.nextMatchId);if(!i||i.roundIndex<=o)break;const a=i.match,c=i.roundIndex,l=s[c-1];if(!l)break;const d=Ue(l,r.id);if(d===-1||(Ve(a,d,r.winnerId),Ye(a,l,d),!a.winnerId))break;r=a,o=c}}function Bn(e,n,t,s,r=!1){if(n===e.thirdPlaceMatch?.id)return ae(e.thirdPlaceMatch,t,s,r),e;const{match:o,roundIndex:i}=ze(e.rounds,n);return o&&(ae(o,t,s,r),Ge(e,o,t,i),Ke(e,o,i)),e}function Xe(e,n){if(n===e.thirdPlaceMatch?.id)return!!(e.thirdPlaceMatch.player1Id&&e.thirdPlaceMatch.player2Id);for(let t=0;t<e.rounds.length;t++){const s=e.rounds[t];if(!s)continue;const r=s.find(o=>o.id===n);if(r){if(!r.nextMatchId)return!0;for(let o=t+1;o<e.rounds.length;o++){const i=e.rounds[o];if(!i)continue;const a=i.find(c=>c.id===r.nextMatchId);if(a)return!a.winnerId}return!0}}return!1}function En(e){const n=e.rounds.at(-1);if(!n)return null;if(n.length===1){const t=n[0];if(!t)return null;if(t.winnerId)return t.winnerId}return null}function Je(e,n){for(const[t,s]of e.rounds.entries()){if(!Array.isArray(s)||s.length===0)continue;const r=s.findIndex(o=>o.id===n);if(r!==-1)return{match:s[r]??null,roundIndex:t}}return{match:null,roundIndex:-1}}function U(e){e.winnerId=null,e.scores=[],e.walkover=!1}function Qe(e,n,t){let s=n,r=t;for(;s.nextMatchId;){let o=null,i=-1;for(let d=r+1;d<e.rounds.length;d++){const f=e.rounds[d];if(!f)continue;const p=f.findIndex(m=>m.id===s.nextMatchId&&!E(m));if(p!==-1){o=f[p]??null,i=d;break}}if(!o)break;const a=e.rounds[i-1];if(!a)break;const l=a.filter(d=>!E(d)).findIndex(d=>d.id===s.id);l!==-1&&(l%2===0?o.player1Id=null:o.player2Id=null),U(o),s=o,r=i}}function Fn(e,n){if(n===e.thirdPlaceMatch?.id)return U(e.thirdPlaceMatch),e;const{match:t,roundIndex:s}=Je(e,n);if(!t)return e;U(t);const r=e.rounds.length-2;return e.thirdPlaceMatch&&s===r&&(t.position===0?e.thirdPlaceMatch.player1Id=null:e.thirdPlaceMatch.player2Id=null,U(e.thirdPlaceMatch)),Qe(e,t,s),e}const Q=L.forwardRef(({className:e,type:n,...t},s)=>u.jsx("input",{type:n,className:Y("flex h-10 w-full rounded-lg border border-[var(--color-border)] bg-background text-foreground px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-primary)] disabled:cursor-not-allowed disabled:opacity-40 md:text-sm",e),ref:s,...t}));Q.displayName="Input";const Ze=De("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),xe=L.forwardRef(({className:e,...n},t)=>u.jsx(me,{ref:t,className:Y(Ze(),e),...n}));xe.displayName=me.displayName;const Ie=L.forwardRef(({className:e,...n},t)=>u.jsx(ye,{ref:t,className:Y("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...n,children:u.jsx(He,{className:Y("grid place-content-center text-current"),children:u.jsx(Ce,{className:"h-4 w-4"})})}));Ie.displayName=ye.displayName;const x=111;function en(e,n){return e?e.winnerIndex===0?n.player1Id:n.player2Id:null}function nn(e,n,t,s,r){if(!e)return"";if(e===n.player1Id){let i=t?.name??"";return t?.elo!=null&&r&&(i+=` (${r("players.elo",{elo:t.elo})})`),i}let o=s?.name??"";return s?.elo!=null&&r&&(o+=` (${r("players.elo",{elo:s.elo})})`),o}const On=({match:e,players:n,onSave:t,onClose:s,scoringMode:r=j.SETS,maxSets:o=oe})=>{const{t:i}=Z(),a=Number.isFinite(o)&&o>0?o:oe,c=n.find(h=>h.id===e.player1Id),l=n.find(h=>h.id===e.player2Id),d=r===j.SETS,f=d,p=(()=>{if(e.scores.length>0){if(d){const{p1Sets:h,p2Sets:y}=B(e.scores,{scoringMode:j.SETS,maxSets:a});return[[h,y]]}return e.scores.map(h=>[...h])}return[[0,0]]})(),[m,v]=L.useState(p),[A,w]=L.useState(!1),[g,R]=L.useState(f?e.walkover:!1);function F(h){if(d||!Array.isArray(h))return null;for(const[y,S]of h.entries()){if(!Array.isArray(S))continue;const I=K(S[0],S[1]);if(I===1||I===2)return{index:y,winnerIndex:I-1}}return null}function H(h){if(d||!Array.isArray(h))return h;const y=F(h);if(!y)return h;const S=y.winnerIndex===0?[x,0]:[0,x];return h.map((I,b)=>{const k=Array.isArray(I)?I:[0,0];return b<y.index?[...k]:[...S]})}const W=F(m),M=B(m,{scoringMode:r,maxSets:a}),O=en(W,e),_=d?M.p1Sets+M.p2Sets>0:!0,J=g?M.p1Sets!==M.p2Sets&&_:!0,$=!g||_&&J;function z(h,y,S){if(g&&!d||!d&&W&&h>=W.index)return;const I=Number.parseInt(S,10),b=Number.isFinite(I)?I:0,k=d?a:x,te=Math.min(Math.max(0,b),k),se=m.map(Ae=>[...Ae]),re=se[h];re&&(re[y]=te),v(H(se))}function G(h,y,S){if(W&&h>W.index)return;const I=m.map(b=>[...b]);if(S)I[h]=y===0?[x,0]:[0,x];else{I[h]=[0,0];for(let b=h+1;b<I.length;b++){const k=I[b];if(!k)continue;K(k[0],k[1])!==0&&(I[b]=[0,0])}}v(H(I))}function T(h){f&&R(h)}function be(){if(!(m.length>=a)){if(W){const h=W.winnerIndex===0?[x,0]:[0,x];v([...m,[...h]]);return}v([...m,[0,0]])}}function ve(h){m.length>1&&!W&&v(m.filter((y,S)=>S!==h))}function ee(){if(!d&&W)return O;if(f&&g)return $?M.p1Sets>M.p2Sets?e.player1Id:M.p2Sets>M.p1Sets?e.player2Id:null:null;const{p1Sets:h,p2Sets:y}=M;return h>y?e.player1Id:y>h?e.player2Id:null}function ne(){const h=ee();if(!h)return;const y=f&&g,S=m[0]??[0,0],I=d?[[S[0],S[1]]]:H(m).map(b=>[b[0],b[1]]);t(e.id,h,I,y)}function we(){w(!0)}function We(){w(!1),t(e.id,null,[],!1)}function Ne(){w(!1)}const q=ee(),je=!!e.winnerId||e.scores.length>0||e.walkover||ge(e.scores);return u.jsxs(u.Fragment,{children:[A&&u.jsx(Me,{title:i("score.clearTitle"),message:i("score.clearMessage"),confirmLabel:i("score.clear"),cancelLabel:i("score.cancel"),onConfirm:We,onCancel:Ne}),u.jsx(Te,{open:!0,onOpenChange:h=>{h||s()},onPrimaryAction:ne,primaryActionDisabled:!q,children:u.jsxs(Re,{className:"max-w-md","aria-describedby":void 0,children:[u.jsx(ke,{className:"text-lg font-bold mb-5 pb-3 border-b border-[var(--color-border-soft)]",children:i("score.title")}),u.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center mb-4",children:[u.jsx("div",{className:"text-right font-medium text-xs sm:text-sm min-w-0 truncate",children:c?u.jsxs(u.Fragment,{children:[c.name,c.elo!=null&&u.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:c.elo})})]}):null}),u.jsx("div",{className:"text-[var(--color-faint)] text-sm",children:i("score.vs")}),u.jsx("div",{className:"font-medium text-xs sm:text-sm min-w-0 truncate",children:l?u.jsxs(u.Fragment,{children:[l.name,l.elo!=null&&u.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:l.elo})})]}):null})]}),f&&u.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[u.jsx(Ie,{id:"walkover",checked:g,onCheckedChange:h=>{T(h===!0)}}),u.jsx(xe,{htmlFor:"walkover",className:"text-sm text-[var(--color-text)]",children:"WO"})]}),u.jsx("div",{className:"space-y-2 mb-4",children:m.map((h,y)=>{const S=!!(!d&&W&&y>=W.index),I=!!(!d&&W&&y>W.index);return u.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] gap-2 items-center",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Q,{type:"number","aria-label":`${c?.name??""} ${d?i("score.setsResult"):i("score.set",{n:y+1})}`,min:d?0:void 0,max:d?a:x,value:h[0],onChange:b=>{z(y,0,b.target.value)},disabled:S||g&&!d,className:"text-center disabled:bg-[var(--color-soft)]"}),!d&&u.jsx(P,{type:"button",size:"sm",variant:h[0]===x&&h[1]===0?"primary":"primary-outlined",onClick:()=>{G(y,0,!(h[0]===x&&h[1]===0))},disabled:I,className:"px-2 py-1 text-xs",children:"WO"})]}),u.jsx("span",{className:"text-[var(--color-faint)] text-sm",children:d?i("score.setsResult"):i("score.set",{n:y+1})}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Q,{type:"number","aria-label":`${l?.name??""} ${d?i("score.setsResult"):i("score.set",{n:y+1})}`,min:d?0:void 0,max:d?a:x,value:h[1],onChange:b=>{z(y,1,b.target.value)},disabled:S||g&&!d,className:"text-center disabled:bg-[var(--color-soft)]"}),!d&&u.jsx(P,{type:"button",size:"sm",variant:h[1]===x&&h[0]===0?"primary":"primary-outlined",onClick:()=>{G(y,1,!(h[1]===x&&h[0]===0))},disabled:I,className:"px-2 py-1 text-xs",children:"WO"})]}),!d&&m.length>1&&!g&&!W&&u.jsx(P,{variant:"ghost",size:"sm",onClick:()=>{ve(y)},className:"text-[var(--color-accent)] hover:text-[var(--color-primary-dark)]",children:"Ã—"})]},y)})}),!d&&m.length<a&&u.jsx(P,{variant:"link",onClick:be,className:"text-sm mb-4 px-0",children:i("score.addSet")}),q&&u.jsx("p",{className:"text-sm text-[var(--color-primary-dark)] font-medium bg-[var(--color-soft)] rounded-lg px-3 py-2 mb-4",children:i("score.winner",{name:nn(q,e,c,l,i)})}),u.jsxs("div",{className:"flex flex-wrap gap-2 justify-end pt-4 mt-2 border-t border-[var(--color-border-soft)]",children:[je&&u.jsx(P,{variant:"secondary-ghost",onClick:we,children:i("score.clear")}),u.jsx(P,{variant:"primary-ghost",onClick:s,children:i("score.cancel")}),u.jsx(P,{variant:"primary",onClick:ne,disabled:!q,children:i("score.save")})]})]})})]})};function N(e){const n=Number(e);return Number.isFinite(n)&&Math.abs(n)===x}function K(e,n){return!N(e)&&!N(n)||e===x&&n===x||e===-x&&n===-x?0:e===x||n===-x?1:n===x||e===-x?2:0}function ge(e){return Array.isArray(e)?e.some(n=>Array.isArray(n)&&(N(n[0])||N(n[1]))):!1}function B(e,n={}){const{maxSets:t=5,scoringMode:s=j.POINTS}=n;if(!Array.isArray(e)||e.length===0)return{p1Sets:0,p2Sets:0};const r=e.filter(a=>Array.isArray(a));if(r.length===0)return{p1Sets:0,p2Sets:0};if(s===j.SETS){const a=r[0];if(!a)return{p1Sets:0,p2Sets:0};const c=a[0],l=a[1];return Number.isFinite(c)&&Number.isFinite(l)&&c>=0&&l>=0&&c<=t&&l<=t?{p1Sets:c,p2Sets:l}:{p1Sets:0,p2Sets:0}}let o=0,i=0;for(const a of r){const c=a[0],l=a[1],d=K(c,l);if(d===1){o++;continue}if(d===2){i++;continue}c>l?o++:l>c&&i++}return{p1Sets:o,p2Sets:i}}function _n(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return"";const s=e.filter(o=>Array.isArray(o));return s.length===0?"":s.map(o=>{const i=t?o[1]:o[0],a=t?o[0]:o[1];return N(i)||N(a)?"WO":`${i}-${a}`}).join(", ")}function le(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return[];const s=e.filter(r=>Array.isArray(r));return s.length===0?[]:s.map(r=>{const o=r[0],i=r[1];if(N(o)||N(i)){const l=K(o,i);return l===0?null:{text:"WO",isWin:t?l===2:l===1}}const a=t?i:o,c=t?o:i;return!Number.isFinite(a)||!Number.isFinite(c)?null:{text:String(a).padStart(2," "),isWin:a>c}}).filter(r=>r!==null)}function $n(e,n={}){const{idPrefix:t="rr"}=n,s=X();s.reset();function r(){return s.nextId(t)}const o=e.map(f=>f.id);o.length%2!==0&&o.push(null);const i=o.length,a=i-1,c=[],l=o[0];if(l===void 0)return{rounds:[]};const d=o.slice(1);for(let f=0;f<a;f++){const p=[l,...d],m=[];let v=null;for(let w=0;w<i/2;w++){const g=p[w]??null,R=p[i-1-w]??null;if(g==null){v=R;continue}if(R==null){v=g;continue}m.push(D(r(),{player1Id:g,player2Id:R}))}c.push({roundNumber:f+1,byePlayerId:v,matches:m});const A=d.pop();A!==void 0&&d.unshift(A)}return{rounds:c}}function tn(e,n,t,s){if(!e.winnerId)return;const r=e.player1Id,o=e.player2Id;if(!r||!o)return;const i=n[r],a=n[o];if(!i||!a)return;i.played++,a.played++;const{p1Sets:c,p2Sets:l}=B(e.scores,{scoringMode:t,maxSets:s});if(i.setsWon+=c,i.setsLost+=l,a.setsWon+=l,a.setsLost+=c,t===j.POINTS){const d=Array.isArray(e.scores)?e.scores.filter(f=>Array.isArray(f)):[];for(const f of d){const p=f[0],m=f[1];!Number.isFinite(p)||!Number.isFinite(m)||N(p)||N(m)||(i.pointsWon+=p,i.pointsLost+=m,a.pointsWon+=m,a.pointsLost+=p)}}e.winnerId===e.player1Id?(i.wins++,i.points+=1,a.losses++):(a.wins++,a.points+=1,i.losses++)}function sn(e,n){let t=0,s=0;if(n===j.POINTS){const r=Array.isArray(e.scores)?e.scores.filter(o=>Array.isArray(o)):[];for(const o of r){const i=o[0],a=o[1];!Number.isFinite(i)||!Number.isFinite(a)||N(i)||N(a)||(t+=i,s+=a)}}return[t,s]}function rn(e,n,t){const s={};for(const r of e.rounds)for(const o of r.matches){if(!o.winnerId||!o.player1Id||!o.player2Id)continue;const i=[o.player1Id,o.player2Id].toSorted((p,m)=>p.localeCompare(m)).join("-"),{p1Sets:a,p2Sets:c}=B(o.scores,{scoringMode:n,maxSets:t}),[l,d]=sn(o,n),f=o.player1Id.localeCompare(o.player2Id)<0;s[i]={winnerId:o.winnerId,p1Sets:f?a:c,p2Sets:f?c:a,p1Points:f?l:d,p2Points:f?d:l}}return s}function on(e){return[...e].toSorted((n,t)=>{if(t.points!==n.points)return t.points-n.points;const s=n.setsWon-n.setsLost,r=t.setsWon-t.setsLost;return r!==s?r-s:t.setsWon-n.setsWon})}function an(e,n,t){const s={points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const r of n){if(r===e)continue;const o=[e,r].toSorted((c,l)=>c.localeCompare(l)).join("-"),i=t[o];if(!i)continue;const a=e.localeCompare(r)<0;i.winnerId===e&&s.points++,a?(s.setsWon+=i.p1Sets,s.setsLost+=i.p2Sets,s.pointsWon+=i.p1Points,s.pointsLost+=i.p2Points):(s.setsWon+=i.p2Sets,s.setsLost+=i.p1Sets,s.pointsWon+=i.p2Points,s.pointsLost+=i.p1Points)}return s}function ln(e,n,t,s){const r=an(e.playerId,n,t);return{headToHead:r.points,headToHeadSetDiff:r.setsWon-r.setsLost,headToHeadSetsWon:r.setsWon,setDiff:e.setsWon-e.setsLost,setsWon:e.setsWon,pointsDiff:e.pointsWon-e.pointsLost,pointsDiffApplicable:s,tiebreakApplied:[]}}function dn(e,n){return n.headToHead!==e.headToHead?n.headToHead-e.headToHead:n.headToHeadSetDiff!==e.headToHeadSetDiff?n.headToHeadSetDiff-e.headToHeadSetDiff:n.headToHeadSetsWon!==e.headToHeadSetsWon?n.headToHeadSetsWon-e.headToHeadSetsWon:n.setDiff!==e.setDiff?n.setDiff-e.setDiff:n.setsWon!==e.setsWon?n.setsWon-e.setsWon:e.pointsDiffApplicable&&n.pointsDiffApplicable&&n.pointsDiff!==e.pointsDiff?n.pointsDiff-e.pointsDiff:0}function cn(e,n){const t=[];if(e.headToHead!==n.headToHead)return t.push("headToHead"),t;if(t.push("headToHead"),e.headToHeadSetDiff!==n.headToHeadSetDiff)return t.push("headToHeadSetDiff"),t;if(t.push("headToHeadSetDiff"),e.headToHeadSetsWon!==n.headToHeadSetsWon)return t.push("headToHeadSetsWon"),t;if(t.push("headToHeadSetsWon"),e.setDiff!==n.setDiff)return t.push("setDiff"),t;if(t.push("setDiff"),e.setsWon!==n.setsWon)return t.push("setsWon"),t;if(t.push("setsWon"),e.pointsDiffApplicable&&n.pointsDiffApplicable){if(e.pointsDiff!==n.pointsDiff)return t.push("pointsDiff"),t;t.push("pointsDiff")}return t}function un(e,n,t){if(e.length===0)return e;const s=e.map(i=>i.playerId);for(const i of e)i.tiebreakDetails=ln(i,s,n,t);const r=[...e].toSorted((i,a)=>{const c=i.tiebreakDetails,l=a.tiebreakDetails;return!c||!l?0:dn(c,l)});let o=0;for(;o<r.length;){let i=o+1;for(;i<r.length&&r[i]?.points===r[o]?.points;)i++;if(i-o>1){const c=r[o],l=r[i-1];if(c?.tiebreakDetails&&l?.tiebreakDetails){const d=cn(c.tiebreakDetails,l.tiebreakDetails);for(let f=o;f<i;f++){const p=r[f];p?.tiebreakDetails&&(p.tiebreakDetails.tiebreakApplied=d)}}}else{const c=r[o];c?.tiebreakDetails&&(c.tiebreakDetails.tiebreakApplied=[])}o=i}return r}function fn(e,n,t){let s=0;for(;s<e.length;){let r=s+1;const o=e[s];if(!o)break;for(;r<e.length&&e[r]?.points===o.points;)r++;const i=e.slice(s,r),a=un(i,n,t);for(const[c,l]of a.entries())e[s+c]=l;s=r}return e}function zn(e,n,t={}){const{scoringMode:s=j.POINTS,maxSets:r}=t,o={};for(const l of n)o[l.id]={playerId:l.id,name:l.name,elo:typeof l.elo=="number"&&Number.isFinite(l.elo)?l.elo:void 0,played:0,wins:0,losses:0,points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const l of e.rounds)for(const d of l.matches)tn(d,o,s,r);const i=rn(e,s,r),a=s===j.POINTS;let c=Object.values(o);return c=on(c),c=fn(c,i,a),c}function Gn(e){return e.rounds.every(n=>n.matches.every(t=>t.winnerId))}const de="__BYE__";function qn(e){return Math.ceil(Math.log2(e))}function pn(e,n="sw"){const t=X();t.reset();const s=[...e].toSorted((l,d)=>(d.elo??1e3)-(l.elo??1e3)),r=s.length%2!==0;let o=null;r&&(o=s.at(-1)?.id??null);const i=r?s.slice(0,-1):s,a=i.length/2,c=[];for(let l=0;l<a;l++){const d=i[l],f=i[a+l];!d||!f||c.push(D(t.nextId(n),{player1Id:d.id,player2Id:f.id}))}return{roundNumber:1,byePlayerId:o,matches:c}}function Un(e){return{rounds:[pn(e)]}}function hn(e){const n=new Map;function t(s,r){let o=n.get(s);o||(o=new Set,n.set(s,o)),o.add(r)}for(const s of e.rounds){s.byePlayerId&&(t(s.byePlayerId,de),t(de,s.byePlayerId));for(const r of s.matches)r.player1Id&&r.player2Id&&(t(r.player1Id,r.player2Id),t(r.player2Id,r.player1Id))}return n}function ce(){return{wins:0,losses:0,played:0,opponents:[],wonAgainst:new Set,h2hWins:new Map,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0}}function mn(e,n,t){const s=Array.isArray(t)?t.filter(r=>Array.isArray(r)):[];for(const r of s){const o=r[0],i=r[1];!Number.isFinite(o)||!Number.isFinite(i)||N(o)||N(i)||(e.pointsWon+=o,e.pointsLost+=i,n.pointsWon+=i,n.pointsLost+=o)}}function yn(e,n,t,s,r,o){const{scoringMode:i=j.SETS,maxSets:a}=o;e.played+=1,n.played+=1,e.opponents.push(s),n.opponents.push(t);const{p1Sets:c,p2Sets:l}=B(r.scores,{scoringMode:i,maxSets:a});e.setsWon+=c,e.setsLost+=l,n.setsWon+=l,n.setsLost+=c,i===j.POINTS&&mn(e,n,r.scores),r.winnerId===t?(e.wins+=1,n.losses+=1,e.wonAgainst.add(s),e.h2hWins.set(s,(e.h2hWins.get(s)??0)+1)):(n.wins+=1,e.losses+=1,n.wonAgainst.add(t),n.h2hWins.set(t,(n.h2hWins.get(t)??0)+1))}function xn(e,n,t){for(const s of e){if(s.byePlayerId){const r=n.get(s.byePlayerId);r&&(r.wins+=1,t.maxSets!==void 0&&(r.setsWon+=Math.ceil(t.maxSets/2)))}for(const r of s.matches){const{player1Id:o,player2Id:i,winnerId:a}=r;if(!o||!i||!a)continue;const c=n.get(o),l=n.get(i);!c||!l||yn(c,l,o,i,r,t)}}}function In(e,n,t){let s=0,r=0;for(const a of n.opponents)s+=t.get(a)?.wins??0;for(const a of n.wonAgainst)r+=t.get(a)?.wins??0;const o=n.setsWon+n.setsLost,i=n.pointsWon+n.pointsLost;return{playerId:e.id,elo:e.elo,wins:n.wins,losses:n.losses,played:n.played,setsWon:n.setsWon,setsLost:n.setsLost,pointsWon:n.pointsWon,pointsLost:n.pointsLost,buchholz:s,sonnebornBerger:r,setRatio:o>0?n.setsWon/o:0,ballRatio:i>0?n.pointsWon/i:0,headToHead:0}}const V=["buchholz","sonnebornBerger","headToHead","setRatio","ballRatio"];function C(e,n){switch(n){case"buchholz":return e.buchholz;case"sonnebornBerger":return e.sonnebornBerger;case"headToHead":return e.headToHead;case"setRatio":return e.setRatio;case"ballRatio":return e.ballRatio}}function gn(e,n,t){const s=t.get(e);if(!s)return 0;let r=0;for(const[o,i]of s)n.has(o)&&(r+=i);return r}function Sn(e,n){const t=V.indexOf("headToHead"),s=V.slice(0,t);return e.map(o=>{const i=new Set(e.filter(a=>s.every(c=>C(a,c)===C(o,c))).map(a=>a.playerId));return{...o,headToHead:gn(o.playerId,i,n)}}).toSorted((o,i)=>{for(const a of V){const c=C(i,a)-C(o,a);if(c!==0)return c}return(i.elo??1e3)-(o.elo??1e3)})}function bn(e){const n=new Map;for(const t of e)n.set(t.playerId,new Set);for(let t=0;t<e.length-1;t++){const s=e[t],r=e[t+1];if(s?.wins===r?.wins&&!(s===void 0||r===void 0)){for(const o of V)if(n.get(s.playerId)?.add(o),n.get(r.playerId)?.add(o),!(C(s,o)===C(r,o)))break}}return new Map([...n.entries()].map(([t,s])=>[t,[...s]]))}function vn(e,n,t){const s=t.get(e.playerId)??[],r={playerId:e.playerId,name:n.get(e.playerId)??"",elo:e.elo,played:e.played,wins:e.wins,losses:e.losses,points:e.wins,setsWon:e.setsWon,setsLost:e.setsLost,pointsWon:e.pointsWon,pointsLost:e.pointsLost,buchholz:e.buchholz};return s.length>0&&(r.tiebreakDetails={buchholz:e.buchholz,sonnebornBerger:e.sonnebornBerger,headToHead:e.headToHead,setRatio:e.setRatio,ballRatio:e.ballRatio,tiebreakApplied:s}),r}function wn(e,n,t={}){const s=new Map;for(const d of n)s.set(d.id,ce());xn(e.rounds,s,t);const r=new Map,o=[];for(const d of n){const f=s.get(d.id)??ce();r.set(d.id,f.h2hWins),o.push(In(d,f,s))}const i=new Map;for(const d of o){const f=i.get(d.wins);f?f.push(d):i.set(d.wins,[d])}const a=[];for(const[,d]of[...i.entries()].toSorted((f,p)=>p[0]-f[0]))a.push(...Sn(d,r));const c=bn(a),l=new Map(n.map(d=>[d.id,d.name]));return a.map(d=>vn(d,l,c))}function Wn(e,n){if(e.length%2===0)return null;const t=new Set;for(const s of n.rounds)s.byePlayerId&&t.add(s.byePlayerId);for(let s=e.length-1;s>=0;s--){const r=e[s];if(r&&!t.has(r.playerId))return r.playerId}return e.at(-1)?.playerId??null}function Se(e,n,t,s,r){if(e.length===0)return[];const o=e[0];if(!o)return null;for(let i=1;i<e.length;i++){const a=e[i];if(!a||n.get(o)?.has(a))continue;const c=e.filter((d,f)=>f!==0&&f!==i),l=Se(c,n,t,s);if(l!==null)return[D(t.nextId(s),{player1Id:o,player2Id:a}),...l]}return null}function Vn(e){const{schedule:n,players:t}=e,s=n.rounds.length+1,r="sw",o=X(n.rounds.reduce((p,m)=>p+m.matches.length,0)),i=wn(n,t),a=Wn(i,n),c=hn(n),l=i.map(p=>p.playerId).filter(p=>p!==a),d=Se(l,c,o,r);let f;if(d===null){f=[];for(let p=0;p<l.length-1;p+=2){const m=l[p],v=l[p+1];!m||!v||f.push(D(o.nextId(r),{player1Id:m,player2Id:v}))}}else f=d;return{roundNumber:s,byePlayerId:a,matches:f}}function Nn(e){const n=e.rounds.at(-1);return n?n.matches.every(t=>t.winnerId!==null):!1}function Yn(e){return Nn(e.schedule)&&e.schedule.rounds.length>=e.totalRounds}function Kn(e){return e.map((n,t)=>({playerId:n.playerId,name:n.name,rankStart:t+1,rankEnd:t+1}))}const ue=({player:e,placement:n,seed:t,isWildCard:s,t:r})=>e?u.jsxs(u.Fragment,{children:[n&&u.jsx("span",{className:"mr-2 text-[10px] font-semibold text-[var(--color-muted)]",children:n}),t&&u.jsx("span",{className:"mr-2 text-[10px] font-semibold text-[var(--color-muted)]",children:t}),e.name,s&&u.jsx(Pe,{variant:"accent",className:"ml-2 text-[10px] px-1.5 py-0.5",children:r("groupStage.wildCardBadge")}),e.elo!=null&&u.jsx("span",{className:"ml-2 font-normal text-[10px] text-[var(--color-muted)]",children:r("players.elo",{elo:e.elo})})]}):null,jn=({entries:e})=>u.jsx("span",{className:"text-[10px] text-[var(--color-faint)] font-mono whitespace-pre text-right",children:e.map((n,t)=>u.jsxs("span",{className:n.isWin?"font-semibold text-[var(--color-text)]":"",children:[t>0?" ":"",n.text]},t))}),fe=({showPoints:e,setPointEntries:n,isWalkover:t,sets:s})=>u.jsxs("span",{className:"ml-2 text-[var(--color-muted)] flex items-center gap-2",children:[e&&n.length>0&&u.jsx(jn,{entries:n}),u.jsx("span",{className:"text-[var(--color-faintest)]",children:"|"}),u.jsx("span",{className:"font-mono w-2 text-center",children:t?"WO":s})]}),pe=(e,n)=>e?"?":n("bracket.bye"),An=({match:e,players:n,canEdit:t,onClick:s,wildCardIds:r,scoringMode:o=j.SETS,maxSets:i,roundIndex:a,groupPlacementByPlayerId:c,showSeedNumbers:l})=>{const{t:d}=Z(),f=n.find(T=>T.id===e.player1Id),p=n.find(T=>T.id===e.player2Id),m=f&&r?.has(f.id),v=p&&r?.has(p.id),A=!e.player1Id||!e.player2Id,w=e.player1Id&&e.player2Id&&t,g=o===j.POINTS,{p1Sets:R,p2Sets:F}=B(e.scores,{scoringMode:o,maxSets:i}),H=e.walkover||ge(e.scores),W=g?le(e.scores):[],M=g?le(e.scores,{swapped:!0}):[],O=a===0&&c,_=O&&f?c.get(f.id)??null:null,J=O&&p?c.get(p.id)??null:null,$=l&&a===0,z=$&&f?.seed!=null?String(f.seed):null,G=$&&p?.seed!=null?String(p.seed):null;return u.jsxs("div",{onClick:w?s:void 0,className:`border rounded-lg text-xs w-52 overflow-hidden bg-[var(--color-card)] transition-all duration-150 ${w?"cursor-pointer hover:border-[var(--color-primary)] hover:shadow-md hover:-translate-y-px":""} ${A?"opacity-40":"border-[var(--color-border)]"}`,role:w?"button":void 0,tabIndex:w?0:void 0,"aria-disabled":!w,"aria-label":w?d("bracket.editMatch"):void 0,onKeyDown:w?T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),s&&s())}:void 0,children:[u.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 border-b border-[var(--color-border-soft)] ${e.winnerId===e.player1Id?"bg-[var(--color-soft)] font-semibold border-l-3 border-l-[var(--color-primary)]":""}`,children:[u.jsx("span",{className:"truncate flex-1",children:f?u.jsx(ue,{player:f,placement:_,seed:z,isWildCard:m,t:d}):pe(e.player1Id,d)}),e.winnerId&&u.jsx(fe,{showPoints:g,setPointEntries:W,isWalkover:H,sets:R})]}),u.jsxs("div",{className:`flex items-center justify-between px-2 py-1.5 ${e.winnerId===e.player2Id?"bg-[var(--color-soft)] font-semibold border-l-3 border-l-[var(--color-primary)]":""}`,children:[u.jsx("span",{className:"truncate flex-1",children:p?u.jsx(ue,{player:p,placement:J,seed:G,isWildCard:v,t:d}):pe(e.player2Id,d)}),e.winnerId&&u.jsx(fe,{showPoints:g,setPointEntries:M,isWalkover:H,sets:F})]})]})},Mn=64,he=8,Tn=({match:e,roundIndex:n,matchHeight:t,players:s,bracket:r,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:c,canEditMatchFn:l,groupPlacementByPlayerId:d,showSeedNumbers:f})=>{if(e.dummy)return u.jsx("div",{className:"flex items-center invisible dummy",style:{height:`${t}px`}},`dummy-${n}-${e.position}`);const p=l?l(r,e.id):Xe(r,e.id);return u.jsx("div",{className:"flex items-center",style:{height:`${t}px`},children:u.jsx(An,{match:e,players:s,canEdit:p,wildCardIds:c,scoringMode:i,maxSets:a,roundIndex:n,groupPlacementByPlayerId:d,showSeedNumbers:f,onClick:()=>o?.(e)})})},Rn=({round:e,roundIndex:n,roundLabel:t,players:s,bracket:r,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:c,canEditMatchFn:l,groupPlacementByPlayerId:d,showSeedNumbers:f})=>{const p=Mn*Math.pow(2,n),m=he*Math.pow(2,n),v=he/2*(Math.pow(2,n)-1);return u.jsxs("div",{className:"flex flex-col items-center",children:[u.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-3 whitespace-nowrap uppercase tracking-wider",children:t}),u.jsx("div",{className:"flex flex-col",style:{gap:`${m}px`,paddingTop:`${v}px`},children:e.map(A=>u.jsx(Tn,{match:A,roundIndex:n,matchHeight:p,players:s,bracket:r,onEditMatch:o,scoringMode:i,maxSets:a,wildCardIds:c,canEditMatchFn:l,groupPlacementByPlayerId:d,showSeedNumbers:f},A.dummy?`dummy-${n}-${A.position}`:A.id))})]})},Xn=({bracket:e,players:n,onEditMatch:t,scoringMode:s,maxSets:r,wildCardIds:o,canEditMatchFn:i,groupPlacementByPlayerId:a,showSeedNumbers:c})=>{const{t:l}=Z();if(!e)return null;const d=e.rounds.map((f,p)=>{const m=e.rounds.length;return p===m-1?l("bracket.final"):p===m-2?l("bracket.semifinals"):p===m-3?l("bracket.quarterfinals"):l("bracket.round",{n:p+1})});return u.jsx("div",{className:"overflow-x-auto pb-2",children:u.jsx("div",{className:"flex gap-1 items-start min-w-fit",children:e.rounds.map((f,p)=>u.jsx(Rn,{round:f,roundIndex:p,roundLabel:d[p],players:n,bracket:e,onEditMatch:t,scoringMode:s,maxSets:r,wildCardIds:o,canEditMatchFn:i,groupPlacementByPlayerId:a,showSeedNumbers:c},p))})})};export{Xn as B,Ie as C,Q as I,xe as L,An as M,On as S,Un as a,$n as b,qn as c,En as d,zn as e,Xe as f,Ln as g,Bn as h,Fn as i,ge as j,B as k,Gn as l,wn as m,Nn as n,Yn as o,Kn as p,Vn as q,D as r,E as s,X as t,Le as u,N as v,K as w,_n as x};
