import{r as H,j as h}from"./react-vendor-Bgs-6sV-.js";import{c as z,a as _e,u as $e,B as L}from"./index-BFCo89aA.js";import{C as Ee,a as ze,b as qe,c as Ue,D as de,S as P,B as C}from"./ConfirmModal-B4YHOsuj.js";import{l as ge,m as xe,n as Ve}from"./radix-ui-CVrMEJrw.js";import{b as Qe}from"./icons-DzhwDsxK.js";function ee(e=0){let n=e;return{nextId(t=""){return n+=1,t+String(n)},reset(){n=e}}}function N(e,n={}){return{id:e,player1Id:null,player2Id:null,scores:[],winnerId:null,walkover:!1,nextMatchId:null,dummy:!1,...n}}function Se(e){let n=1;for(;n<e;)n*=2;return n}function k(e){return e?.dummy??!1}function Xe(e){if(e===1)return[0];const n=Array.from({length:e}),t=e/2,r=[];for(let s=1;s<=t;s+=2)r.push(s);for(let s=2;s<=t;s+=2)r.push(s);for(const[s,o]of r.entries()){const i=o-1,a=e-o;n[i]=s*2,n[a]=s*2+1}return n}const ue=ee();function Ke(e,n,t){const r=Array.from({length:n},()=>null);for(let s=0;s<n;s++){const o=t[s];if(o!==void 0&&s<e.length){const i=e[s];i&&(r[o]=i.id)}}return r}function Ye(e,n){const t=[];for(let r=0;r<e.length;r+=2){const s=e[r]??null,o=e[r+1]??null;t.push(N(n(),{player1Id:s,player2Id:o,position:r/2}))}return t}function Je(e){for(const n of e)n.player1Id&&!n.player2Id?n.winnerId=n.player1Id:!n.player1Id&&n.player2Id&&(n.winnerId=n.player2Id)}function Ze(e,n,t){for(let r=1;r<n;r++){const s=e[r-1];if(!s)continue;const o=[];for(let i=0;i<s.length;i+=2){const a=s[i],l=s[i+1];if(!a||!l)continue;const c=N(t(),{player1Id:a.winnerId??null,player2Id:l.winnerId??null,position:i/2});a.nextMatchId=c.id,l.nextMatchId=c.id;const f=!!a.winnerId||!a.player1Id&&!a.player2Id,p=!!l.winnerId||!l.player1Id&&!l.player2Id;f&&p&&(c.player1Id&&!c.player2Id?c.winnerId=c.player1Id:!c.player1Id&&c.player2Id&&(c.winnerId=c.player2Id)),o.push(c)}e.push(o)}}function en(e,n){return e>=2?N(n()):null}function K(e){ue.reset();const n=e.length,t=Se(n),r=Math.log2(t),s=Xe(t),o=()=>ue.nextId("m"),i=Ke(e,t,s),a=[],l=Ye(i,o);Je(l),a.push(l),Ze(a,r,o);const c=en(r,o);return{rounds:a,thirdPlaceMatch:c}}function nn(e,n){let t=0;for(const r of e){const s=r.find(o=>o.id===n)??null;if(s)return{match:s,roundIndex:t};t++}return{match:null,roundIndex:-1}}function pe(e,n,t,r){e.winnerId=n,e.scores=t,e.walkover=r}function tn(e,n,t,r){const s=e.rounds.length-2;if(e.thirdPlaceMatch&&r===s){const o=n.player1Id===t?n.player2Id:n.player1Id;n.position===0?e.thirdPlaceMatch.player1Id=o:e.thirdPlaceMatch.player2Id=o}}function rn(e,n){if(!n)return null;for(const[t,r]of e.entries()){const s=r.find(o=>o.id===n&&!k(o));if(s)return{match:s,roundIndex:t}}return null}function sn(e,n){return e.filter(r=>!k(r)).findIndex(r=>r.id===n)}function on(e,n,t){n%2===0?e.player1Id=t:e.player2Id=t}function an(e,n,t){const r=n.filter(c=>!k(c)),s=Math.floor(t/2)*2,o=r[s],i=r[s+1],a=!o||!!o.winnerId||!o.player1Id&&!o.player2Id,l=!i||!!i.winnerId||!i.player1Id&&!i.player2Id;a&&l&&(e.player1Id&&!e.player2Id?e.winnerId=e.player1Id:!e.player1Id&&e.player2Id&&(e.winnerId=e.player2Id))}function ln(e,n,t){const r=e.rounds;let s=n,o=t;for(;s.nextMatchId;){const i=rn(r,s.nextMatchId);if(!i||i.roundIndex<=o)break;const a=i.match,l=i.roundIndex,c=r[l-1];if(!c)break;const f=sn(c,s.id);if(f===-1||(on(a,f,s.winnerId),an(a,c,f),!a.winnerId))break;s=a,o=l}}function B(e,n,t,r,s=!1){if(n===e.thirdPlaceMatch?.id)return pe(e.thirdPlaceMatch,t,r,s),e;const{match:o,roundIndex:i}=nn(e.rounds,n);return o&&(pe(o,t,r,s),tn(e,o,t,i),ln(e,o,i)),e}function he(e,n){if(n===e.thirdPlaceMatch?.id)return!!(e.thirdPlaceMatch.player1Id&&e.thirdPlaceMatch.player2Id);for(let t=0;t<e.rounds.length;t++){const r=e.rounds[t];if(!r)continue;const s=r.find(o=>o.id===n);if(s){if(!s.nextMatchId)return!0;for(let o=t+1;o<e.rounds.length;o++){const i=e.rounds[o];if(!i)continue;const a=i.find(l=>l.id===s.nextMatchId);if(a)return!a.winnerId}return!0}}return!1}function Y(e){const n=e.rounds.at(-1);if(!n)return null;if(n.length===1){const t=n[0];if(!t)return null;if(t.winnerId)return t.winnerId;if(t.player1Id&&!t.player2Id)return t.player1Id;if(!t.player1Id&&t.player2Id)return t.player2Id}return null}function cn(e,n){for(const[t,r]of e.rounds.entries()){if(!Array.isArray(r)||r.length===0)continue;const s=r.findIndex(o=>o.id===n);if(s!==-1)return{match:r[s]??null,roundIndex:t}}return{match:null,roundIndex:-1}}function E(e){e.winnerId=null,e.scores=[],e.walkover=!1}function fn(e,n,t){let r=n,s=t;for(;r.nextMatchId;){let o=null,i=-1;for(let f=s+1;f<e.rounds.length;f++){const p=e.rounds[f];if(!p)continue;const I=p.findIndex(d=>d.id===r.nextMatchId&&!k(d));if(I!==-1){o=p[I]??null,i=f;break}}if(!o)break;const a=e.rounds[i-1];if(!a)break;const c=a.filter(f=>!k(f)).findIndex(f=>f.id===r.id);c!==-1&&(c%2===0?o.player1Id=null:o.player2Id=null),E(o),r=o,s=i}}function J(e,n){if(n===e.thirdPlaceMatch?.id)return E(e.thirdPlaceMatch),e;const{match:t,roundIndex:r}=cn(e,n);if(!t)return e;E(t);const s=e.rounds.length-2;return e.thirdPlaceMatch&&r===s&&(t.position===0?e.thirdPlaceMatch.player1Id=null:e.thirdPlaceMatch.player2Id=null,E(e.thirdPlaceMatch)),fn(e,t,r),e}const Z=H.forwardRef(({className:e,type:n,...t},r)=>h.jsx("input",{type:n,className:z("flex h-10 w-full rounded-lg border border-[var(--color-border)] bg-background text-foreground px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-primary)] disabled:cursor-not-allowed disabled:opacity-40 md:text-sm",e),ref:r,...t}));Z.displayName="Input";const dn=_e("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),we=H.forwardRef(({className:e,...n},t)=>h.jsx(ge,{ref:t,className:z(dn(),e),...n}));we.displayName=ge.displayName;const ve=H.forwardRef(({className:e,...n},t)=>h.jsx(xe,{ref:t,className:z("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...n,children:h.jsx(Ve,{className:z("grid place-content-center text-current"),children:h.jsx(Qe,{className:"h-4 w-4"})})}));ve.displayName=xe.displayName;const g=111;function un(e,n){return e?e.winnerIndex===0?n.player1Id:n.player2Id:null}function pn(e,n,t,r,s){if(!e)return"";if(e===n.player1Id){let i=t?.name??"";return t?.elo!=null&&s&&(i+=` (${s("players.elo",{elo:t.elo})})`),i}let o=r?.name??"";return r?.elo!=null&&s&&(o+=` (${s("players.elo",{elo:r.elo})})`),o}const nt=({match:e,players:n,onSave:t,onClose:r,scoringMode:s=P.SETS,maxSets:o=de})=>{const{t:i}=$e(),a=Number.isFinite(o)&&o>0?o:de,l=n.find(u=>u.id===e.player1Id),c=n.find(u=>u.id===e.player2Id),f=s===P.SETS,p=f,I=(()=>{if(e.scores.length>0){if(f){const{p1Sets:u,p2Sets:y}=U(e.scores,{scoringMode:P.SETS,maxSets:a});return[[u,y]]}return e.scores.map(u=>[...u])}return[[0,0]]})(),[d,m]=H.useState(I),[A,M]=H.useState(!1),[S,R]=H.useState(p?e.walkover:!1);function O(u){if(f||!Array.isArray(u))return null;for(const[y,w]of u.entries()){if(!Array.isArray(w))continue;const x=q(w[0],w[1]);if(x===1||x===2)return{index:y,winnerIndex:x-1}}return null}function Q(u){if(f||!Array.isArray(u))return u;const y=O(u);if(!y)return u;const w=y.winnerIndex===0?[g,0]:[0,g];return u.map((x,v)=>{const T=Array.isArray(x)?x:[0,0];return v<y.index?[...T]:[...w]})}const D=O(d),W=U(d,{scoringMode:s,maxSets:a}),Ne=un(D,e),re=f?W.p1Sets+W.p2Sets>0:!0,Re=S?W.p1Sets!==W.p2Sets&&re:!0,Te=!S||re&&Re;function se(u,y,w){if(S&&!f||!f&&D&&u>=D.index)return;const x=Number.parseInt(w,10),v=Number.isFinite(x)?x:0,T=f?a:g,le=Math.min(Math.max(0,v),T),ce=d.map(Oe=>[...Oe]),fe=ce[u];fe&&(fe[y]=le),m(Q(ce))}function oe(u,y,w){if(D&&u>D.index)return;const x=d.map(v=>[...v]);if(w)x[u]=y===0?[g,0]:[0,g];else{x[u]=[0,0];for(let v=u+1;v<x.length;v++){const T=x[v];if(!T)continue;q(T[0],T[1])!==0&&(x[v]=[0,0])}}m(Q(x))}function Le(u){p&&R(u)}function Fe(){if(!(d.length>=a)){if(D){const u=D.winnerIndex===0?[g,0]:[0,g];m([...d,[...u]]);return}m([...d,[0,0]])}}function je(u){d.length>1&&!D&&m(d.filter((y,w)=>w!==u))}function ie(){if(!f&&D)return Ne;if(p&&S)return Te?W.p1Sets>W.p2Sets?e.player1Id:W.p2Sets>W.p1Sets?e.player2Id:null:null;const{p1Sets:u,p2Sets:y}=W;return u>y?e.player1Id:y>u?e.player2Id:null}function ae(){const u=ie();if(!u)return;const y=p&&S,w=d[0]??[0,0],x=f?[[w[0],w[1]]]:Q(d).map(v=>[v[0],v[1]]);t(e.id,u,x,y)}function Ce(){M(!0)}function He(){M(!1),t(e.id,null,[],!1)}function Be(){M(!1)}const _=ie(),Ge=!!e.winnerId||e.scores.length>0||e.walkover||Me(e.scores);return h.jsxs(h.Fragment,{children:[A&&h.jsx(Ee,{title:i("score.clearTitle"),message:i("score.clearMessage"),confirmLabel:i("score.clear"),cancelLabel:i("score.cancel"),onConfirm:He,onCancel:Be}),h.jsx(ze,{open:!0,onOpenChange:u=>{u||r()},onPrimaryAction:ae,primaryActionDisabled:!_,children:h.jsxs(qe,{className:"max-w-md","aria-describedby":void 0,children:[h.jsx(Ue,{className:"text-lg font-bold mb-5 pb-3 border-b border-[var(--color-border-soft)]",children:i("score.title")}),h.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center mb-4",children:[h.jsx("div",{className:"text-right font-medium text-xs sm:text-sm min-w-0 truncate",children:l?h.jsxs(h.Fragment,{children:[l.name,l.elo!=null&&h.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:l.elo})})]}):null}),h.jsx("div",{className:"text-[var(--color-faint)] text-sm",children:i("score.vs")}),h.jsx("div",{className:"font-medium text-xs sm:text-sm min-w-0 truncate",children:c?h.jsxs(h.Fragment,{children:[c.name,c.elo!=null&&h.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:i("players.elo",{elo:c.elo})})]}):null})]}),p&&h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx(ve,{id:"walkover",checked:S,onCheckedChange:u=>{Le(u===!0)}}),h.jsx(we,{htmlFor:"walkover",className:"text-sm text-[var(--color-text)]",children:"WO"})]}),h.jsx("div",{className:"space-y-2 mb-4",children:d.map((u,y)=>{const w=!!(!f&&D&&y>=D.index),x=!!(!f&&D&&y>D.index);return h.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr_auto] gap-2 items-center",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Z,{type:"number","aria-label":`${l?.name??""} ${f?i("score.setsResult"):i("score.set",{n:y+1})}`,min:f?0:void 0,max:f?a:g,value:u[0],onChange:v=>{se(y,0,v.target.value)},disabled:w||S&&!f,className:"text-center disabled:bg-[var(--color-soft)]"}),!f&&h.jsx(L,{type:"button",size:"sm",variant:u[0]===g&&u[1]===0?"primary":"primary-outlined",onClick:()=>{oe(y,0,!(u[0]===g&&u[1]===0))},disabled:x,className:"px-2 py-1 text-xs",children:"WO"})]}),h.jsx("span",{className:"text-[var(--color-faint)] text-sm",children:f?i("score.setsResult"):i("score.set",{n:y+1})}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Z,{type:"number","aria-label":`${c?.name??""} ${f?i("score.setsResult"):i("score.set",{n:y+1})}`,min:f?0:void 0,max:f?a:g,value:u[1],onChange:v=>{se(y,1,v.target.value)},disabled:w||S&&!f,className:"text-center disabled:bg-[var(--color-soft)]"}),!f&&h.jsx(L,{type:"button",size:"sm",variant:u[1]===g&&u[0]===0?"primary":"primary-outlined",onClick:()=>{oe(y,1,!(u[1]===g&&u[0]===0))},disabled:x,className:"px-2 py-1 text-xs",children:"WO"})]}),!f&&d.length>1&&!S&&!D&&h.jsx(L,{variant:"ghost",size:"sm",onClick:()=>{je(y)},className:"text-[var(--color-accent)] hover:text-[var(--color-primary-dark)]",children:"Ã—"})]},y)})}),!f&&d.length<a&&h.jsx(L,{variant:"link",onClick:Fe,className:"text-sm mb-4 px-0",children:i("score.addSet")}),_&&h.jsx("p",{className:"text-sm text-[var(--color-primary-dark)] font-medium bg-[var(--color-soft)] rounded-lg px-3 py-2 mb-4",children:i("score.winner",{name:pn(_,e,l,c,i)})}),h.jsxs("div",{className:"flex flex-wrap gap-2 justify-end pt-4 mt-2 border-t border-[var(--color-border-soft)]",children:[Ge&&h.jsx(L,{variant:"ghost",onClick:Ce,className:"text-[var(--color-accent)] hover:text-[var(--color-primary-dark)]",children:i("score.clear")}),h.jsx(L,{variant:"ghost",onClick:r,children:i("score.cancel")}),h.jsx(L,{onClick:ae,disabled:!_,children:i("score.save")})]})]})})]})};function b(e){const n=Number(e);return Number.isFinite(n)&&Math.abs(n)===g}function q(e,n){return!b(e)&&!b(n)||e===g&&n===g||e===-g&&n===-g?0:e===g||n===-g?1:n===g||e===-g?2:0}function Me(e){return Array.isArray(e)?e.some(n=>Array.isArray(n)&&(b(n[0])||b(n[1]))):!1}function U(e,n={}){const{maxSets:t=5,scoringMode:r=P.POINTS}=n;if(!Array.isArray(e)||e.length===0)return{p1Sets:0,p2Sets:0};const s=e.filter(a=>Array.isArray(a));if(s.length===0)return{p1Sets:0,p2Sets:0};if(r===P.SETS){const a=s[0];if(!a)return{p1Sets:0,p2Sets:0};const l=a[0],c=a[1];return Number.isFinite(l)&&Number.isFinite(c)&&l>=0&&c>=0&&l<=t&&c<=t?{p1Sets:l,p2Sets:c}:{p1Sets:0,p2Sets:0}}let o=0,i=0;for(const a of s){const l=a[0],c=a[1],f=q(l,c);if(f===1){o++;continue}if(f===2){i++;continue}l>c?o++:c>l&&i++}return{p1Sets:o,p2Sets:i}}function tt(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return"";const r=e.filter(o=>Array.isArray(o));return r.length===0?"":r.map(o=>{const i=t?o[1]:o[0],a=t?o[0]:o[1];return b(i)||b(a)?"WO":`${i}-${a}`}).join(", ")}function rt(e,n={}){const{swapped:t=!1}=n;if(!Array.isArray(e)||e.length===0)return[];const r=e.filter(s=>Array.isArray(s));return r.length===0?[]:r.map(s=>{const o=s[0],i=s[1];if(b(o)||b(i)){const c=q(o,i);return c===0?null:{text:"WO",isWin:t?c===2:c===1}}const a=t?i:o,l=t?o:i;return!Number.isFinite(a)||!Number.isFinite(l)?null:{text:String(a).padStart(2," "),isWin:a>l}}).filter(s=>s!==null)}function hn(e,n={}){const{idPrefix:t="rr"}=n,r=ee();r.reset();function s(){return r.nextId(t)}const o=e.map(p=>p.id);o.length%2!==0&&o.push(null);const i=o.length,a=i-1,l=[],c=o[0];if(c===void 0)return{rounds:[]};const f=o.slice(1);for(let p=0;p<a;p++){const I=[c,...f],d=[];let m=null;for(let M=0;M<i/2;M++){const S=I[M]??null,R=I[i-1-M]??null;if(S==null){m=R;continue}if(R==null){m=S;continue}d.push(N(s(),{player1Id:S,player2Id:R}))}l.push({roundNumber:p+1,byePlayerId:m,matches:d});const A=f.pop();A!==void 0&&f.unshift(A)}return{rounds:l}}function yn(e,n,t,r){if(!e.winnerId)return;const s=e.player1Id,o=e.player2Id;if(!s||!o)return;const i=n[s],a=n[o];if(!i||!a)return;i.played++,a.played++;const{p1Sets:l,p2Sets:c}=U(e.scores,{scoringMode:t,maxSets:r});if(i.setsWon+=l,i.setsLost+=c,a.setsWon+=c,a.setsLost+=l,t===P.POINTS){const f=Array.isArray(e.scores)?e.scores.filter(p=>Array.isArray(p)):[];for(const p of f){const I=p[0],d=p[1];!Number.isFinite(I)||!Number.isFinite(d)||b(I)||b(d)||(i.pointsWon+=I,i.pointsLost+=d,a.pointsWon+=d,a.pointsLost+=I)}}e.winnerId===e.player1Id?(i.wins++,i.points+=1,a.losses++):(a.wins++,a.points+=1,i.losses++)}function In(e,n){let t=0,r=0;if(n===P.POINTS){const s=Array.isArray(e.scores)?e.scores.filter(o=>Array.isArray(o)):[];for(const o of s){const i=o[0],a=o[1];!Number.isFinite(i)||!Number.isFinite(a)||b(i)||b(a)||(t+=i,r+=a)}}return[t,r]}function mn(e,n,t){const r={};for(const s of e.rounds)for(const o of s.matches){if(!o.winnerId||!o.player1Id||!o.player2Id)continue;const i=[o.player1Id,o.player2Id].toSorted((I,d)=>I.localeCompare(d)).join("-"),{p1Sets:a,p2Sets:l}=U(o.scores,{scoringMode:n,maxSets:t}),[c,f]=In(o,n),p=o.player1Id.localeCompare(o.player2Id)<0;r[i]={winnerId:o.winnerId,p1Sets:p?a:l,p2Sets:p?l:a,p1Points:p?c:f,p2Points:p?f:c}}return r}function gn(e){return[...e].toSorted((n,t)=>{if(t.points!==n.points)return t.points-n.points;const r=n.setsWon-n.setsLost,s=t.setsWon-t.setsLost;return s!==r?s-r:t.setsWon-n.setsWon})}function xn(e,n,t){const r={points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const s of n){if(s===e)continue;const o=[e,s].toSorted((l,c)=>l.localeCompare(c)).join("-"),i=t[o];if(!i)continue;const a=e.localeCompare(s)<0;i.winnerId===e&&r.points++,a?(r.setsWon+=i.p1Sets,r.setsLost+=i.p2Sets,r.pointsWon+=i.p1Points,r.pointsLost+=i.p2Points):(r.setsWon+=i.p2Sets,r.setsLost+=i.p1Sets,r.pointsWon+=i.p2Points,r.pointsLost+=i.p1Points)}return r}function Sn(e,n,t,r){const s=xn(e.playerId,n,t);return{headToHead:s.points,headToHeadSetDiff:s.setsWon-s.setsLost,headToHeadSetsWon:s.setsWon,setDiff:e.setsWon-e.setsLost,setsWon:e.setsWon,pointsDiff:e.pointsWon-e.pointsLost,pointsDiffApplicable:r,tiebreakApplied:[]}}function wn(e,n){return n.headToHead!==e.headToHead?n.headToHead-e.headToHead:n.headToHeadSetDiff!==e.headToHeadSetDiff?n.headToHeadSetDiff-e.headToHeadSetDiff:n.headToHeadSetsWon!==e.headToHeadSetsWon?n.headToHeadSetsWon-e.headToHeadSetsWon:n.setDiff!==e.setDiff?n.setDiff-e.setDiff:n.setsWon!==e.setsWon?n.setsWon-e.setsWon:e.pointsDiffApplicable&&n.pointsDiffApplicable&&n.pointsDiff!==e.pointsDiff?n.pointsDiff-e.pointsDiff:0}function vn(e,n){const t=[];if(e.headToHead!==n.headToHead)return t.push("headToHead"),t;if(t.push("headToHead"),e.headToHeadSetDiff!==n.headToHeadSetDiff)return t.push("headToHeadSetDiff"),t;if(t.push("headToHeadSetDiff"),e.headToHeadSetsWon!==n.headToHeadSetsWon)return t.push("headToHeadSetsWon"),t;if(t.push("headToHeadSetsWon"),e.setDiff!==n.setDiff)return t.push("setDiff"),t;if(t.push("setDiff"),e.setsWon!==n.setsWon)return t.push("setsWon"),t;if(t.push("setsWon"),e.pointsDiffApplicable&&n.pointsDiffApplicable){if(e.pointsDiff!==n.pointsDiff)return t.push("pointsDiff"),t;t.push("pointsDiff")}return t}function Mn(e,n,t){if(e.length===0)return e;const r=e.map(i=>i.playerId);for(const i of e)i.tiebreakDetails=Sn(i,r,n,t);const s=[...e].toSorted((i,a)=>{const l=i.tiebreakDetails,c=a.tiebreakDetails;return!l||!c?0:wn(l,c)});let o=0;for(;o<s.length;){let i=o+1;for(;i<s.length&&s[i]?.points===s[o]?.points;)i++;if(i-o>1){const l=s[o],c=s[i-1];if(l?.tiebreakDetails&&c?.tiebreakDetails){const f=vn(l.tiebreakDetails,c.tiebreakDetails);for(let p=o;p<i;p++){const I=s[p];I?.tiebreakDetails&&(I.tiebreakDetails.tiebreakApplied=f)}}}else{const l=s[o];l?.tiebreakDetails&&(l.tiebreakDetails.tiebreakApplied=[])}o=i}return s}function kn(e,n,t){let r=0;for(;r<e.length;){let s=r+1;const o=e[r];if(!o)break;for(;s<e.length&&e[s]?.points===o.points;)s++;const i=e.slice(r,s),a=Mn(i,n,t);for(const[l,c]of a.entries())e[r+l]=c;r=s}return e}function ke(e,n,t={}){const{scoringMode:r=P.POINTS,maxSets:s}=t,o={};for(const c of n)o[c.id]={playerId:c.id,name:c.name,elo:typeof c.elo=="number"&&Number.isFinite(c.elo)?c.elo:void 0,played:0,wins:0,losses:0,points:0,setsWon:0,setsLost:0,pointsWon:0,pointsLost:0};for(const c of e.rounds)for(const f of c.matches)yn(f,o,r,s);const i=mn(e,r,s),a=r===P.POINTS;let l=Object.values(o);return l=gn(l),l=kn(l,i,a),l}function Dn(e){return e.rounds.every(n=>n.matches.every(t=>t.winnerId))}const De=ee();function G(e){return De.nextId(e)}function bn(e,n){const t=new Map;for(const r of e.rounds)for(const s of r){const o=`${n}${s.id}`;t.set(s.id,o),s.id=o}for(const r of e.rounds)for(const s of r)s.nextMatchId&&(s.nextMatchId=t.get(s.nextMatchId)??s.nextMatchId)}function j(e,n){for(const t of e){const r=t.find(s=>s.id===n&&!k(s));if(r)return r}return null}function ne(e,n){const t=j(e.winners.rounds,n);if(t)return{section:"winners",match:t};const r=j(e.losers.rounds,n);return r?{section:"losers",match:r}:e.finals.grandFinal.id===n?{section:"finals",match:e.finals.grandFinal}:e.finals.resetFinal.id===n?{section:"finals",match:e.finals.resetFinal}:null}function Pn(e){return e.rounds.at(-1)?.[0]??null}function be(e){return e?.winnerId&&e.player1Id&&e.player2Id?e.winnerId===e.player1Id?e.player2Id:e.player1Id:null}function V(e){return!e||k(e)?!1:e.winnerId?!0:!e.player1Id&&!e.player2Id}function Pe(e){return!e||k(e)?!1:!!e.winnerId||e.walkover||e.scores.length>0}function An(e){const n=[],t={},r=e[0];if(!r)return{firstRound:n,loserLinks:t};for(let s=0;s<r.length;s+=2){const o=r[s],i=r[s+1];if(!o||!i)continue;const a={...N(G("l-"),{position:s/2}),winnersSources:[o.id,i.id]};n.push(a),t[o.id]={matchId:a.id,slot:"player1Id"},t[i.id]={matchId:a.id,slot:"player2Id"},n.push({id:"",player1Id:null,player2Id:null,winnersSources:[],scores:[],winnerId:null,walkover:!1,position:n.length,dummy:!0})}return{firstRound:n,loserLinks:t}}function Wn(e,n,t){const r=[];for(let s=n;s<=e.length;s+=1){const o=s-1,i=e[o];if(!i)continue;const a=i.length,l=[];for(let c=0;c<a;c+=1){const p=(c%2===0?"player1Id":"player2Id")==="player1Id"?"player2Id":"player1Id",I=i[c];if(!I)continue;const d={...N(G("l-"),{position:c}),winnersSources:[I.id],loserSlotFromWinners:p};l.push(d),t[I.id]={matchId:d.id,slot:p}}if(r.push(l),s<e.length){const c=[];for(let f=0;f<l.length;f+=2)c.push({...N(G("l-"),{position:f/2})});r.push(c)}}return r}function Nn(e){for(let n=0;n<e.length-1;n+=1){const t=e[n+1];if(!Array.isArray(t)||t.length===0)continue;const r=e[n];if(!Array.isArray(r)||r.length===0)continue;const s=(n+1)%2===1,o=r.filter(a=>!k(a)),i=t.filter(a=>!k(a));for(const[a,l]of o.entries()){const c=s?a:Math.floor(a/2);l.nextMatchId=i[c]?.id??null}}}function Rn(e){const n=[],t=e.rounds;if(t.length<=1)return{rounds:n,loserLinks:{}};const{firstRound:r,loserLinks:s}=An(t);r.length>0&&n.push(r);const o=Wn(t,2,s);for(const i of o)n.push(i);return Nn(n),{rounds:n,loserLinks:s}}function F(e){e&&(e.winnerId=null,e.scores=[],e.walkover=!1)}function Tn(e,n,t){if(k(e)||e.winnerId||!e.winnersSources||e.winnersSources.length===0||e.player1Id&&e.player2Id||!e.player1Id&&!e.player2Id||!e.winnersSources.every(s=>{const o=j(t,s);return V(o)}))return!1;if(n){const s=n.find(o=>o.nextMatchId===e.id&&!k(o));if(s&&!V(s))return!1}return!0}function Ln(e,n){for(let t=1;t<n.rounds.length;t++){const r=n.rounds[t];if(r)for(const s of r){if(k(s)||!Tn(s,n.rounds[t-1],e.rounds))continue;const o=s.player1Id??s.player2Id;o&&B(n,s.id,o,[])}}}function Fn(e){const{winners:n,losers:t,loserLinks:r}=e;Cn(n,t,r),Hn(n,t),Ln(n,t)}function jn(e){const{winners:n,losers:t,finals:r}=e,s=Y(n),o=Pn(n),i=t.rounds.length>0?Y(t):be(o),a=r.grandFinal,l=r.resetFinal,c=s??null,f=i??null;(c!==a.player1Id||f!==a.player2Id)&&(F(a),F(l),a.player1Id=c,a.player2Id=f),!!a.winnerId&&!!s&&a.winnerId!==s?(l.player1Id!==a.player1Id||l.player2Id!==a.player2Id)&&(F(l),l.player1Id=a.player1Id,l.player2Id=a.player2Id):(l.player1Id||l.player2Id||Pe(l))&&(F(l),l.player1Id=null,l.player2Id=null)}function te(e){return Fn(e),jn(e),e}function ye(e){De.reset();const n=K(e);bn(n,"w-");const{rounds:t,loserLinks:r}=Rn(n),s={rounds:t},o={grandFinal:N(G("f-"),{position:0}),resetFinal:N(G("f-"),{position:1})},i={winners:n,losers:s,finals:o,loserLinks:r};return te(i),i}function st(e,n,t,r,s=!1){const o=ne(e,n);return o&&(o.section==="winners"?B(e.winners,n,t,r,s):o.section==="losers"?B(e.losers,n,t,r,s):(n===e.finals.grandFinal.id&&(F(e.finals.resetFinal),e.finals.resetFinal.player1Id=null,e.finals.resetFinal.player2Id=null),o.match.winnerId=t,o.match.scores=r,o.match.walkover=s),te(e)),e}function ot(e,n){const t=ne(e,n);return t&&(t.section==="winners"?J(e.winners,n):t.section==="losers"?J(e.losers,n):(F(t.match),e.finals.grandFinal.id===n&&(F(e.finals.resetFinal),e.finals.resetFinal.player1Id=null,e.finals.resetFinal.player2Id=null)),te(e)),e}function it(e){const n=e.finals.resetFinal,t=e.finals.grandFinal,r=Y(e.winners);return n.winnerId?n.winnerId:t.winnerId&&r&&t.winnerId===r?t.winnerId:null}function at(e,n){const t=e.finals.resetFinal.winnerId??e.finals.grandFinal.winnerId,r=ne(e,n);return r?r.section==="finals"?!0:t?!1:r.section==="losers"?he(e.losers,n):he(e.winners,n):!1}function Cn(e,n,t){for(const[r,s]of Object.entries(t)){const o=j(e.rounds,r),i=j(n.rounds,s.matchId);if(!o||!i||k(i))continue;const a=be(o),l=s.slot==="player1Id"?i.player1Id:i.player2Id;a!==l&&(Pe(i)&&J(n,i.id),s.slot==="player1Id"?i.player1Id=a??null:i.player2Id=a??null)}}function Hn(e,n){const t=n.rounds[0]??[];for(const r of t){if(k(r)||r.winnersSources?.length!==2)continue;const s=r.winnersSources[0],o=r.winnersSources[1];if(!s||!o)continue;const i=j(e.rounds,s),a=j(e.rounds,o);!V(i)||!V(a)||(!r.winnerId&&r.player1Id&&!r.player2Id?B(n,r.id,r.player1Id,[]):!r.winnerId&&!r.player1Id&&r.player2Id&&B(n,r.id,r.player2Id,[]))}}const X="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function Bn(e){let n=Math.max(0,e),t="";do t=(X[n%X.length]??"A")+t,n=Math.floor(n/X.length)-1;while(n>=0);return t}function $(e){return Number.isFinite(e)?e:1e3}function Ae(e,n){return Array.from({length:n},(t,r)=>{const s=e?.[r];return Math.max(0,Number(s)||0)})}function Ie(e){const n=Number(e);return Number.isFinite(n)?n:Number.POSITIVE_INFINITY}function Gn(e,n){const t=e.map((s,o)=>({player:s,index:o})).toSorted((s,o)=>{const i=Ie(s.player.seed),a=Ie(o.player.seed);return i!==a?i-a:s.index-o.index}).map(({player:s})=>s),r=Array.from({length:n},(s,o)=>({id:`g${o+1}`,name:`Group ${Bn(o)}`,playerIds:[]}));for(const[s,o]of t.entries()){const i=r[s%n];i&&i.playerIds.push(o.id)}return r}function lt(e,n){const t=Math.max(1,Number.parseInt(n.groupCount,10)||1),r=Ae(n.qualifiers,t);return{groups:Gn(e,t).map((i,a)=>{const l=e.filter(f=>i.playerIds.includes(f.id)),c=hn(l,{idPrefix:`${i.id}-`});return{...i,schedule:c,order:a+1}}),settings:{groupCount:t,qualifiers:r,consolation:!!n.consolation,bracketType:n.bracketType??C.SINGLE_ELIM}}}function We(e,n){return n.filter(t=>e.playerIds.includes(t.id))}function ct(e,n,t={}){return e.groups.map(r=>{const s=We(r,n),o=ke(r.schedule,s,t);return{groupId:r.id,standings:o}})}function ft(e){return e.groups.every(n=>Dn(n.schedule))}function On(e){const n=e.played||0,t=n>0?n:1,r=e.pointsWon-e.pointsLost;return{pointsPct:e.points/t,setDiffPerMatch:(e.setsWon-e.setsLost)/t,setsWonPerMatch:e.setsWon/t,pointsDiffPerMatch:r/t,played:n}}function _n(e=""){let n=5381;for(let t=0;t<e.length;t+=1)n=n*33^(e.codePointAt(t)??0);return n>>>0}function $n(e){const n=`${e.id}|${e.groupId}`;return _n(n)/4294967295}function En(e,n){const t=e.tiebreakDetails,r=n.tiebreakDetails;return r.setsWonPerMatch!==t.setsWonPerMatch?r.setsWonPerMatch-t.setsWonPerMatch:r.setDiffPerMatch!==t.setDiffPerMatch?r.setDiffPerMatch-t.setDiffPerMatch:t.pointsDiffApplicable&&r.pointsDiffApplicable&&r.pointsDiffPerMatch!==t.pointsDiffPerMatch?r.pointsDiffPerMatch-t.pointsDiffPerMatch:t.opponentAvgRank!==r.opponentAvgRank?t.opponentAvgRank-r.opponentAvgRank:t.relativeRank!==r.relativeRank?t.relativeRank-r.relativeRank:t.fairPlay!==r.fairPlay?t.fairPlay?-1:1:0}function me(e){const n=e.tiebreakDetails;return[n.setsWonPerMatch,n.setDiffPerMatch,n.pointsDiffApplicable?n.pointsDiffPerMatch:null,n.opponentAvgRank,n.relativeRank,n.fairPlay].map(r=>Number.isFinite(r)?r.toFixed(6):typeof r=="boolean"?String(r):"n/a").join("|")}function zn(e,n){if(!n)return[];const t=e.tiebreakDetails,r=n.tiebreakDetails,s=["setsWonPerMatch","setDiffPerMatch","pointsDiffPerMatch","opponentAvgRank","relativeRank","fairPlay"],o=[];for(const i of s){if(i==="pointsDiffPerMatch"&&!t.pointsDiffApplicable)continue;const a=t[i],l=r[i];let c=0;if(i==="opponentAvgRank"||i==="relativeRank")c=a-l;else if(i==="fairPlay"){const f=t.fairPlay?1:0;c=(r.fairPlay?1:0)-f}else c=l-a;if(c===0){o.push(i);continue}return o.push(i),o}return t.lotteryUsed&&o.push("lottery"),o}function qn(e){const n=new Map,t=new Map;for(const r of e.rounds)for(const s of r.matches){if(!s.winnerId)continue;const o=s.player1Id,i=s.player2Id;!o||!i||(n.has(o)||n.set(o,new Set),n.has(i)||n.set(i,new Set),n.get(o)?.add(i),n.get(i)?.add(o),(s.walkover||Me(s.scores))&&(t.set(o,!0),t.set(i,!0)))}return{opponentsByPlayer:n,walkoverByPlayer:t}}function Un(e,n,t,r,s){const o=We(e,n),i=ke(e.schedule,o,s),a=i.length||1,l=new Map(i.map((d,m)=>[d.playerId,m+1])),{opponentsByPlayer:c,walkoverByPlayer:f}=qn(e.schedule),p=[],I=[];for(const[d,m]of i.entries()){const A=n.find(O=>O.id===m.playerId);if(!A)continue;const M=On(m),S={setsWonPerMatch:M.setsWonPerMatch,setDiffPerMatch:M.setDiffPerMatch,pointsDiffPerMatch:M.pointsDiffPerMatch,opponentAvgRank:Xn(m.playerId,c,l,a),relativeRank:(d+1)/a,fairPlay:!f.get(m.playerId),pointsDiffApplicable:r,lottery:null,lotteryUsed:!1},R={...A,groupId:e.id,groupRank:d+1,stats:m,normalized:M,tiebreakDetails:S};d<t?p.push({...R,advanceType:"qualifier"}):I.push({...R,advanceType:"nonQualifier"})}return{main:p,nonQualifiers:I}}function Vn(e,n){let t=0;for(;t<e.length;){let r=t+1;const s=e[t];if(!s)break;const o=me(s);for(;r<e.length;){const i=e[r];if(!i||me(i)!==o)break;r+=1}if(r-t>1){const i=e.slice(t,r).map(a=>(a.tiebreakDetails.lottery=$n(a),a.tiebreakDetails.lotteryUsed=!0,a));i.toSorted((a,l)=>(a.tiebreakDetails.lottery??0)-(l.tiebreakDetails.lottery??0));for(const[a,l]of i.entries())e[t+a]=l}t=r}for(const[r,s]of e.entries()){if(n<=0||e.length<2){s.tiebreakApplied=[];continue}const o=n-1,i=r<=o?o+1:o,a=e[i]??null;s.tiebreakApplied=zn(s,a)}}function Qn(e,n,t={}){const r=Ae(e.settings.qualifiers,e.groups.length);let s=[];const o=[],i=t.scoringMode===P.POINTS;for(const[d,m]of e.groups.entries()){const A=Math.min(r[d]??0,m.playerIds.length),{main:M,nonQualifiers:S}=Un(m,n,A,i,t);s.push(...M),o.push(...S)}s=s.toSorted((d,m)=>d.groupRank!==m.groupRank?d.groupRank-m.groupRank:$(m.elo)-$(d.elo));const a=Se(s.length||1),l=Math.max(0,a-s.length),c=[...o].toSorted(En);Vn(c,l);const f=c.slice(0,l).map(d=>({...d,advanceType:"lucky"})),p=new Set(f.map(d=>d.id)),I=o.filter(d=>!p.has(d.id)).toSorted((d,m)=>$(m.elo)-$(d.elo));return{main:s,luckyLosers:f,mainWithLucky:[...s,...f],consolation:I,luckyCandidates:c,bracketTargetSize:a,luckyLoserSlots:l}}function dt(e,n,t={}){const{mainWithLucky:r,consolation:s}=Qn(e,n,t),o=e.settings.bracketType??C.SINGLE_ELIM,i=o===C.SINGLE_ELIM&&r.length>=2?K(r):null,a=o===C.DOUBLE_ELIM&&r.length>=2?ye(r):null,l=o===C.SINGLE_ELIM&&e.settings.consolation&&s.length>=2?K(s):null,c=o===C.DOUBLE_ELIM&&e.settings.consolation&&s.length>=2?ye(s):null;return{bracketType:o,mainBracket:i,mainDoubleElim:a,consolationBracket:l,consolationDoubleElim:c}}function Xn(e,n,t,r){const s=n.get(e);if(!s||s.size===0)return r;let o=0,i=0;for(const a of s){const l=t.get(a)??r;o+=l,i+=1}return i>0?o/i:r}export{ve as C,Z as I,we as L,nt as S,hn as a,K as b,lt as c,U as d,he as e,rt as f,ye as g,Me as h,Bn as i,Y as j,ke as k,it as l,B as m,J as n,at as o,st as p,ot as q,b as r,q as s,tt as t,Dn as u,We as v,ct as w,ft as x,Qn as y,dt as z};
