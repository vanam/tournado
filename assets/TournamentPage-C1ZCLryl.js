import{r as p,j as t,m as ct,L as z,h as dt}from"./react-vendor-B7IL4Whh.js";import{F as L,p as X,S as E,B as ut,a as Ne}from"./ConfirmModal-CEqukME9.js";import{c as C,u as N,D as V,B as Z,a as mt}from"./index-jECjWpKM.js";import{u as xt}from"./usePageTitle-CxFjUuTI.js";import{e as ee,f as ue,h as te,B as q,M as J,j as Pe,S as re,k as Fe,l as We,m as U,n as Le,o as He,p as me,q as Oe,r as ne,s as Ae,t as ft,u as ke,i as be,v as $e,w as pt,x as Ge,y as ht,z as Se}from"./BracketRounds-Ce68CqFe.js";import{c as _e,d as Ie,b as bt,X as gt,e as jt,f as yt}from"./icons-kaZEYU8o.js";import{h as vt,i as Ue,j as qe,k as Je}from"./radix-ui-BObq5o7x.js";import"./notifications-B5Q4qzS0.js";const Ke=p.createContext(null);function se(){const e=p.useContext(Ke);if(!e)throw new Error("useTournament must be used within TournamentProvider");return e}function ge(e){const{tournament:n,updateTournament:r,isLoading:s}=se(),a=n?.format===e?n:null,l=p.useCallback(i=>{r(o=>o.format!==e?o:i(o))},[r,e]);return{tournament:a,updateTournament:l,isLoading:s}}function Nt(){const{tournament:e,updateTournament:n,isLoading:r}=se(),s=e?.format===L.GROUPS_TO_BRACKET?e:null,a=p.useCallback(l=>{n(i=>i.format!==L.GROUPS_TO_BRACKET?i:typeof l=="function"?l(i):l)},[n]);return{tournament:s,updateTournament:a,isLoading:r}}const kt=({tournamentId:e,children:n})=>{const r=p.useSyncExternalStore(X.subscribe,p.useCallback(()=>X.load(e),[e])),s=p.useCallback(l=>{const i=X.load(e);i&&X.save(l(i))},[e]),a=p.useMemo(()=>({tournament:r,updateTournament:s,isLoading:!1}),[r,s]);return t.jsx(Ke.Provider,{value:a,children:n})},ae=({label:e})=>e?t.jsx("div",{className:"mb-6 bg-[var(--color-accent-soft)] border border-[var(--color-accent-border)] rounded-xl p-5 shadow-sm text-center",children:t.jsxs("p",{className:"text-xl font-bold text-[var(--color-accent)] tracking-wide",children:[t.jsx(_e,{className:"h-6 w-6 inline-block mr-2 text-[var(--color-accent)]"}),e]})}):null,St=vt,ze=p.forwardRef(({className:e,...n},r)=>t.jsx(Ue,{ref:r,className:C("inline-flex h-10 items-center justify-start rounded-md bg-muted p-1 text-muted-foreground",e),...n}));ze.displayName=Ue.displayName;const Ve=p.forwardRef(({className:e,...n},r)=>t.jsx(qe,{ref:r,className:C("inline-flex items-center justify-center whitespace-nowrap px-4 py-2.5 text-sm font-medium","border-b-2 border-transparent -mb-px transition-all","disabled:pointer-events-none disabled:opacity-40","data-[state=active]:border-[var(--color-primary)] data-[state=active]:text-[var(--color-primary)]","data-[state=inactive]:text-[var(--color-muted)] data-[state=inactive]:hover:bg-[var(--color-soft)] data-[state=inactive]:hover:rounded-sm hover:text-[var(--color-text)]",e),...n}));Ve.displayName=qe.displayName;const It=p.forwardRef(({className:e,...n},r)=>t.jsx(Je,{ref:r,className:C("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...n}));It.displayName=Je.displayName;const Y=({tabs:e,activeId:n,onChange:r,className:s=""})=>{const a=l=>{r(l)};return t.jsx(St,{value:n,onValueChange:a,className:s,children:t.jsx(ze,{className:`flex gap-1 mb-4 border-b border-[var(--color-border-soft)] overflow-x-auto overflow-y-hidden bg-transparent h-auto p-0 rounded-none ${s}`.trim(),children:e.map(l=>t.jsx(Ve,{value:l.id,className:"flex-shrink-0",children:l.label},l.id))})})},oe=p.forwardRef(({className:e,...n},r)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:r,className:C("w-full caption-bottom text-sm",e),...n})}));oe.displayName="Table";const ie=p.forwardRef(({className:e,...n},r)=>t.jsx("thead",{ref:r,className:C("[&_tr]:border-b",e),...n}));ie.displayName="TableHeader";const le=p.forwardRef(({className:e,...n},r)=>t.jsx("tbody",{ref:r,className:C("[&_tr:last-child]:border-0",e),...n}));le.displayName="TableBody";const wt=p.forwardRef(({className:e,...n},r)=>t.jsx("tfoot",{ref:r,className:C("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...n}));wt.displayName="TableFooter";const H=p.forwardRef(({className:e,...n},r)=>t.jsx("tr",{ref:r,className:C("border-b border-[var(--color-border-soft)] transition-colors hover:bg-[var(--color-soft)] data-[state=selected]:bg-muted",e),...n}));H.displayName="TableRow";const M=p.forwardRef(({className:e,...n},r)=>t.jsx("th",{ref:r,className:C("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...n}));M.displayName="TableHead";const k=p.forwardRef(({className:e,...n},r)=>t.jsx("td",{ref:r,className:C("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...n}));k.displayName="TableCell";const Tt=p.forwardRef(({className:e,...n},r)=>t.jsx("caption",{ref:r,className:C("mt-4 text-sm text-muted-foreground",e),...n}));Tt.displayName="TableCaption";function Et(e,n){return e==null?"?":e===n||n==null?`${e}.`:`${e}.-${n}.`}function Mt(e){return e===1?"bg-[var(--color-podium-gold)] font-semibold":e===2?"bg-[var(--color-podium-silver)]":e===3?"bg-[var(--color-podium-bronze)]":""}const ce=({results:e})=>{const{t:n}=N();return!e||e.length===0?null:t.jsxs(oe,{children:[t.jsx(ie,{children:t.jsxs(H,{className:"border-b-2 border-[var(--color-border)]",children:[t.jsx(M,{className:"py-2.5 pr-3 text-xs uppercase tracking-wider font-semibold text-[var(--color-muted)]",children:n("results.rank")}),t.jsx(M,{className:"py-2.5 pr-3 text-xs uppercase tracking-wider font-semibold text-[var(--color-muted)]",children:n("results.player")})]})}),t.jsx(le,{children:e.map(r=>t.jsxs(H,{className:Mt(r.rankStart),children:[t.jsxs(k,{className:"py-2.5 pr-3 text-[var(--color-faint)] tabular-nums",children:[r.rankStart===1&&t.jsx(_e,{className:"h-4 w-4 inline-block mr-1 text-yellow-500"}),r.rankStart===2&&t.jsx(Ie,{className:"h-4 w-4 inline-block mr-1 text-gray-400"}),r.rankStart===3&&t.jsx(Ie,{className:"h-4 w-4 inline-block mr-1 text-amber-600"}),Et(r.rankStart,r.rankEnd)]}),t.jsx(k,{className:"py-2.5 pr-3 font-medium",children:r.name})]},r.playerId))})]})};function we(e,n){const r=(e.setsWon??0)-(e.setsLost??0),s=[e.points??0,r,e.setsWon??0];if(n===E.POINTS){const a=(e.pointsWon??0)-(e.pointsLost??0);s.push(a)}return s.join("|")}function Rt(e,n={}){const r=n.scoringMode??E.SETS,s=[];let a=0;for(;a<e.length;){const l=e[a];if(!l)break;const i=we(l,r);let o=a+1;for(;o<e.length;){const u=e[o];if(!u||we(u,r)!==i)break;o+=1}const d=a+1,c=o;for(let u=a;u<o;u+=1){const m=e[u];m&&s.push({...m,rankStart:d,rankEnd:c})}a=o}return s}function Dt(e,n,r={}){const s=ue(e,n,r);return Rt(s,r)}function Ct(e){const n=new Set;if(!e)return n;for(const r of e.rounds)for(const s of r)s.player1Id&&n.add(s.player1Id),s.player2Id&&n.add(s.player2Id);return n}function Ye(e,n){const r=new Map;let s=n;for(const a of e){if(a.length===0)continue;const l=s-a.length+1,i=s;for(const o of a)r.set(o,{rankStart:l,rankEnd:i});s=l-1}return{rankByPlayer:r}}function je(e){return[...e].toSorted((n,r)=>{const s=n.rankStart??Number.POSITIVE_INFINITY,a=r.rankStart??Number.POSITIVE_INFINITY;if(s!==a)return s-a;const l=n.rankEnd??Number.POSITIVE_INFINITY,i=r.rankEnd??Number.POSITIVE_INFINITY;return l!==i?l-i:n.name.localeCompare(r.name)})}function Te(e,n){return n?e.map(r=>r.rankStart==null||r.rankEnd==null?r:{...r,rankStart:r.rankStart+n,rankEnd:r.rankEnd+n}):e}function xe(e,n){if(!e)return[];const r=new Map(n.map(c=>[c.id,c])),s=[...Ct(e)],a=[],l=new Set;for(const[c,u]of e.rounds.entries()){const m=[];for(const f of u){if(!f.winnerId||!f.player1Id||!f.player2Id)continue;const h=f.winnerId===f.player1Id?f.player2Id:f.player1Id;l.has(h)||(l.add(h),m.push(h))}a[c]=m}const{rankByPlayer:i}=Ye(a,s.length),o=ee(e);if(o&&i.set(o,{rankStart:1,rankEnd:1}),e.thirdPlaceMatch?.winnerId){const c=e.thirdPlaceMatch,u=c.winnerId===c.player1Id?c.player2Id:c.player1Id;c.winnerId&&i.set(c.winnerId,{rankStart:3,rankEnd:3}),u&&i.set(u,{rankStart:4,rankEnd:4})}const d=s.map(c=>{const u=r.get(c);return{playerId:c,name:u?.name??c,...i.get(c)}});return je(d)}function Bt(e){const n=new Set;if(!e)return n;for(const s of e.winners.rounds)for(const a of s)a.player1Id&&n.add(a.player1Id),a.player2Id&&n.add(a.player2Id);for(const s of e.losers.rounds)for(const a of s)a.player1Id&&n.add(a.player1Id),a.player2Id&&n.add(a.player2Id);const r=e.finals;return r.grandFinal.player1Id&&n.add(r.grandFinal.player1Id),r.grandFinal.player2Id&&n.add(r.grandFinal.player2Id),r.resetFinal.player1Id&&n.add(r.resetFinal.player1Id),r.resetFinal.player2Id&&n.add(r.resetFinal.player2Id),n}function fe(e,n){if(!e)return[];const r=new Map(n.map(x=>[x.id,x])),s=[...Bt(e)],a=new Map(s.map(x=>[x,0])),l=new Set,i=e.losers.rounds,o=Array.from({length:i.length+2},()=>[]),d=x=>{if(!x?.winnerId||!x.player1Id||!x.player2Id)return;const b=x.winnerId===x.player1Id?x.player2Id:x.player1Id;a.set(b,(a.get(b)??0)+1)},c=(x,b)=>{if(!x?.winnerId||!x.player1Id||!x.player2Id)return;const g=x.winnerId===x.player1Id?x.player2Id:x.player1Id;if(l.has(g))return;const T=(a.get(g)??0)+1;if(a.set(g,T),T>=2){const R=o[b];R&&R.push(g),l.add(g)}};for(const x of e.winners.rounds)for(const b of x)d(b);for(const[x,b]of i.entries())for(const g of b)c(g,x);const u=i.length;c(e.finals.grandFinal,u),c(e.finals.resetFinal,u+1);const{rankByPlayer:m}=Ye(o,s.length),f=te(e);f&&m.set(f,{rankStart:1,rankEnd:1});const h=s.map(x=>{const b=r.get(x);return{playerId:x,name:b?.name??x,...m.get(x)}});return je(h)}const Pt=()=>{const{tournament:e,updateTournament:n}=ge(L.SINGLE_ELIM),[r,s]=p.useState(null),[a,l]=p.useState("playoff"),{t:i}=N();if(!e)return null;const{bracket:o,players:d}=e,c=e.scoringMode??E.SETS,u=e.maxSets??V,m=ee(o),f=o.thirdPlaceMatch,h=[{id:"playoff",label:i("tabs.playoff")},{id:"results",label:i("tabs.results")}];function x(b,g,T,R=!1){n(y=>{const S=g?Fe(structuredClone(y.bracket),b,g,T,R):We(structuredClone(y.bracket),b),B=ee(S);return{...y,bracket:S,winnerId:B,completedAt:B?new Date().toISOString():null}}),s(null)}return t.jsxs("div",{children:[m&&t.jsx(ae,{label:i("bracket.winner",{name:d.find(b=>b.id===m)?.name??""})}),t.jsx(Y,{tabs:h,activeId:a,onChange:l}),a==="playoff"?t.jsxs(t.Fragment,{children:[t.jsx(q,{bracket:o,players:d,scoringMode:c,maxSets:u,showSeedNumbers:!0,onEditMatch:b=>{s(b)}}),f&&(f.player1Id??f.player2Id)&&t.jsxs("div",{className:"mt-6",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:i("bracket.thirdPlace")}),t.jsx(J,{match:f,players:d,canEdit:Pe(o,f.id),onClick:()=>{s(f)},scoringMode:c,maxSets:u,roundIndex:o.rounds.length})]}),r&&t.jsx(re,{match:r,players:d,scoringMode:c,maxSets:u,onSave:x,onClose:()=>{s(null)}})]}):t.jsx(ce,{results:xe(o,d)})]})};function Ee(e){return e?e.player1Id||e.player2Id||e.winnerId?!0:Array.isArray(e.scores)&&e.scores.length>0:!1}const Ft=()=>{const{tournament:e,updateTournament:n}=ge(L.DOUBLE_ELIM),{t:r}=N(),[s,a]=p.useState(null),[l,i]=p.useState("playoff"),o=e?.doubleElim,d=p.useMemo(()=>e?.players??[],[e?.players]),c=e?.scoringMode??E.SETS,u=e?.maxSets??V,m=[{id:"playoff",label:r("tabs.playoff")},{id:"results",label:r("tabs.results")}],f=p.useMemo(()=>o?te(o):null,[o]),h=p.useMemo(()=>f?d.find(y=>y.id===f):null,[d,f]),x=o?.winners.rounds.length??0;function b(y,S,B,$=!1){o&&(n(O=>{const F=S?Le(structuredClone(O.doubleElim),y,S,B,$):He(structuredClone(O.doubleElim),y),_=te(F);return{...O,doubleElim:F,winnerId:_,completedAt:_?new Date().toISOString():null}}),a(null))}if(!e||!o)return null;const g=o.finals,T=Ee(g.grandFinal),R=Ee(g.resetFinal);return t.jsxs("div",{className:"space-y-8",children:[h&&t.jsx(ae,{label:r("bracket.winner",{name:d.find(y=>y.id===h.id)?.name??""})}),t.jsx(Y,{tabs:m,activeId:l,onChange:i}),l==="playoff"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:r("doubleElim.winnersBracket")}),t.jsx(q,{bracket:o.winners,players:d,scoringMode:c,maxSets:u,showSeedNumbers:!0,onEditMatch:y=>{a(y)},canEditMatchFn:(y,S)=>U(o,S)})]}),o.losers.rounds.length>0&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:r("doubleElim.losersBracket")}),t.jsx(q,{bracket:o.losers,players:d,scoringMode:c,maxSets:u,showSeedNumbers:!0,onEditMatch:y=>{a(y)},canEditMatchFn:(y,S)=>U(o,S)})]}),(T||R)&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:r("doubleElim.grandFinal")}),T&&t.jsx(J,{match:g.grandFinal,players:d,canEdit:U(o,g.grandFinal.id),scoringMode:c,maxSets:u,showSeedNumbers:!0,roundIndex:x,onClick:()=>{a(g.grandFinal)}}),R&&t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:r("doubleElim.resetFinal")}),t.jsx(J,{match:g.resetFinal,players:d,canEdit:U(o,g.resetFinal.id),scoringMode:c,maxSets:u,showSeedNumbers:!0,roundIndex:x,onClick:()=>{a(g.resetFinal)}})]})]}),s&&t.jsx(re,{match:s,players:d,scoringMode:c,maxSets:u,onSave:b,onClose:()=>{a(null)}})]}):t.jsx(ce,{results:fe(o,d)})]})};function Wt(e,n,r,s){const a=n.filter(o=>o==="headToHead"||o==="headToHeadSetDiff"||o==="headToHeadSetsWon"||o==="setDiff"||o==="setsWon"||o==="pointsDiff"),l={headToHead:r("roundRobin.tiebreakH2H"),headToHeadSetDiff:r("roundRobin.tiebreakH2HSetDiff"),headToHeadSetsWon:r("roundRobin.tiebreakH2HSetsWon"),setDiff:r("roundRobin.tiebreakSetDiff"),setsWon:r("roundRobin.tiebreakSetsWon"),pointsDiff:r("roundRobin.tiebreakPointsDiff")},i={headToHead:r("roundRobin.tiebreakH2HHelp"),headToHeadSetDiff:r("roundRobin.tiebreakH2HSetDiffHelp"),headToHeadSetsWon:r("roundRobin.tiebreakH2HSetsWonHelp"),setDiff:r("roundRobin.tiebreakSetDiffHelp"),setsWon:r("roundRobin.tiebreakSetsWonHelp"),pointsDiff:r("roundRobin.tiebreakPointsDiffHelp")};return a.filter(o=>s||o!=="pointsDiff").map(o=>{let d="-";return o==="headToHead"&&(d=String(e.headToHead)),o==="headToHeadSetDiff"&&(d=de(e.headToHeadSetDiff)),o==="headToHeadSetsWon"&&(d=String(e.headToHeadSetsWon)),o==="setDiff"&&(d=de(e.setDiff)),o==="setsWon"&&(d=String(e.setsWon)),o==="pointsDiff"&&(d=de(e.pointsDiff)),{key:o,label:l[o],value:d,help:i[o]}})}function de(e){const n=e.toFixed(0);return e>0?`+${n}`:n}const Lt=({details:e,applied:n,t:r,showBalls:s})=>{const a=Wt(e,n,r,s);return a.length===0?null:t.jsx("table",{className:"w-full text-[0.7rem] text-[var(--color-muted)]",children:t.jsx("tbody",{children:a.map(l=>t.jsxs(H,{className:"border-t border-[var(--color-border-soft)]",children:[t.jsx(k,{className:"py-1 pr-2 font-medium p-0",children:t.jsx("span",{className:"underline decoration-dotted underline-offset-2 cursor-help",title:l.help,children:l.label})}),t.jsx(k,{className:"py-1 text-right p-0",children:l.value})]},l.key))})})},Ht=({isExpanded:e})=>t.jsx("span",{className:"mr-1 inline-flex h-3 w-3 items-center justify-center text-[var(--color-muted)]","aria-hidden":"true",children:t.jsx("svg",{viewBox:"0 0 20 20",className:`h-3 w-3 transition-transform ${e?"rotate-90":"rotate-0"}`,fill:"currentColor",children:t.jsx("path",{d:"M7.5 5.5 12.5 10 7.5 14.5"})})}),Ot=({name:e,isWildCard:n,elo:r,t:s})=>t.jsx(k,{className:"py-2.5 pr-3 font-medium",children:t.jsxs("span",{className:"inline-flex items-center gap-2",children:[t.jsx("span",{children:e}),n&&t.jsx(ut,{variant:"accent",className:"text-[10px] px-1.5 py-0.5",children:s("groupStage.wildCardBadge")}),r!=null&&t.jsx("span",{className:"text-xs font-normal text-[var(--color-muted)]",children:s("players.elo",{elo:r})})]})}),At=({tiebreakDetails:e,rowClass:n,colSpan:r,t:s,showBalls:a})=>t.jsx(H,{className:n,children:t.jsx(k,{className:"px-2",colSpan:r,children:t.jsx(Lt,{details:e,applied:e.tiebreakApplied,t:s,showBalls:a})})}),$t=({row:e,rank:n,isDirectQualifier:r,isWildCard:s,hasTiebreak:a,isExpanded:l,showBalls:i,onToggleExpand:o,t:d})=>{let c="";r?c="bg-[var(--color-soft)]":s&&(c="bg-[var(--color-accent-soft)]");const u=f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),o())},m=i?8:7;return t.jsxs(p.Fragment,{children:[t.jsxs(H,{className:`transition-colors ${c} ${a?"cursor-pointer":""}`,onClick:a?o:void 0,onKeyDown:a?u:void 0,role:a?"button":void 0,tabIndex:a?0:void 0,"aria-expanded":a?l:void 0,children:[t.jsxs(k,{className:"py-2.5 pr-3 text-[var(--color-faint)] tabular-nums",children:[a&&t.jsx(Ht,{isExpanded:l}),n]}),t.jsx(Ot,{name:e.name,isWildCard:s,elo:e.elo,t:d}),t.jsx(k,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.played}),t.jsx(k,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.wins}),t.jsx(k,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.losses}),t.jsxs(k,{className:"py-2.5 pr-3 text-center tabular-nums",children:[e.setsWon,"-",e.setsLost]}),i&&t.jsxs(k,{className:"py-2.5 pr-3 text-center tabular-nums",children:[e.pointsWon,"-",e.pointsLost]}),t.jsx(k,{className:"py-2.5 text-center font-semibold tabular-nums",children:e.points})]}),l&&e.tiebreakDetails&&t.jsx(At,{tiebreakDetails:e.tiebreakDetails,rowClass:c,colSpan:m,t:d,showBalls:i})]})},Qe=({standings:e,highlightCount:n=0,wildCardIds:r,scoringMode:s=E.SETS})=>{const{t:a}=N(),[l,i]=p.useState(null),o=Math.max(0,Number.parseInt(String(n),10)||0),d=e.length===1&&o>0,c=s===E.POINTS;return t.jsxs(oe,{children:[t.jsx(ie,{children:t.jsxs(H,{className:"border-b-2 border-[var(--color-border)]",children:[t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.rank")}),t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.player")}),t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.played")}),t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.wins")}),t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.losses")}),t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.sets")}),c&&t.jsx(M,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.balls")}),t.jsx(M,{className:"py-2.5 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.points")})]})}),t.jsx(le,{children:e.map((u,m)=>{const f=(u.played>0||d)&&(m===0||o>0&&m<o),h=r?.has(u.playerId)??!1,x=u.tiebreakDetails!=null&&u.tiebreakDetails.tiebreakApplied.length>0,b=l===u.playerId,g=()=>{i(T=>T===u.playerId?null:u.playerId)};return t.jsx($t,{row:u,rank:m+1,isDirectQualifier:f,isWildCard:h,hasTiebreak:x,isExpanded:b,showBalls:c,onToggleExpand:g,t:a},u.playerId)})})]})};function Gt(e,n,r){const s=[n,r].toSorted((a,l)=>a.localeCompare(l)).join("|");return e.get(s)}function _t(e,n){return e.filter(r=>Array.isArray(r)).map(r=>{const s=r[0],a=r[1];if(ne(s)||ne(a)){const o=Ae(s,a);return o===0?null:{text:"WO",isWin:n?o===2:o===1}}const l=n?a:s,i=n?s:a;return!Number.isFinite(l)||!Number.isFinite(i)?null:{text:`${l}-${i}`,isWin:l>i}}).filter(r=>r!=null)}const Ut=({players:e})=>t.jsx(ie,{children:t.jsxs(H,{className:"border-b-0 hover:bg-transparent",children:[t.jsx(M,{className:"py-2 pr-3 sticky left-0 z-10"}),e.map(n=>t.jsx(M,{className:"py-2 pr-3 text-left font-medium text-[var(--color-text)] sticky left-0 z-10 whitespace-nowrap",children:n.name},n.id))]})}),qt=({rowPlayer:e,colPlayer:n,match:r,showPoints:s,scoringMode:a,maxSets:l})=>{if(e.id===n.id)return t.jsx(k,{className:"py-2 px-2 text-center bg-[var(--color-soft)] text-[var(--color-faint)]",children:"-"});if(!r||r.scores.length===0){if(r?.walkover||me(r?.scores??[])){const h=r?.winnerId===e.id;return t.jsx(k,{className:`py-2 px-2 text-center ${h?"font-semibold":"text-[var(--color-muted)]"}`,children:t.jsx("div",{className:"font-mono text-xs",children:"WO"})})}return t.jsx(k,{className:"py-2 px-2 text-center text-[var(--color-faintest)]",children:"-"})}const i=r.player1Id!==e.id,{p1Sets:o,p2Sets:d}=Oe(r.scores,{scoringMode:a,maxSets:l}),c=i?`${d}-${o}`:`${o}-${d}`,u=r.walkover||me(r.scores);let m;r.winnerId?m=r.winnerId===e.id:i?m=d>o:m=o>d;const f=s?_t(r.scores,i):[];return t.jsxs(k,{className:"py-2 px-2 text-center",children:[t.jsx("div",{className:`font-mono text-xs ${m?"font-semibold":"text-[var(--color-text)]"}`,children:u?c+" WO":c}),s&&f.length>0&&t.jsx("div",{className:"text-[10px] text-[var(--color-faint)]",children:f.map((h,x)=>t.jsxs("span",{className:h.isWin?"font-semibold":"",children:[x>0?", ":"",h.text]},`set-${x}`))})]})},Jt=({rowPlayer:e,players:n,matchIndex:r,showPoints:s,scoringMode:a,maxSets:l})=>t.jsxs(H,{children:[t.jsx(M,{className:"py-2 pr-3 text-left font-medium text-[var(--color-text)] sticky left-0 z-10 whitespace-nowrap",children:e.name}),n.map(i=>{const o=Gt(r,e.id,i.id);return t.jsx(qt,{rowPlayer:e,colPlayer:i,match:o,showPoints:s,scoringMode:a,maxSets:l},i.id)})]}),Xe=({players:e,schedule:n,scoringMode:r=E.SETS,maxSets:s})=>{const a=r===E.POINTS,l=p.useMemo(()=>{const i=new Map;for(const o of n.rounds)for(const d of o.matches){const c=[d.player1Id,d.player2Id].toSorted((u,m)=>u===null&&m===null?0:u===null?1:m===null?-1:u.localeCompare(m)).join("|");i.set(c,d)}return i},[n]);return t.jsxs(oe,{className:"border-separate border-spacing-0",children:[t.jsx(Ut,{players:e}),t.jsx(le,{children:e.map(i=>t.jsx(Jt,{rowPlayer:i,players:e,matchIndex:l,showPoints:a,scoringMode:r,maxSets:s},i.id))})]})},Kt=({match:e,players:n,onEdit:r,scoringMode:s=E.SETS,maxSets:a})=>{const{t:l}=N(),i=n.find(x=>x.id===e.player1Id),o=n.find(x=>x.id===e.player2Id),d=s===E.POINTS,{p1Sets:c,p2Sets:u}=Oe(e.scores,{scoringMode:s,maxSets:a}),m=e.walkover||me(e.scores),f=d?ft(e.scores):"",h=d?e.scores.filter(x=>Array.isArray(x)).map(x=>zt(x,e)).filter(x=>x!=null):[];return t.jsxs("div",{onClick:()=>{r(e)},className:"flex items-center gap-3 border border-[var(--color-border)] bg-[var(--color-card)] rounded-lg px-3 py-2.5 cursor-pointer hover:border-[var(--color-primary)] hover:shadow-md hover:-translate-y-px transition-all duration-150 text-sm",role:"button",tabIndex:0,"aria-label":l("bracket.editMatch"),onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),r(e))},children:[t.jsx("span",{className:`flex-1 text-right min-w-0 truncate text-xs sm:text-sm ${e.winnerId===e.player1Id?"font-semibold text-[var(--color-primary-dark)]":""}`,children:i?t.jsxs(t.Fragment,{children:[i.name,i.elo!=null&&t.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:l("players.elo",{elo:i.elo})})]}):null}),e.winnerId?t.jsxs("div",{className:"text-center min-w-[3rem]",children:[t.jsx("div",{className:"text-[var(--color-muted)] font-mono text-xs px-2 py-0.5 rounded bg-[var(--color-soft)]",children:m?"WO":`${c} - ${u}`}),d&&f&&t.jsx("div",{className:"text-[10px] text-[var(--color-faint)]",children:h.map((x,b)=>t.jsxs("span",{className:x.isWinnerSet?"font-semibold text-[var(--color-text)]":"",children:[b>0?", ":"",x.text]},`set-${b}`))})]}):t.jsx("span",{className:"text-[var(--color-faintest)] text-xs min-w-[3rem] text-center",children:l("score.vs")}),t.jsx("span",{className:`flex-1 min-w-0 truncate text-xs sm:text-sm ${e.winnerId===e.player2Id?"font-semibold text-[var(--color-primary-dark)]":""}`,children:o?t.jsxs(t.Fragment,{children:[o.name,o.elo!=null&&t.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:l("players.elo",{elo:o.elo})})]}):null})]})};function zt(e,n){const[r,s]=e;if(ne(r)||ne(s)){const d=Ae(r,s);if(d===0)return{text:"WO",isWinnerSet:!1};const c=d===1?n.player1Id:n.player2Id;return{text:"WO",isWinnerSet:n.winnerId!=null&&n.winnerId===c}}const a=r,l=s;if(!Number.isFinite(a)||!Number.isFinite(l))return null;let i=0;a>l?i=1:l>a&&(i=2);let o=!1;return i===1?o=n.winnerId===n.player1Id:i===2&&(o=n.winnerId===n.player2Id),{text:`${a}-${l}`,isWinnerSet:o}}const Ze=({schedule:e,players:n,onEditMatch:r,scoringMode:s=E.SETS,maxSets:a})=>{const{t:l}=N();return t.jsx("div",{className:"space-y-6",children:e.rounds.map(i=>{const o=i.byePlayerId?n.find(d=>d.id===i.byePlayerId):null;return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-muted)] mb-2",children:[l("roundRobin.round",{n:i.roundNumber}),o&&t.jsx("span",{className:"text-[var(--color-faint)] font-normal ml-2",children:l("roundRobin.bye",{name:o.elo==null?o.name:`${o.name} (${l("players.elo",{elo:o.elo})})`})})]}),t.jsx("div",{className:"space-y-2",children:i.matches.map(d=>t.jsx(Kt,{match:d,players:n,onEdit:r,scoringMode:s,maxSets:a},d.id))})]},i.roundNumber)})})},Vt=()=>{const{tournament:e,updateTournament:n}=ge(L.ROUND_ROBIN),[r,s]=p.useState("standings"),[a,l]=p.useState(null),{t:i}=N();if(!e)return null;const{schedule:o,players:d}=e,c=e.scoringMode??E.SETS,u=e.maxSets??V,m=ue(o,d,{scoringMode:c,maxSets:u}),f=ke(o),h=[{id:"standings",label:i("roundRobin.standings")},{id:"matrix",label:i("roundRobin.matrix")},{id:"schedule",label:i("roundRobin.schedule")},{id:"results",label:i("roundRobin.results")}];function x(b,g,T,R=!1){n(y=>{const S=structuredClone(y.schedule);for(const O of S.rounds){const F=O.matches.find(_=>_.id===b);if(F){F.winnerId=g,F.scores=T,F.walkover=R;break}}const B=ke(S),$=B?ue(S,y.players,{scoringMode:c,maxSets:u}):null;return{...y,schedule:S,winnerId:B?$?.[0]?.playerId??null:null,completedAt:B?new Date().toISOString():null}}),l(null)}return t.jsxs("div",{children:[f&&t.jsx(ae,{label:i("roundRobin.winner",{name:m[0]?.name??""})}),t.jsx(Y,{tabs:h,activeId:r,onChange:s}),r==="schedule"?t.jsx(Ze,{schedule:o,players:d,onEditMatch:l,scoringMode:c,maxSets:u}):t.jsxs(t.Fragment,{children:[r==="standings"&&t.jsx(Qe,{standings:m,scoringMode:c}),r==="matrix"&&t.jsx("div",{className:"mt-6",children:t.jsx(Xe,{schedule:o,players:d,scoringMode:c,maxSets:u})}),r!=="standings"&&r!=="matrix"&&t.jsx("div",{className:"mt-6",children:t.jsx(ce,{results:Dt(o,d,{scoringMode:c})})})]}),a&&t.jsx(re,{match:a,players:d,scoringMode:c,maxSets:u,onSave:x,onClose:()=>{l(null)}})]})},Yt=()=>{const{tournament:e,updateTournament:n}=se(),{t:r}=N(),[s,a]=p.useState(null),[l,i]=p.useState(""),[o,d]=p.useState("");if(!e)return t.jsx("div",{className:"mb-6"});const{players:c}=e;function u(h){a(h.id),i(h.name),d("")}function m(){a(null),i(""),d("")}function f(h){const x=l.trim();if(!x){d(r("tournament.nameEmpty"));return}if(c.some(b=>b.id!==h&&b.name.toLowerCase()===x.toLowerCase())){d(r("tournament.nameDuplicate"));return}n(b=>({...b,players:b.players.map(g=>g.id===h?{...g,name:x}:g)})),a(null),i(""),d("")}return t.jsxs("div",{className:"mb-6",children:[t.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-muted)] mb-2",children:[r("tournament.playersList")," (",c.length,")"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(h=>t.jsx("div",{children:s===h.id?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",id:`edit-player-${h.id}`,"aria-label":r("tournament.editName"),value:l,onChange:x=>{i(x.target.value),d("")},onKeyDown:x=>{x.key==="Enter"&&f(h.id),x.key==="Escape"&&m()},className:`border rounded px-2 py-1 text-sm w-32 focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] bg-[var(--color-card)] ${o?"border-[var(--color-accent-border)]":"border-[var(--color-border)]"}`}),t.jsx("button",{onClick:()=>{f(h.id)},className:"text-[var(--color-primary)] hover:text-[var(--color-primary-dark)] text-sm px-1",title:r("tournament.saveName"),children:t.jsx(bt,{className:"h-3.5 w-3.5"})}),t.jsx("button",{onClick:m,className:"text-[var(--color-faint)] hover:text-[var(--color-muted)] text-sm px-1",title:r("tournament.cancelEdit"),children:t.jsx(gt,{className:"h-3.5 w-3.5"})})]}):t.jsxs("button",{type:"button",onClick:()=>{u(h)},className:"inline-flex items-center gap-2 bg-[var(--color-soft)] border border-[var(--color-border)] rounded-full px-3 py-1 text-sm text-[var(--color-text)] cursor-pointer hover:bg-[var(--color-soft)] hover:border-[var(--color-primary)] transition-colors",title:r("tournament.editName"),"aria-label":r("tournament.editName"),children:[t.jsx("span",{className:"truncate",children:h.name}),h.elo!=null&&t.jsx("span",{className:"text-xs font-normal text-[var(--color-muted)]",children:r("players.elo",{elo:h.elo})})]})},h.id))}),o&&t.jsx("p",{className:"text-[var(--color-accent)] text-xs mt-1",children:o})]})},et=({player:e,groupLabel:n,tagType:r})=>{const{t:s}=N(),a={qualifier:"bg-[var(--color-soft)] text-[var(--color-primary-dark)]",lucky:"bg-[var(--color-accent-soft)] text-[var(--color-accent)]"},l={qualifier:s("groupStage.advancerQualifierTag"),lucky:s("groupStage.advancerLuckyTag")};return t.jsxs("li",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-[var(--color-text)]",children:e.name}),t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:s("groupStage.advancerGroupRank",{group:n,rank:e.groupRank})})]}),t.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${a[r]}`,children:l[r]})]})},Qt=({qualifiers:e,groupLabelById:n})=>{const{t:r}=N();return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:r("groupStage.qualifiersTitle")}),t.jsx("ul",{className:"space-y-2",children:e.map(s=>t.jsx(et,{player:s,groupLabel:n.get(s.groupId)??s.groupId,tagType:"qualifier"},s.id))})]})},Xt=({luckyLosers:e,hasLucky:n,groupLabelById:r})=>{const{t:s}=N();return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:s("groupStage.luckyLosersTitle")}),n?t.jsx("ul",{className:"space-y-2",children:e.map(a=>t.jsx(et,{player:a,groupLabel:r.get(a.groupId)??a.groupId,tagType:"lucky"},a.id))}):t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:s("groupStage.luckyLosersNone")})]})};function Zt(e){return Number.isFinite(e)?`${(e*100).toFixed(1)}%`:"0%"}function pe(e){return Number.isFinite(e)?e.toFixed(2):"0.00"}function Me(e){const n=pe(e);return e>0?`+${n}`:n}function en(e,n,r){const s=e.tiebreakDetails,a=Array.isArray(e.tiebreakApplied)?e.tiebreakApplied.filter(o=>o==="setsWonPerMatch"||o==="setDiffPerMatch"||o==="pointsDiffPerMatch"||o==="opponentAvgRank"||o==="relativeRank"||o==="fairPlay"||o==="lottery"):[],l={setsWonPerMatch:n("groupStage.luckyCriteriaSetsWon"),setDiffPerMatch:n("groupStage.luckyCriteriaSetDiff"),pointsDiffPerMatch:n("groupStage.luckyCriteriaPointsDiff"),opponentAvgRank:n("groupStage.luckyCriteriaOpponentRank"),relativeRank:n("groupStage.luckyCriteriaRelativeRank"),fairPlay:n("groupStage.luckyCriteriaFairPlay"),lottery:n("groupStage.luckyCriteriaLottery")},i={setsWonPerMatch:n("groupStage.luckyCriteriaSetsWonHelp"),setDiffPerMatch:n("groupStage.luckyCriteriaSetDiffHelp"),pointsDiffPerMatch:n("groupStage.luckyCriteriaPointsDiffHelp"),opponentAvgRank:n("groupStage.luckyCriteriaOpponentRankHelp"),relativeRank:n("groupStage.luckyCriteriaRelativeRankHelp"),fairPlay:n("groupStage.luckyCriteriaFairPlayHelp"),lottery:n("groupStage.luckyCriteriaLotteryHelp")};return a.filter(o=>r||o!=="pointsDiffPerMatch").map(o=>{let d="-";return o==="setsWonPerMatch"&&(d=pe(s.setsWonPerMatch)),o==="setDiffPerMatch"&&(d=Me(s.setDiffPerMatch)),o==="pointsDiffPerMatch"&&(d=Me(s.pointsDiffPerMatch)),o==="opponentAvgRank"&&(d=pe(s.opponentAvgRank)),o==="relativeRank"&&(d=Zt(s.relativeRank)),o==="fairPlay"&&(d=s.fairPlay?n("groupStage.luckyCriteriaYes"):n("groupStage.luckyCriteriaNo")),o==="lottery"&&(d=n("groupStage.luckyCriteriaApplied")),{key:o,label:l[o],value:d,help:i[o]}})}const tn=({player:e,showBalls:n})=>{const{t:r}=N(),s=en(e,r,n);return s.length===0?null:t.jsx("table",{className:"w-full text-[0.7rem] text-[var(--color-muted)]",children:t.jsx("tbody",{children:s.map(a=>t.jsxs("tr",{className:"border-t border-[var(--color-border-soft)]",children:[t.jsx("td",{className:"py-1 pr-2 font-medium",children:t.jsx("span",{className:"underline decoration-dotted underline-offset-2 cursor-help",title:a.help,children:a.label})}),t.jsx("td",{className:"py-1 text-right",children:a.value})]},a.key))})})},nn=({player:e,index:n,groupLabel:r,isLucky:s,showBalls:a,isExpanded:l,onToggle:i})=>{const{t:o}=N(),d=e.stats,c=s?"bg-[var(--color-accent-soft)]":"",u=a?9:8;return t.jsxs(p.Fragment,{children:[t.jsxs("tr",{className:`border-b border-[var(--color-border-soft)] ${c} cursor-pointer`,onClick:i,onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i())},role:"button",tabIndex:0,"aria-expanded":l,children:[t.jsxs("td",{className:"py-2 pr-2 text-[var(--color-faint)]",children:[t.jsx("span",{className:"mr-1 inline-flex h-3 w-3 items-center justify-center text-[var(--color-muted)]","aria-hidden":"true",children:t.jsx("svg",{viewBox:"0 0 20 20",className:`h-3 w-3 transition-transform ${l?"rotate-90":"rotate-0"}`,fill:"currentColor",children:t.jsx("path",{d:"M7.5 5.5 12.5 10 7.5 14.5"})})}),n+1]}),t.jsx("td",{className:"py-2 pr-2 font-medium text-[var(--color-text)]",children:e.name}),t.jsx("td",{className:"py-2 pr-2 text-[var(--color-muted)]",children:o("groupStage.advancerGroupRank",{group:r,rank:e.groupRank})}),t.jsx("td",{className:"py-2 pr-2 text-center",children:d.played??0}),t.jsx("td",{className:"py-2 pr-2 text-center",children:d.wins??0}),t.jsx("td",{className:"py-2 pr-2 text-center",children:d.losses??0}),t.jsxs("td",{className:"py-2 pr-2 text-center",children:[d.setsWon??0,"-",d.setsLost??0]}),a&&t.jsxs("td",{className:"py-2 pr-2 text-center",children:[d.pointsWon??0,"-",d.pointsLost??0]}),t.jsx("td",{className:"py-2 text-center font-semibold",children:d.points??0})]}),l&&t.jsx("tr",{className:`border-b border-[var(--color-border-soft)] ${c}`,children:t.jsx("td",{className:"px-2",colSpan:u,children:t.jsx(tn,{player:e,showBalls:a})})})]})},rn=({candidates:e,luckyIdSet:n,groupLabelById:r,showBalls:s,expandedId:a,onToggleExpand:l})=>{const{t:i}=N();return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:i("groupStage.luckyCandidatesTitle")}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-[var(--color-border-soft)] text-left text-[var(--color-muted)]",children:[t.jsx("th",{className:"py-2 pr-2",children:i("standings.rank")}),t.jsx("th",{className:"py-2 pr-2",children:i("standings.player")}),t.jsx("th",{className:"py-2 pr-2",children:i("standings.group")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.played")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.wins")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.losses")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.sets")}),s&&t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.balls")}),t.jsx("th",{className:"py-2 text-center",children:i("standings.points")})]})}),t.jsx("tbody",{children:e.map((o,d)=>t.jsx(nn,{player:o,index:d,groupLabel:r.get(o.groupId)??o.groupId,isLucky:n.has(o.id),showBalls:s,isExpanded:a===o.id,onToggle:()=>{l(o.id)}},o.id))})]})})]})},sn=({qualifiers:e,luckyLosers:n,luckyCandidates:r=[],groups:s,bracketTargetSize:a,scoringMode:l=E.SETS})=>{const{t:i}=N(),[o,d]=p.useState(null),c=p.useMemo(()=>{const b=new Map;for(const[g,T]of s.entries())b.set(T.id,i("groupStage.groupTitle",{label:be(g)}));return b},[s,i]),u=p.useMemo(()=>new Set(n.map(b=>b.id)),[n]),m=l===E.POINTS,f=n.length>0,h=r.length>0;if(e.length===0&&!f)return null;const x=b=>{d(g=>g===b?null:b)};return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4 bg-[var(--color-card)]",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:i("groupStage.advancersTitle")}),f&&t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:i("groupStage.luckyLoserNote",{target:a})}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsx(Qt,{qualifiers:e,groupLabelById:c}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(Xt,{luckyLosers:n,hasLucky:f,groupLabelById:c}),f&&h&&t.jsx(rn,{candidates:r,luckyIdSet:u,groupLabelById:c,showBalls:m,expandedId:o,onToggleExpand:x})]})]})]})},an=({group:e,groupIndex:n,groupPlayers:r,standings:s,qualifierCount:a,wildCardIds:l,activeTab:i,onTabChange:o,onEditMatch:d,scoringMode:c,maxSets:u})=>{const{t:m}=N(),f=[{id:"standings",label:m("roundRobin.standings")},{id:"results",label:m("roundRobin.matrix")},{id:"schedule",label:m("roundRobin.schedule")}];return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 bg-[var(--color-card)]",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)] mb-4",children:m("groupStage.groupTitle",{label:be(n)})}),t.jsx(Y,{tabs:f,activeId:i,onChange:o}),i==="schedule"&&t.jsx(Ze,{schedule:e.schedule,players:r,onEditMatch:d,scoringMode:c,maxSets:u}),i==="standings"&&t.jsx(Qe,{standings:s,highlightCount:a,wildCardIds:l,scoringMode:c}),i==="results"&&t.jsx(Xe,{schedule:e.schedule,players:r,scoringMode:c,maxSets:u})]})},on=({groupStage:e,players:n,standingsByGroup:r,wildCardIds:s,groupTabs:a,onGroupTabChange:l,onEditMatch:i,scoringMode:o,maxSets:d})=>t.jsx("div",{className:"space-y-6",children:e.groups.map((c,u)=>{const m=$e(c,n),f=r.find(b=>b.groupId===c.id)?.standings,h=e.settings.qualifiers[u]??0,x=a[c.id]??"standings";return t.jsx(an,{group:c,groupIndex:u,groupPlayers:m,standings:f??[],qualifierCount:h,wildCardIds:s,activeTab:x,onTabChange:b=>{l(c.id,b)},onEditMatch:b=>{i(c.id,b.id)},scoringMode:o,maxSets:d},c.id)})}),Re=({title:e,bracket:n,players:r,onEditMatch:s,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o})=>{const{t:d}=N();if(!n)return null;const c=n.thirdPlaceMatch??null,u=n.rounds.length;return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:e}),t.jsx(q,{bracket:n,players:r,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:s}),c&&(c.player1Id??c.player2Id)&&t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:d("bracket.thirdPlace")}),t.jsx(J,{match:c,players:r,wildCardIds:a,canEdit:Pe(n,c.id),onClick:()=>{s(c)},scoringMode:l,maxSets:i,roundIndex:u})]})]})},De=({title:e,doubleElim:n,players:r,onEditMatch:s,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o})=>{const{t:d}=N();return n?t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:e}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:d("doubleElim.winnersBracket")}),t.jsx(q,{bracket:n.winners,players:r,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:c=>{s(c.id)}})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:d("doubleElim.losersBracket")}),t.jsx(q,{bracket:n.losers,players:r,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:c=>{s(c.id)}})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:d("doubleElim.finals")}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[t.jsx(J,{match:n.finals.grandFinal,players:r,wildCardIds:a,canEdit:U(n,n.finals.grandFinal.id),onClick:()=>{s(n.finals.grandFinal.id)},scoringMode:l,maxSets:i,roundIndex:n.winners.rounds.length}),n.finals.resetFinal.player1Id&&n.finals.resetFinal.player2Id&&t.jsx(J,{match:n.finals.resetFinal,players:r,wildCardIds:a,canEdit:U(n,n.finals.resetFinal.id),onClick:()=>{s(n.finals.resetFinal.id)},scoringMode:l,maxSets:i,roundIndex:n.winners.rounds.length+1})]})]})]}):null},ln=({playoffs:e,isDoubleElim:n,players:r,wildCardIds:s,groupPlacementByPlayerId:a,scoringMode:l,maxSets:i,onEditMainBracketMatch:o,onEditConsolationBracketMatch:d,onEditMainDoubleElimMatch:c,onEditConsolationDoubleElimMatch:u})=>{const{t:m}=N();if(!e)return null;const f=!n&&e.mainBracket,h=n&&e.mainDoubleElim,x=!n&&e.consolationBracket,b=n&&e.consolationDoubleElim;return!f&&!h?null:t.jsxs(t.Fragment,{children:[f&&t.jsx(Re,{title:m("groupStage.mainBracket"),bracket:e.mainBracket,players:r,wildCardIds:s,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:o}),h&&t.jsx(De,{title:m("groupStage.mainBracket"),doubleElim:e.mainDoubleElim,players:r,wildCardIds:s,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:c}),x&&t.jsx(Re,{title:m("groupStage.consolationBracket"),bracket:e.consolationBracket,players:r,wildCardIds:s,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:d}),b&&t.jsx(De,{title:m("groupStage.consolationBracket"),doubleElim:e.consolationDoubleElim,players:r,wildCardIds:s,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:u})]})},cn=({editing:e,activeMatch:n,activePlayers:r,scoringMode:s,groupStageMaxSets:a,bracketMaxSets:l,onSave:i,onClose:o})=>{if(!n||!e)return null;const d=e.type==="group"?a:l;return t.jsx(re,{match:n,players:r,scoringMode:s,maxSets:d,onSave:i,onClose:o})};function dn(e,n,r){const s=e.groups.find(a=>a.id===n);if(!s)return null;for(const a of s.schedule.rounds){const l=a.matches.find(i=>i.id===r);if(l)return l}return null}function un(e,n){if(!e)return null;if(e.thirdPlaceMatch?.id===n)return e.thirdPlaceMatch;for(const r of e.rounds){const s=r.find(a=>a.id===n);if(s)return s}return null}function mn(e,n){if(!e)return null;for(const r of e.winners.rounds){const s=r.find(a=>a.id===n);if(s)return s}for(const r of e.losers.rounds){const s=r.find(a=>a.id===n);if(s)return s}return e.finals.grandFinal.id===n?e.finals.grandFinal:e.finals.resetFinal.id===n?e.finals.resetFinal:null}function xn(e,n,r,s){return p.useMemo(()=>e?pt(e,n,{scoringMode:r,maxSets:s}):[],[e,n,r,s])}function fn(e){return p.useMemo(()=>e?Ge(e):!1,[e])}function pn(e,n,r,s,a){return p.useMemo(()=>!e||!n?null:ht(n,r,{scoringMode:s,maxSets:a}),[e,n,r,s,a])}function hn(e){return p.useMemo(()=>e?new Set(e.luckyLosers.map(n=>n.id)):null,[e])}function bn(e,n){return p.useMemo(()=>{if(!e||!n)return null;const r=new Map(n.groups.map((l,i)=>[l.id,be(i)])),s=new Map,a=l=>{const i=r.get(l.groupId);!i||!l.groupRank||s.set(l.id,`${i}${l.groupRank}`)};for(const l of e.main)a(l);for(const l of e.luckyLosers)a(l);for(const l of e.consolation)a(l);return s},[e,n])}function he(e){return e?e.rounds.some(n=>n.some(r=>r.scores.length>0||r.winnerId)):!1}function Ce(e){return e?!!(he(e.winners)||e.losers.rounds.some(n=>n.some(r=>r.scores.length>0||r.winnerId))||e.finals.grandFinal.winnerId||e.finals.resetFinal.winnerId):!1}function gn(e,n){return e===n?!0:!e||!n?!1:e.bracketType===n.bracketType&&JSON.stringify(e.mainBracket)===JSON.stringify(n.mainBracket)&&JSON.stringify(e.mainDoubleElim)===JSON.stringify(n.mainDoubleElim)&&JSON.stringify(e.consolationBracket)===JSON.stringify(n.consolationBracket)&&JSON.stringify(e.consolationDoubleElim)===JSON.stringify(n.consolationDoubleElim)}function jn(e){const n=e.groupStagePlayoffs??e.groupStageBrackets;return n||null}function K(e,n){return e?n&&e.mainDoubleElim?te(e.mainDoubleElim):e.mainBracket?ee(e.mainBracket):null:null}function Be(e,n){return e?n?!!e.mainDoubleElim||!!e.consolationDoubleElim:!!e.mainBracket||!!e.consolationBracket:!1}function yn(e,n){return e?n?Ce(e.mainDoubleElim)||Ce(e.consolationDoubleElim):he(e.mainBracket)||he(e.consolationBracket):!1}const vn=()=>{const{tournament:e,updateTournament:n}=Nt(),{t:r}=N(),[s,a]=p.useState(null),[l,i]=p.useState({}),[o,d]=p.useState("tournament"),c=e?.groupStage,u=p.useMemo(()=>e?.players??[],[e?.players]),m=e?jn(e):null,f=e?.scoringMode??E.SETS,h=e?.groupStageMaxSets??e?.maxSets??V,x=e?.bracketMaxSets??e?.maxSets??V,g=(m?.bracketType??c?.settings.bracketType??Ne.SINGLE_ELIM)===Ne.DOUBLE_ELIM,T=xn(c,u,f,h),R=fn(c),y=pn(R,c,u,f,h),S=hn(y),B=bn(y,c),$=p.useMemo(()=>e?e.winnerId?e.winnerId:K(m,g):null,[m,e,g]),O=p.useMemo(()=>$?u.find(j=>j.id===$):null,[u,$]);p.useEffect(()=>{if(!R||!y||!c||Be(m,g)&&yn(m,g))return;const I=Se(c,u,{scoringMode:f,maxSets:h});if(gn(m,I))return;const w=K(I,g);n(P=>({...P,groupStagePlayoffs:I,winnerId:w??null,completedAt:w?new Date().toISOString():null}))},[y,R,c,m,u,f,h,n,g,e]);const F=p.useMemo(()=>{if(!s||!c)return null;if(s.type==="group"&&s.groupId)return dn(c,s.groupId,s.matchId);if(s.type==="mainBracket"||s.type==="consolationBracket"){const j=m?.[s.type];return un(j,s.matchId)}if(s.type==="mainDoubleElim"||s.type==="consolationDoubleElim"){const j=m?.[s.type];return mn(j,s.matchId)}return null},[s,c,m]),_=p.useMemo(()=>{if(!s||!c)return u;if(s.type==="group"){const j=c.groups.find(v=>v.id===s.groupId);return j?$e(j,u):u}return u},[s,c,u]),tt=p.useMemo(()=>{if(o!=="results")return[];let j=[],v=[];return m&&(g&&m.mainDoubleElim?j=fe(m.mainDoubleElim,u):m.mainBracket&&(j=xe(m.mainBracket,u)),g&&m.consolationDoubleElim?v=Te(fe(m.consolationDoubleElim,u),j.length):m.consolationBracket&&(v=Te(xe(m.consolationBracket,u),j.length))),je([...j,...v])},[o,m,u,g]);function nt(j,v,I,w=!1){if(!c)return;const P=structuredClone(c);for(const G of P.groups)for(const it of G.schedule.rounds){const Q=it.matches.find(lt=>lt.id===j);if(Q){Q.winnerId=v,Q.scores=I,Q.walkover=w;break}}let D=m;const W=m&&Be(m,g);Ge(P)&&!W&&(D=Se(P,u,{scoringMode:f,maxSets:h}));const A=K(D,g);n(G=>({...G,groupStage:P,groupStagePlayoffs:D,winnerId:A??null,completedAt:A?new Date().toISOString():null})),a(null)}function ye(j,v,I,w,P=!1){if(!m||!c)return;const D=structuredClone(m),W=D[w];if(!W)return;D[w]=v?Fe(W,j,v,I,P):We(W,j);const A=K(D,g);n(G=>({...G,groupStage:c,groupStagePlayoffs:D,winnerId:A??null,completedAt:A?new Date().toISOString():null})),a(null)}function ve(j,v,I,w,P=!1){if(!m||!c)return;const D=structuredClone(m),W=D[w];if(!W)return;D[w]=v?Le(W,j,v,I,P):He(W,j);const A=K(D,g);n(G=>({...G,groupStage:c,groupStagePlayoffs:D,winnerId:A??null,completedAt:A?new Date().toISOString():null})),a(null)}function rt(j,v,I,w){if(s)switch(s.type){case"group":{nt(j,v,I,w);break}case"mainBracket":{ye(j,v,I,"mainBracket",w);break}case"consolationBracket":{ye(j,v,I,"consolationBracket",w);break}case"mainDoubleElim":{ve(j,v,I,"mainDoubleElim",w);break}case"consolationDoubleElim":{ve(j,v,I,"consolationDoubleElim",w);break}}}function st(j,v){i(I=>({...I,[j]:v}))}function at(j,v){a({type:"group",groupId:j,matchId:v})}const ot=[{id:"tournament",label:r("tabs.tournament")},{id:"results",label:r("tabs.results")}];return!e||!c?null:t.jsxs("div",{className:"space-y-8",children:[O&&t.jsx(ae,{label:r("bracket.winner",{name:O.name})}),t.jsx(Y,{tabs:ot,activeId:o,onChange:d}),o==="results"?t.jsx(ce,{results:tt}):t.jsxs(t.Fragment,{children:[t.jsx(on,{groupStage:c,players:u,standingsByGroup:T,wildCardIds:S,groupTabs:l,onGroupTabChange:st,onEditMatch:at,scoringMode:f,maxSets:h}),y&&t.jsx(sn,{qualifiers:y.main,luckyLosers:y.luckyLosers,luckyCandidates:y.luckyCandidates,groups:c.groups,bracketTargetSize:y.bracketTargetSize,scoringMode:f}),t.jsx(ln,{playoffs:m,isDoubleElim:g,players:u,wildCardIds:S,groupPlacementByPlayerId:B,scoringMode:f,maxSets:x,onEditMainBracketMatch:j=>{a({type:"mainBracket",matchId:j.id})},onEditConsolationBracketMatch:j=>{a({type:"consolationBracket",matchId:j.id})},onEditMainDoubleElimMatch:j=>{a({type:"mainDoubleElim",matchId:j})},onEditConsolationDoubleElimMatch:j=>{a({type:"consolationDoubleElim",matchId:j})}}),t.jsx(cn,{editing:s,activeMatch:F,activePlayers:_,scoringMode:f,groupStageMaxSets:h,bracketMaxSets:x,onSave:rt,onClose:()=>{a(null)}})]})]})},Nn=()=>{const{tournament:e,isLoading:n}=se(),{t:r}=N(),s=dt(),{tracker:a}=mt();return p.useEffect(()=>{a.trackPageView({})},[s,a]),xt(e?e.name:r("tournament.notFoundTitle")),n?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-[var(--color-muted)]",children:r("tournament.loading")})}):e?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx(z,{to:"/",className:"text-sm text-[var(--color-primary)] hover:text-[var(--color-primary-dark)]",children:r("tournament.back")}),t.jsx("h1",{className:"text-2xl font-bold text-[var(--color-text)] mt-2",children:e.name}),t.jsxs("p",{className:"text-sm text-[var(--color-muted)]",children:[r(`format.${e.format}`)," Â·"," ",r("tournament.players",{count:e.players.length})]})]}),t.jsx(Yt,{}),e.format===L.SINGLE_ELIM&&t.jsx(Pt,{}),e.format===L.ROUND_ROBIN&&t.jsx(Vt,{}),e.format===L.DOUBLE_ELIM&&t.jsx(Ft,{}),e.format===L.GROUPS_TO_BRACKET&&t.jsx(vn,{})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center px-4",children:[t.jsx(yt,{className:"h-12 w-12 text-[var(--color-muted)] mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text)] mb-2",children:r("tournament.notFoundTitle")}),t.jsx("p",{className:"text-[var(--color-muted)] mb-6 max-w-md",children:r("tournament.notFoundDesc")}),t.jsxs("div",{className:"flex gap-3 flex-wrap justify-center",children:[t.jsx(Z,{asChild:!0,children:t.jsx(z,{to:"/create",children:r("home.newTournament")})}),t.jsx(Z,{variant:"primary-outlined",asChild:!0,children:t.jsx(z,{to:"/",children:r("tournament.backHome")})})]})]})},Dn=()=>{const{id:e}=ct(),{t:n}=N();return e?t.jsx(kt,{tournamentId:e,children:t.jsx(Nn,{})}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center px-4",children:[t.jsx(jt,{className:"h-12 w-12 text-[var(--color-muted)] mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text)] mb-2",children:n("tournament.notFoundTitle")}),t.jsx("p",{className:"text-[var(--color-muted)] mb-6 max-w-md",children:n("tournament.noIdDesc")}),t.jsxs("div",{className:"flex gap-3 flex-wrap justify-center",children:[t.jsx(Z,{asChild:!0,children:t.jsx(z,{to:"/create",children:n("home.newTournament")})}),t.jsx(Z,{variant:"primary-outlined",asChild:!0,children:t.jsx(z,{to:"/",children:n("tournament.backHome")})})]})]})};export{Dn as TournamentPage};
