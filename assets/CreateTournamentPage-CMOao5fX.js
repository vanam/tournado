import{j as e,u as K,i as $,r as V,k as z,l as w}from"./react-vendor-B7IL4Whh.js";import{c as Q,u as D,B as j,a as X,M as R,D as I}from"./index-CvbsBJwf.js";import{u as W}from"./usePageTitle-sz_oN9Oh.js";import{B as L,S as U,F as c,p as Y}from"./ConfirmModal-DnkF5V2G.js";import{I as f,C as H,L as g,c as J,g as Z,a as ee,b as re,i as te}from"./groupStageUtils-Bj9B513T.js";import{a as ae,C as se,X as oe}from"./icons-DoRsKl6D.js";import"./notifications-B5Q4qzS0.js";import"./radix-ui-BObq5o7x.js";const M=({children:n,className:s})=>e.jsx("p",{className:Q("text-sm font-medium text-[var(--color-text)] mb-1",s),children:n}),le=({players:n,setPlayers:s,register:C,errors:m,setValue:y,useElo:S,onAddPlayer:v})=>{const{t:u}=D();function O(t){const a=n.filter(o=>o.id!==t).map((o,i)=>({...o,seed:i+1}));s(a)}function E(t){if(t===0)return;const a=[...n],o=a[t-1],i=a[t];!o||!i||(a[t-1]=i,a[t]=o,s(a.map((x,b)=>({...x,seed:b+1}))))}function T(t){if(t===n.length-1)return;const a=[...n],o=a[t],i=a[t+1];!o||!i||(a[t]=i,a[t+1]=o,s(a.map((x,b)=>({...x,seed:b+1}))))}function N(){const t=[...n];for(let a=t.length-1;a>0;a--){const o=Math.floor(Math.random()*(a+1)),i=t[a],x=t[o];!i||!x||(t[a]=x,t[o]=i)}s(t.map((a,o)=>({...a,seed:o+1})))}function d(){const t=[...n].toSorted((a,o)=>{const i=Number(a.elo),x=Number(o.elo),b=Number.isFinite(i)?i:0,_=Number.isFinite(x)?x:0;return _!==b?_-b:(a.seed??0)-(o.seed??0)});s(t.map((a,o)=>({...a,seed:o+1})))}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(M,{children:u("players.title",{count:n.length})}),n.length>1&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{type:"button",variant:"link",onClick:d,disabled:!S,className:"text-sm px-0 h-auto",children:u("players.sortByElo")}),e.jsx(j,{type:"button",variant:"link",onClick:N,className:"text-sm px-0 h-auto",children:u("players.shuffle")})]})]}),e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 sm:flex sm:gap-2",children:[e.jsx(f,{id:"player-name",type:"text","aria-label":u("players.placeholder"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),v())},placeholder:u("players.placeholder"),className:"min-w-0 sm:flex-1",...C("playerName",{validate:t=>{const a=t.trim();return a?!n.some(o=>o.name.toLowerCase()===a.toLowerCase())||u("players.errorUnique"):!0}})}),e.jsx(j,{type:"button",onClick:()=>{v()},children:u("players.add")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{id:"use-elo",checked:S,onCheckedChange:t=>{y("useElo",t===!0)}}),e.jsx(g,{htmlFor:"use-elo",className:"text-sm text-[var(--color-text)]",children:u("players.useElo")}),e.jsx(f,{id:"elo-rating",type:"number",min:"0","aria-label":u("players.eloPlaceholder"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),v())},placeholder:u("players.eloPlaceholder"),disabled:!S,className:"w-24",...C("playerElo",{valueAsNumber:!0})})]})]}),m.playerName&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm mb-2",children:m.playerName.message}),e.jsx("ul",{className:"space-y-1",children:n.map((t,a)=>e.jsxs("li",{className:"flex items-center gap-2 border border-[var(--color-border)] rounded-lg px-3 py-2 hover:border-[var(--color-border-strong)] hover:bg-[var(--color-soft)] transition-colors",children:[e.jsxs("span",{className:"text-[var(--color-faint)] text-sm w-6 text-right",children:["#",t.seed]}),e.jsx("span",{className:"flex-1 text-sm",children:t.name}),t.elo!=null&&e.jsx("span",{className:"text-xs text-[var(--color-faint)]",children:u("players.elo",{elo:t.elo})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{E(a)},disabled:a===0,className:"h-auto px-1.5 py-0.5 text-[var(--color-faint)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)]",children:e.jsx(ae,{className:"h-3.5 w-3.5"})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{T(a)},disabled:a===n.length-1,className:"h-auto px-1.5 py-0.5 text-[var(--color-faint)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)]",children:e.jsx(se,{className:"h-3.5 w-3.5"})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{O(t.id)},className:"h-auto px-1.5 py-0.5 text-[var(--color-accent)] hover:text-[var(--color-primary-dark)] hover:bg-[var(--color-accent-soft)]",children:e.jsx(oe,{className:"h-3.5 w-3.5"})})]},t.id))})]})},he=()=>{const n=K(),{t:s}=D(),{tracker:C}=X();W(s("create.title"));const{register:m,control:y,handleSubmit:S,setValue:v,setError:u,trigger:O,getValues:E,resetField:T,formState:{errors:N}}=$({defaultValues:{name:"",format:c.SINGLE_ELIM,scoringMode:U.SETS,maxSets:I,groupStageMaxSets:I,bracketMaxSets:I,groupCount:2,consolation:!1,bracketType:L.SINGLE_ELIM,qualifiers:[{value:2},{value:2}],playerName:"",playerElo:1e3,useElo:!1}}),[d,t]=V.useState([]),{fields:a,append:o,remove:i}=z({control:y,name:"qualifiers"}),x=w({control:y,name:"format"}),b=w({control:y,name:"scoringMode"}),_=w({control:y,name:"bracketType"}),G=w({control:y,name:"useElo"});async function P(){if(!await O("playerName"))return;const l=E("playerName").trim();if(!l)return;const h=E("playerElo"),p=E("useElo");t([...d,{id:crypto.randomUUID(),name:l,seed:d.length+1,elo:p&&Number.isFinite(h)?h:void 0}]),T("playerName"),T("playerElo")}function A(r){const l=Number.parseInt(r,10);return Number.isFinite(l)?Math.max(1,l):I}function F(r){const l=Math.max(1,Number.parseInt(r,10)||1);if(v("groupCount",l),l>a.length){const h=l-a.length;for(let p=0;p<h;p++)o({value:2})}else if(l<a.length){const h=Array.from({length:a.length-l},(p,B)=>l+B);i(h)}}const q=S(r=>{if(d.length<R){u("root",{message:s("create.errorPlayers",{minPlayers:R})});return}if(r.format===c.GROUPS_TO_BRACKET&&r.groupCount>d.length){u("root",{message:s("create.errorGroupsTooMany")});return}const l=r.qualifiers.map(k=>k.value),h={id:crypto.randomUUID(),name:r.name.trim(),scoringMode:r.scoringMode,maxSets:r.maxSets,groupStageMaxSets:r.groupStageMaxSets,bracketMaxSets:r.bracketMaxSets,players:d.map(k=>({...k})),createdAt:new Date().toISOString(),completedAt:null,winnerId:null};let p;switch(r.format){case c.SINGLE_ELIM:{p={...h,format:c.SINGLE_ELIM,bracket:re(d)};break}case c.ROUND_ROBIN:{p={...h,format:c.ROUND_ROBIN,schedule:ee(d)};break}case c.DOUBLE_ELIM:{p={...h,format:c.DOUBLE_ELIM,doubleElim:Z(d)};break}case c.GROUPS_TO_BRACKET:{const k=J(d,{groupCount:r.groupCount,qualifiers:l,consolation:r.consolation,bracketType:r.bracketType});p={...h,format:c.GROUPS_TO_BRACKET,groupStage:k,groupStagePlayoffs:null};break}default:throw new Error(`Unsupported format: ${String(r.format)}`)}const B={[c.SINGLE_ELIM]:L.SINGLE_ELIM,[c.DOUBLE_ELIM]:L.DOUBLE_ELIM,[c.GROUPS_TO_BRACKET]:r.bracketType,[c.ROUND_ROBIN]:"none"};C.trackTournamentCreated({tournament_type:r.format,scoring_mode:r.scoringMode,player_count:d.length,playoff_type:B[r.format]??"none"}),Y.save(p),n(`/tournament/${p.id}`)});return e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--color-text)] mb-8",children:s("create.title")}),e.jsxs("form",{onSubmit:r=>{q(r)},className:"space-y-7",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"tournament-name",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.nameLabel")}),e.jsx(f,{id:"tournament-name",type:"text",placeholder:s("create.namePlaceholder"),...m("name",{required:s("create.errorName")})}),N.name&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm mt-1",children:N.name.message})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.formatLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(c).map(r=>e.jsxs("label",{className:`flex items-center justify-center flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${x===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("format")}),s(`format.${r}`)]},r))})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.scoringLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(U).map(r=>e.jsxs("label",{className:`flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${b===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("scoringMode")}),s(r===U.SETS?"create.scoringSets":"create.scoringPoints")]},r))})]}),x!==c.GROUPS_TO_BRACKET&&e.jsxs("div",{children:[e.jsx(g,{htmlFor:"max-sets",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.maxSetsLabel")}),e.jsx(f,{id:"max-sets",type:"number",min:"1",className:"w-24",...m("maxSets",{valueAsNumber:!0,onChange:r=>{v("maxSets",A(r.target.value))}})})]}),x===c.GROUPS_TO_BRACKET&&e.jsxs("div",{className:"space-y-4 border border-[var(--color-border)] rounded-xl p-5 bg-[var(--color-soft)]",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:s("create.groupStageTitle")}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(g,{className:"text-xs text-[var(--color-muted)]",children:[s("create.maxSetsGroupLabel"),e.jsx(f,{id:"group-stage-max-sets",type:"number",min:"1",className:"mt-1 w-24 h-8 px-2 py-1",...m("groupStageMaxSets",{valueAsNumber:!0,onChange:r=>{v("groupStageMaxSets",A(r.target.value))}})})]}),e.jsxs(g,{className:"text-xs text-[var(--color-muted)]",children:[s("create.maxSetsBracketLabel"),e.jsx(f,{id:"bracket-max-sets",type:"number",min:"1",className:"mt-1 w-24 h-8 px-2 py-1",...m("bracketMaxSets",{valueAsNumber:!0,onChange:r=>{v("bracketMaxSets",A(r.target.value))}})})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"group-count",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.groupCountLabel")}),e.jsx(f,{id:"group-count",type:"number",min:"1",className:"w-24",...m("groupCount",{valueAsNumber:!0,onChange:r=>{F(r.target.value)}})})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.qualifiersLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.map((r,l)=>e.jsxs(g,{className:"text-xs text-[var(--color-muted)]",children:[s("create.groupLabel",{label:te(l)}),e.jsx(f,{type:"number",min:"0",className:"mt-1 w-full h-8 px-2 py-1",...m(`qualifiers.${l}.value`,{valueAsNumber:!0})})]},r.id))})]}),e.jsxs(g,{className:"flex items-center gap-2 text-sm text-[var(--color-text)]",children:[e.jsx("input",{id:"consolation",type:"checkbox",...m("consolation")}),s("create.consolationLabel")]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.bracketTypeLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(L).map(r=>e.jsxs("label",{className:`flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${_===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("bracketType")}),s(r===L.SINGLE_ELIM?"create.bracketTypeSingle":"create.bracketTypeDouble")]},r))})]})]}),e.jsx(le,{players:d,setPlayers:t,register:m,errors:N,setValue:v,useElo:G,onAddPlayer:()=>{P()}}),N.root&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm",children:N.root.message}),e.jsx(j,{type:"submit",className:"w-full bg-[var(--color-primary)] text-[var(--color-surface)] py-3 rounded-lg font-medium shadow-sm hover:shadow-md hover:bg-[var(--color-primary-dark)] active:scale-[0.99]",children:s("create.submit")})]})]})};export{he as CreateTournamentPage};
