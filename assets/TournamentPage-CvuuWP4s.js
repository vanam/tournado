import{r as h,j as t,b as qe,m as pt,L as se,h as ft}from"./react-vendor-B7IL4Whh.js";import{F as H,p as xe,S as R,B as ht,a as De}from"./ConfirmModal-DihrUlho.js";import{c as $,u as w,D as J,B as re,a as bt}from"./index-eCmkk7TN.js";import{u as gt}from"./usePageTitle-CbqaavSR.js";import{h as pe,j as ke,k as fe,B as Q,M as X,l as Ue,S as oe,m as Ve,n as Je,o as Y,p as Ye,q as Qe,r as ae,s as be,t as he,u as Xe,v as jt,w as Be,i as ge,x as we,y as yt,z as Ze,A as vt,D as Pe,E as Fe,F as Nt,G as We,H as St,J as kt}from"./BracketRounds-Bf6MOny0.js";import{c as et,d as Le,b as wt,X as It,e as Tt,f as Et}from"./icons-kaZEYU8o.js";import{h as Rt,i as tt,j as nt,k as st}from"./radix-ui-BObq5o7x.js";import"./notifications-B5Q4qzS0.js";const rt=h.createContext(null);function je(){const e=h.useContext(rt);if(!e)throw new Error("useTournament must be used within TournamentProvider");return e}function ye(e){const{tournament:n,updateTournament:s,isLoading:r}=je(),a=n?.format===e?n:null,l=h.useCallback(i=>{s(o=>o.format!==e?o:i(o))},[s,e]);return{tournament:a,updateTournament:l,isLoading:r}}function Ct(){const{tournament:e,updateTournament:n,isLoading:s}=je(),r=e?.format===H.GROUPS_TO_BRACKET?e:null,a=h.useCallback(l=>{n(i=>i.format!==H.GROUPS_TO_BRACKET?i:typeof l=="function"?l(i):l)},[n]);return{tournament:r,updateTournament:a,isLoading:s}}const Mt=({tournamentId:e,children:n})=>{const s=h.useSyncExternalStore(xe.subscribe,h.useCallback(()=>xe.load(e),[e])),r=h.useCallback(l=>{const i=xe.load(e);i&&xe.save(l(i))},[e]),a=h.useMemo(()=>({tournament:s,updateTournament:r,isLoading:!1}),[s,r]);return t.jsx(rt.Provider,{value:a,children:n})},ie=({label:e})=>e?t.jsx("div",{className:"mb-6 bg-[var(--color-accent-soft)] border border-[var(--color-accent-border)] rounded-xl p-5 shadow-sm text-center",children:t.jsxs("p",{className:"text-xl font-bold text-[var(--color-accent)] tracking-wide",children:[t.jsx(et,{className:"h-6 w-6 inline-block mr-2 text-[var(--color-accent)]"}),e]})}):null,Dt=Rt,at=h.forwardRef(({className:e,...n},s)=>t.jsx(tt,{ref:s,className:$("inline-flex h-10 items-center justify-start rounded-md bg-muted p-1 text-muted-foreground",e),...n}));at.displayName=tt.displayName;const ot=h.forwardRef(({className:e,...n},s)=>t.jsx(nt,{ref:s,className:$("inline-flex items-center justify-center whitespace-nowrap px-4 py-2.5 text-sm font-medium","border-b-2 border-transparent -mb-px transition-all","disabled:pointer-events-none disabled:opacity-40","data-[state=active]:border-[var(--color-primary)] data-[state=active]:text-[var(--color-primary)]","data-[state=inactive]:text-[var(--color-muted)] data-[state=inactive]:hover:bg-[var(--color-soft)] data-[state=inactive]:hover:rounded-sm hover:text-[var(--color-text)]",e),...n}));ot.displayName=nt.displayName;const Bt=h.forwardRef(({className:e,...n},s)=>t.jsx(st,{ref:s,className:$("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...n}));Bt.displayName=st.displayName;const Z=({tabs:e,activeId:n,onChange:s,className:r=""})=>{const a=l=>{s(l)};return t.jsx(Dt,{value:n,onValueChange:a,className:r,children:t.jsx(at,{className:`flex gap-1 mb-4 border-b border-[var(--color-border-soft)] overflow-x-auto overflow-y-hidden bg-transparent h-auto p-0 rounded-none ${r}`.trim(),children:e.map(l=>t.jsx(ot,{value:l.id,className:"flex-shrink-0",children:l.label},l.id))})})},le=h.forwardRef(({className:e,...n},s)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:s,className:$("w-full caption-bottom text-sm",e),...n})}));le.displayName="Table";const ce=h.forwardRef(({className:e,...n},s)=>t.jsx("thead",{ref:s,className:$("[&_tr]:border-b",e),...n}));ce.displayName="TableHeader";const de=h.forwardRef(({className:e,...n},s)=>t.jsx("tbody",{ref:s,className:$("[&_tr:last-child]:border-0",e),...n}));de.displayName="TableBody";const Pt=h.forwardRef(({className:e,...n},s)=>t.jsx("tfoot",{ref:s,className:$("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...n}));Pt.displayName="TableFooter";const W=h.forwardRef(({className:e,...n},s)=>t.jsx("tr",{ref:s,className:$("border-b border-[var(--color-border-soft)] transition-colors hover:bg-[var(--color-soft)] data-[state=selected]:bg-muted",e),...n}));W.displayName="TableRow";const E=h.forwardRef(({className:e,...n},s)=>t.jsx("th",{ref:s,className:$("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...n}));E.displayName="TableHead";const N=h.forwardRef(({className:e,...n},s)=>t.jsx("td",{ref:s,className:$("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...n}));N.displayName="TableCell";const Ft=h.forwardRef(({className:e,...n},s)=>t.jsx("caption",{ref:s,className:$("mt-4 text-sm text-muted-foreground",e),...n}));Ft.displayName="TableCaption";function Wt(e,n){return e==null?"?":e===n||n==null?`${e}.`:`${e}.-${n}.`}function Lt(e){return e===1?"bg-[var(--color-podium-gold)] font-semibold":e===2?"bg-[var(--color-podium-silver)]":e===3?"bg-[var(--color-podium-bronze)]":""}const ue=({results:e})=>{const{t:n}=w();return!e||e.length===0?null:t.jsxs(le,{children:[t.jsx(ce,{children:t.jsxs(W,{className:"border-b-2 border-[var(--color-border)]",children:[t.jsx(E,{className:"py-2.5 pr-3 text-xs uppercase tracking-wider font-semibold text-[var(--color-muted)]",children:n("results.rank")}),t.jsx(E,{className:"py-2.5 pr-3 text-xs uppercase tracking-wider font-semibold text-[var(--color-muted)]",children:n("results.player")})]})}),t.jsx(de,{children:e.map(s=>t.jsxs(W,{className:Lt(s.rankStart),children:[t.jsxs(N,{className:"py-2.5 pr-3 text-[var(--color-faint)] tabular-nums",children:[s.rankStart===1&&t.jsx(et,{className:"h-4 w-4 inline-block mr-1 text-yellow-500"}),s.rankStart===2&&t.jsx(Le,{className:"h-4 w-4 inline-block mr-1 text-gray-400"}),s.rankStart===3&&t.jsx(Le,{className:"h-4 w-4 inline-block mr-1 text-amber-600"}),Wt(s.rankStart,s.rankEnd)]}),t.jsx(N,{className:"py-2.5 pr-3 font-medium",children:s.name})]},s.playerId))})]})};function He(e,n){const s=(e.setsWon??0)-(e.setsLost??0),r=[e.points??0,s,e.setsWon??0];if(n===R.POINTS){const a=(e.pointsWon??0)-(e.pointsLost??0);r.push(a)}return r.join("|")}function Ht(e,n={}){const s=n.scoringMode??R.SETS,r=[];let a=0;for(;a<e.length;){const l=e[a];if(!l)break;const i=He(l,s);let o=a+1;for(;o<e.length;){const u=e[o];if(!u||He(u,s)!==i)break;o+=1}const c=a+1,d=o;for(let u=a;u<o;u+=1){const m=e[u];m&&r.push({...m,rankStart:c,rankEnd:d})}a=o}return r}function $t(e,n,s={}){const r=ke(e,n,s);return Ht(r,s)}function At(e){const n=new Set;if(!e)return n;for(const s of e.rounds)for(const r of s)r.player1Id&&n.add(r.player1Id),r.player2Id&&n.add(r.player2Id);return n}function it(e,n){const s=new Map;let r=n;for(const a of e){if(a.length===0)continue;const l=r-a.length+1,i=r;for(const o of a)s.set(o,{rankStart:l,rankEnd:i});r=l-1}return{rankByPlayer:s}}function Ce(e){return[...e].toSorted((n,s)=>{const r=n.rankStart??Number.POSITIVE_INFINITY,a=s.rankStart??Number.POSITIVE_INFINITY;if(r!==a)return r-a;const l=n.rankEnd??Number.POSITIVE_INFINITY,i=s.rankEnd??Number.POSITIVE_INFINITY;return l!==i?l-i:n.name.localeCompare(s.name)})}function $e(e,n){return n?e.map(s=>s.rankStart==null||s.rankEnd==null?s:{...s,rankStart:s.rankStart+n,rankEnd:s.rankEnd+n}):e}function Ie(e,n){if(!e)return[];const s=new Map(n.map(d=>[d.id,d])),r=[...At(e)],a=[],l=new Set;for(const[d,u]of e.rounds.entries()){const m=[];for(const p of u){if(!p.winnerId||!p.player1Id||!p.player2Id)continue;const f=p.winnerId===p.player1Id?p.player2Id:p.player1Id;l.has(f)||(l.add(f),m.push(f))}a[d]=m}const{rankByPlayer:i}=it(a,r.length),o=pe(e);if(o&&i.set(o,{rankStart:1,rankEnd:1}),e.thirdPlaceMatch?.winnerId){const d=e.thirdPlaceMatch,u=d.winnerId===d.player1Id?d.player2Id:d.player1Id;d.winnerId&&i.set(d.winnerId,{rankStart:3,rankEnd:3}),u&&i.set(u,{rankStart:4,rankEnd:4})}const c=r.map(d=>{const u=s.get(d);return{playerId:d,name:u?.name??d,...i.get(d)}});return Ce(c)}function Ot(e){const n=new Set;if(!e)return n;for(const r of e.winners.rounds)for(const a of r)a.player1Id&&n.add(a.player1Id),a.player2Id&&n.add(a.player2Id);for(const r of e.losers.rounds)for(const a of r)a.player1Id&&n.add(a.player1Id),a.player2Id&&n.add(a.player2Id);const s=e.finals;return s.grandFinal.player1Id&&n.add(s.grandFinal.player1Id),s.grandFinal.player2Id&&n.add(s.grandFinal.player2Id),s.resetFinal.player1Id&&n.add(s.resetFinal.player1Id),s.resetFinal.player2Id&&n.add(s.resetFinal.player2Id),n}function Te(e,n){if(!e)return[];const s=new Map(n.map(x=>[x.id,x])),r=[...Ot(e)],a=new Map(r.map(x=>[x,0])),l=new Set,i=e.losers.rounds,o=Array.from({length:i.length+2},()=>[]),c=x=>{if(!x?.winnerId||!x.player1Id||!x.player2Id)return;const g=x.winnerId===x.player1Id?x.player2Id:x.player1Id;a.set(g,(a.get(g)??0)+1)},d=(x,g)=>{if(!x?.winnerId||!x.player1Id||!x.player2Id)return;const b=x.winnerId===x.player1Id?x.player2Id:x.player1Id;if(l.has(b))return;const I=(a.get(b)??0)+1;if(a.set(b,I),I>=2){const k=o[g];k&&k.push(b),l.add(b)}};for(const x of e.winners.rounds)for(const g of x)c(g);for(const[x,g]of i.entries())for(const b of g)d(b,x);const u=i.length;d(e.finals.grandFinal,u),d(e.finals.resetFinal,u+1);const{rankByPlayer:m}=it(o,r.length),p=fe(e);p&&m.set(p,{rankStart:1,rankEnd:1});const f=r.map(x=>{const g=s.get(x);return{playerId:x,name:g?.name??x,...m.get(x)}});return Ce(f)}const Gt=()=>{const{tournament:e,updateTournament:n}=ye(H.SINGLE_ELIM),[s,r]=h.useState(null),[a,l]=h.useState("playoff"),{t:i}=w();if(!e)return null;const{bracket:o,players:c}=e,d=e.scoringMode??R.SETS,u=e.maxSets??J,m=pe(o),p=o.thirdPlaceMatch,f=[{id:"playoff",label:i("tabs.playoff")},{id:"results",label:i("tabs.results")}];function x(g,b,I,k=!1){n(y=>{const T=b?Ve(structuredClone(y.bracket),g,b,I,k):Je(structuredClone(y.bracket),g),A=pe(T);return{...y,bracket:T,winnerId:A,completedAt:A?new Date().toISOString():null}}),r(null)}return t.jsxs("div",{children:[m&&t.jsx(ie,{label:i("bracket.winner",{name:c.find(g=>g.id===m)?.name??""})}),t.jsx(Z,{tabs:f,activeId:a,onChange:l}),a==="playoff"?t.jsxs(t.Fragment,{children:[t.jsx(Q,{bracket:o,players:c,scoringMode:d,maxSets:u,showSeedNumbers:!0,onEditMatch:g=>{r(g)}}),p&&(p.player1Id??p.player2Id)&&t.jsxs("div",{className:"mt-6",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:i("bracket.thirdPlace")}),t.jsx(X,{match:p,players:c,canEdit:Ue(o,p.id),onClick:()=>{r(p)},scoringMode:d,maxSets:u,roundIndex:o.rounds.length})]}),s&&t.jsx(oe,{match:s,players:c,scoringMode:d,maxSets:u,onSave:x,onClose:()=>{r(null)}})]}):t.jsx(ue,{results:Ie(o,c)})]})};function Ae(e){return e?e.player1Id||e.player2Id||e.winnerId?!0:Array.isArray(e.scores)&&e.scores.length>0:!1}const _t=()=>{const{tournament:e,updateTournament:n}=ye(H.DOUBLE_ELIM),{t:s}=w(),[r,a]=h.useState(null),[l,i]=h.useState("playoff"),o=e?.doubleElim,c=h.useMemo(()=>e?.players??[],[e?.players]),d=e?.scoringMode??R.SETS,u=e?.maxSets??J,m=[{id:"playoff",label:s("tabs.playoff")},{id:"results",label:s("tabs.results")}],p=h.useMemo(()=>o?fe(o):null,[o]),f=h.useMemo(()=>p?c.find(y=>y.id===p):null,[c,p]),x=o?.winners.rounds.length??0;function g(y,T,A,L=!1){o&&(n(P=>{const C=T?Ye(structuredClone(P.doubleElim),y,T,A,L):Qe(structuredClone(P.doubleElim),y),v=fe(C);return{...P,doubleElim:C,winnerId:v,completedAt:v?new Date().toISOString():null}}),a(null))}if(!e||!o)return null;const b=o.finals,I=Ae(b.grandFinal),k=Ae(b.resetFinal);return t.jsxs("div",{className:"space-y-8",children:[f&&t.jsx(ie,{label:s("bracket.winner",{name:c.find(y=>y.id===f.id)?.name??""})}),t.jsx(Z,{tabs:m,activeId:l,onChange:i}),l==="playoff"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:s("doubleElim.winnersBracket")}),t.jsx(Q,{bracket:o.winners,players:c,scoringMode:d,maxSets:u,showSeedNumbers:!0,onEditMatch:y=>{a(y)},canEditMatchFn:(y,T)=>Y(o,T)})]}),o.losers.rounds.length>0&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:s("doubleElim.losersBracket")}),t.jsx(Q,{bracket:o.losers,players:c,scoringMode:d,maxSets:u,showSeedNumbers:!0,onEditMatch:y=>{a(y)},canEditMatchFn:(y,T)=>Y(o,T)})]}),(I||k)&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:s("doubleElim.grandFinal")}),I&&t.jsx(X,{match:b.grandFinal,players:c,canEdit:Y(o,b.grandFinal.id),scoringMode:d,maxSets:u,showSeedNumbers:!0,roundIndex:x,onClick:()=>{a(b.grandFinal)}}),k&&t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:s("doubleElim.resetFinal")}),t.jsx(X,{match:b.resetFinal,players:c,canEdit:Y(o,b.resetFinal.id),scoringMode:d,maxSets:u,showSeedNumbers:!0,roundIndex:x,onClick:()=>{a(b.resetFinal)}})]})]}),r&&t.jsx(oe,{match:r,players:c,scoringMode:d,maxSets:u,onSave:g,onClose:()=>{a(null)}})]}):t.jsx(ue,{results:Te(o,c)})]})};function zt(e,n,s,r){const a=n.filter(o=>o==="headToHead"||o==="headToHeadSetDiff"||o==="headToHeadSetsWon"||o==="setDiff"||o==="setsWon"||o==="pointsDiff"),l={headToHead:s("roundRobin.tiebreakH2H"),headToHeadSetDiff:s("roundRobin.tiebreakH2HSetDiff"),headToHeadSetsWon:s("roundRobin.tiebreakH2HSetsWon"),setDiff:s("roundRobin.tiebreakSetDiff"),setsWon:s("roundRobin.tiebreakSetsWon"),pointsDiff:s("roundRobin.tiebreakPointsDiff")},i={headToHead:s("roundRobin.tiebreakH2HHelp"),headToHeadSetDiff:s("roundRobin.tiebreakH2HSetDiffHelp"),headToHeadSetsWon:s("roundRobin.tiebreakH2HSetsWonHelp"),setDiff:s("roundRobin.tiebreakSetDiffHelp"),setsWon:s("roundRobin.tiebreakSetsWonHelp"),pointsDiff:s("roundRobin.tiebreakPointsDiffHelp")};return a.filter(o=>r||o!=="pointsDiff").map(o=>{let c="-";return o==="headToHead"&&(c=String(e.headToHead)),o==="headToHeadSetDiff"&&(c=Se(e.headToHeadSetDiff)),o==="headToHeadSetsWon"&&(c=String(e.headToHeadSetsWon)),o==="setDiff"&&(c=Se(e.setDiff)),o==="setsWon"&&(c=String(e.setsWon)),o==="pointsDiff"&&(c=Se(e.pointsDiff)),{key:o,label:l[o],value:c,help:i[o]}})}function Se(e){const n=e.toFixed(0);return e>0?`+${n}`:n}const Kt=({details:e,applied:n,t:s,showBalls:r})=>{const a=zt(e,n,s,r);return a.length===0?null:t.jsx("table",{className:"w-full text-[0.7rem] text-[var(--color-muted)]",children:t.jsx("tbody",{children:a.map(l=>t.jsxs(W,{className:"border-t border-[var(--color-border-soft)]",children:[t.jsx(N,{className:"py-1 pr-2 font-medium p-0",children:t.jsx("span",{className:"underline decoration-dotted underline-offset-2 cursor-help",title:l.help,children:l.label})}),t.jsx(N,{className:"py-1 text-right p-0",children:l.value})]},l.key))})})},qt=({isExpanded:e})=>t.jsx("span",{className:"mr-1 inline-flex h-3 w-3 items-center justify-center text-[var(--color-muted)]","aria-hidden":"true",children:t.jsx("svg",{viewBox:"0 0 20 20",className:`h-3 w-3 transition-transform ${e?"rotate-90":"rotate-0"}`,fill:"currentColor",children:t.jsx("path",{d:"M7.5 5.5 12.5 10 7.5 14.5"})})}),Ut=({name:e,isWildCard:n,elo:s,t:r})=>t.jsx(N,{className:"py-2.5 pr-3 font-medium",children:t.jsxs("span",{className:"inline-flex items-center gap-2",children:[t.jsx("span",{children:e}),n&&t.jsx(ht,{variant:"accent",className:"text-[10px] px-1.5 py-0.5",children:r("groupStage.wildCardBadge")}),s!=null&&t.jsx("span",{className:"text-xs font-normal text-[var(--color-muted)]",children:r("players.elo",{elo:s})})]})}),Vt=({tiebreakDetails:e,rowClass:n,colSpan:s,t:r,showBalls:a})=>t.jsx(W,{className:n,children:t.jsx(N,{className:"px-2",colSpan:s,children:t.jsx(Kt,{details:e,applied:e.tiebreakApplied,t:r,showBalls:a})})}),Jt=({row:e,rank:n,isDirectQualifier:s,isWildCard:r,hasTiebreak:a,isExpanded:l,showBalls:i,onToggleExpand:o,t:c})=>{let d="";s?d="bg-[var(--color-soft)]":r&&(d="bg-[var(--color-accent-soft)]");const u=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),o())},m=i?8:7;return t.jsxs(h.Fragment,{children:[t.jsxs(W,{className:`transition-colors ${d} ${a?"cursor-pointer":""}`,onClick:a?o:void 0,onKeyDown:a?u:void 0,role:a?"button":void 0,tabIndex:a?0:void 0,"aria-expanded":a?l:void 0,children:[t.jsxs(N,{className:"py-2.5 pr-3 text-[var(--color-faint)] tabular-nums",children:[a&&t.jsx(qt,{isExpanded:l}),n]}),t.jsx(Ut,{name:e.name,isWildCard:r,elo:e.elo,t:c}),t.jsx(N,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.played}),t.jsx(N,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.wins}),t.jsx(N,{className:"py-2.5 pr-3 text-center tabular-nums",children:e.losses}),t.jsxs(N,{className:"py-2.5 pr-3 text-center tabular-nums",children:[e.setsWon,"-",e.setsLost]}),i&&t.jsxs(N,{className:"py-2.5 pr-3 text-center tabular-nums",children:[e.pointsWon,"-",e.pointsLost]}),t.jsx(N,{className:"py-2.5 text-center font-semibold tabular-nums",children:e.points})]}),l&&e.tiebreakDetails&&t.jsx(Vt,{tiebreakDetails:e.tiebreakDetails,rowClass:d,colSpan:m,t:c,showBalls:i})]})},lt=({standings:e,highlightCount:n=0,wildCardIds:s,scoringMode:r=R.SETS})=>{const{t:a}=w(),[l,i]=h.useState(null),o=Math.max(0,Number.parseInt(String(n),10)||0),c=e.length===1&&o>0,d=r===R.POINTS;return t.jsxs(le,{children:[t.jsx(ce,{children:t.jsxs(W,{className:"border-b-2 border-[var(--color-border)]",children:[t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.rank")}),t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.player")}),t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.played")}),t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.wins")}),t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.losses")}),t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.sets")}),d&&t.jsx(E,{className:"py-2.5 pr-2 sm:pr-3 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.balls")}),t.jsx(E,{className:"py-2.5 text-center text-xs uppercase tracking-wider font-semibold whitespace-nowrap text-[var(--color-muted)]",children:a("standings.points")})]})}),t.jsx(de,{children:e.map((u,m)=>{const p=(u.played>0||c)&&(m===0||o>0&&m<o),f=s?.has(u.playerId)??!1,x=u.tiebreakDetails!=null&&u.tiebreakDetails.tiebreakApplied.length>0,g=l===u.playerId,b=()=>{i(I=>I===u.playerId?null:u.playerId)};return t.jsx(Jt,{row:u,rank:m+1,isDirectQualifier:p,isWildCard:f,hasTiebreak:x,isExpanded:g,showBalls:d,onToggleExpand:b,t:a},u.playerId)})})]})};function Yt(e,n,s){const r=[n,s].toSorted((a,l)=>a.localeCompare(l)).join("|");return e.get(r)}function Qt(e,n){return e.filter(s=>Array.isArray(s)).map(s=>{const r=s[0],a=s[1];if(he(r)||he(a)){const o=Xe(r,a);return o===0?null:{text:"WO",isWin:n?o===2:o===1}}const l=n?a:r,i=n?r:a;return!Number.isFinite(l)||!Number.isFinite(i)?null:{text:`${l}-${i}`,isWin:l>i}}).filter(s=>s!=null)}const Xt=({players:e})=>t.jsx(ce,{children:t.jsxs(W,{className:"border-b-0 hover:bg-transparent",children:[t.jsx(E,{className:"py-2 pr-3 sticky left-0 z-10"}),e.map(n=>t.jsx(E,{className:"py-2 pr-3 text-left font-medium text-[var(--color-text)] sticky left-0 z-10 whitespace-nowrap",children:n.name},n.id))]})}),Zt=({rowPlayer:e,colPlayer:n,match:s,showPoints:r,scoringMode:a,maxSets:l})=>{if(e.id===n.id)return t.jsx(N,{className:"py-2 px-2 text-center bg-[var(--color-soft)] text-[var(--color-faint)]",children:"-"});if(!s||s.scores.length===0){if(s?.walkover||ae(s?.scores??[])){const f=s?.winnerId===e.id;return t.jsx(N,{className:`py-2 px-2 text-center ${f?"font-semibold":"text-[var(--color-muted)]"}`,children:t.jsx("div",{className:"font-mono text-xs",children:"WO"})})}return t.jsx(N,{className:"py-2 px-2 text-center text-[var(--color-faintest)]",children:"-"})}const i=s.player1Id!==e.id,{p1Sets:o,p2Sets:c}=be(s.scores,{scoringMode:a,maxSets:l}),d=i?`${c}-${o}`:`${o}-${c}`,u=s.walkover||ae(s.scores);let m;s.winnerId?m=s.winnerId===e.id:i?m=c>o:m=o>c;const p=r?Qt(s.scores,i):[];return t.jsxs(N,{className:"py-2 px-2 text-center",children:[t.jsx("div",{className:`font-mono text-xs ${m?"font-semibold":"text-[var(--color-text)]"}`,children:u?d+" WO":d}),r&&p.length>0&&t.jsx("div",{className:"text-[10px] text-[var(--color-faint)]",children:p.map((f,x)=>t.jsxs("span",{className:f.isWin?"font-semibold":"",children:[x>0?", ":"",f.text]},`set-${x}`))})]})},en=({rowPlayer:e,players:n,matchIndex:s,showPoints:r,scoringMode:a,maxSets:l})=>t.jsxs(W,{children:[t.jsx(E,{className:"py-2 pr-3 text-left font-medium text-[var(--color-text)] sticky left-0 z-10 whitespace-nowrap",children:e.name}),n.map(i=>{const o=Yt(s,e.id,i.id);return t.jsx(Zt,{rowPlayer:e,colPlayer:i,match:o,showPoints:r,scoringMode:a,maxSets:l},i.id)})]}),ct=({players:e,schedule:n,scoringMode:s=R.SETS,maxSets:r})=>{const a=s===R.POINTS,l=h.useMemo(()=>{const i=new Map;for(const o of n.rounds)for(const c of o.matches){const d=[c.player1Id,c.player2Id].toSorted((u,m)=>u===null&&m===null?0:u===null?1:m===null?-1:u.localeCompare(m)).join("|");i.set(d,c)}return i},[n]);return t.jsxs(le,{className:"border-separate border-spacing-0",children:[t.jsx(Xt,{players:e}),t.jsx(de,{children:e.map(i=>t.jsx(en,{rowPlayer:i,players:e,matchIndex:l,showPoints:a,scoringMode:s,maxSets:r},i.id))})]})},tn=({match:e,players:n,onEdit:s,scoringMode:r=R.SETS,maxSets:a})=>{const{t:l}=w(),i=n.find(x=>x.id===e.player1Id),o=n.find(x=>x.id===e.player2Id),c=r===R.POINTS,{p1Sets:d,p2Sets:u}=be(e.scores,{scoringMode:r,maxSets:a}),m=e.walkover||ae(e.scores),p=c?jt(e.scores):"",f=c?e.scores.filter(x=>Array.isArray(x)).map(x=>nn(x,e)).filter(x=>x!=null):[];return t.jsxs("div",{onClick:()=>{s(e)},className:"flex items-center gap-3 border border-[var(--color-border)] bg-[var(--color-card)] rounded-lg px-3 py-2.5 cursor-pointer hover:border-[var(--color-primary)] hover:shadow-md hover:-translate-y-px transition-all duration-150 text-sm",role:"button",tabIndex:0,"aria-label":l("bracket.editMatch"),onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),s(e))},children:[t.jsx("span",{className:`flex-1 text-right min-w-0 truncate text-xs sm:text-sm ${e.winnerId===e.player1Id?"font-semibold text-[var(--color-primary-dark)]":""}`,children:i?t.jsxs(t.Fragment,{children:[i.name,i.elo!=null&&t.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:l("players.elo",{elo:i.elo})})]}):null}),e.winnerId?t.jsxs("div",{className:"text-center min-w-[3rem]",children:[t.jsx("div",{className:"text-[var(--color-muted)] font-mono text-xs px-2 py-0.5 rounded bg-[var(--color-soft)]",children:m?"WO":`${d} - ${u}`}),c&&p&&t.jsx("div",{className:"text-[10px] text-[var(--color-faint)]",children:f.map((x,g)=>t.jsxs("span",{className:x.isWinnerSet?"font-semibold text-[var(--color-text)]":"",children:[g>0?", ":"",x.text]},`set-${g}`))})]}):t.jsx("span",{className:"text-[var(--color-faintest)] text-xs min-w-[3rem] text-center",children:l("score.vs")}),t.jsx("span",{className:`flex-1 min-w-0 truncate text-xs sm:text-sm ${e.winnerId===e.player2Id?"font-semibold text-[var(--color-primary-dark)]":""}`,children:o?t.jsxs(t.Fragment,{children:[o.name,o.elo!=null&&t.jsx("span",{className:"ml-2 text-xs font-normal text-[var(--color-muted)]",children:l("players.elo",{elo:o.elo})})]}):null})]})};function nn(e,n){const[s,r]=e;if(he(s)||he(r)){const c=Xe(s,r);if(c===0)return{text:"WO",isWinnerSet:!1};const d=c===1?n.player1Id:n.player2Id;return{text:"WO",isWinnerSet:n.winnerId!=null&&n.winnerId===d}}const a=s,l=r;if(!Number.isFinite(a)||!Number.isFinite(l))return null;let i=0;a>l?i=1:l>a&&(i=2);let o=!1;return i===1?o=n.winnerId===n.player1Id:i===2&&(o=n.winnerId===n.player2Id),{text:`${a}-${l}`,isWinnerSet:o}}const Me=({schedule:e,players:n,onEditMatch:s,scoringMode:r=R.SETS,maxSets:a,roundLabelKey:l="roundRobin.round",byeLabelKey:i="roundRobin.bye"})=>{const{t:o}=w();return t.jsx("div",{className:"space-y-6",children:e.rounds.map(c=>{const d=c.byePlayerId?n.find(u=>u.id===c.byePlayerId):null;return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-muted)] mb-2",children:[o(l,{n:c.roundNumber}),d&&t.jsx("span",{className:"text-[var(--color-faint)] font-normal ml-2",children:o(i,{name:d.elo==null?d.name:`${d.name} (${o("players.elo",{elo:d.elo})})`})})]}),t.jsx("div",{className:"space-y-2",children:c.matches.map(u=>t.jsx(tn,{match:u,players:n,onEdit:s,scoringMode:r,maxSets:a},u.id))})]},c.roundNumber)})})};function sn(e){const n=new Map;for(const s of e.rounds)for(const r of s.matches){if(r.dummy)continue;const a=[r.player1Id,r.player2Id].toSorted((l,i)=>l===null&&i===null?0:l===null?1:i===null?-1:l.localeCompare(i)).join("|");n.set(a,r)}return n}function rn(e,n,s){const r=[n,s].toSorted((a,l)=>a.localeCompare(l)).join("|");return e.get(r)}function an(e,n,s,r){if(!n)return{text:"",bold:!1};if(n.scores.length===0&&!n.walkover)return{text:"",bold:!1};const a=n.walkover||ae(n.scores),l=n.player1Id!==e.id,{p1Sets:i,p2Sets:o}=be(n.scores,{scoringMode:s,maxSets:r}),c=l?`${o}-${i}`:`${i}-${o}`;let d;return n.winnerId?d=n.winnerId===e.id:l?d=o>i:d=i>o,{text:a?`${c} WO`:c,bold:d}}function on(e,n,s,r){const a=n.find(p=>p.id===e.player1Id),l=n.find(p=>p.id===e.player2Id),i=a?.name??"?",o=l?.name??"?";if(e.scores.length===0&&!e.walkover)return`${i} – ${o}`;const c=e.walkover||ae(e.scores),{p1Sets:d,p2Sets:u}=be(e.scores,{scoringMode:s,maxSets:r}),m=c?`${d}-${u} WO`:`${d}-${u}`;return`${i} – ${o}: ${m}`}const te={border:"1px solid #555",padding:"2px 4px",fontSize:"10px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle"},dt=({groupLabel:e,players:n,schedule:s,scoringMode:r,maxSets:a})=>{const{t:l}=w(),i=h.useMemo(()=>sn(s),[s]),o=`${(100/(n.length+1)).toFixed(3)}%`,c=Math.min(Math.max(s.rounds.length,1),4);return t.jsxs("div",{style:{fontFamily:"Arial, Helvetica, sans-serif",color:"#000",backgroundColor:"#fff",height:"190mm",overflow:"hidden",display:"flex",flexDirection:"column",gap:"2mm",boxSizing:"border-box"},children:[t.jsx("div",{style:{flexShrink:0,fontWeight:"bold",fontSize:"13px"},children:e}),t.jsx("div",{style:{flexShrink:0},children:t.jsxs("table",{style:{width:"100%",tableLayout:"fixed",borderCollapse:"collapse"},children:[t.jsx("colgroup",{children:Array.from({length:n.length+1}).map((d,u)=>t.jsx("col",{style:{width:o}},u))}),t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{...te,textAlign:"left",backgroundColor:"#f0f0f0"}}),n.map(d=>t.jsx("th",{style:{...te,fontWeight:"bold",backgroundColor:"#f0f0f0"},children:d.name},d.id))]})}),t.jsx("tbody",{children:n.map(d=>t.jsxs("tr",{children:[t.jsx("th",{style:{...te,textAlign:"left",fontWeight:"bold",backgroundColor:"#f0f0f0"},children:d.name}),n.map(u=>{if(d.id===u.id)return t.jsx("td",{style:{...te,backgroundColor:"#d8d8d8"},children:"×"},u.id);const m=rn(i,d.id,u.id),{text:p,bold:f}=an(d,m,r,a);return t.jsx("td",{style:{...te,fontWeight:f?"bold":"normal"},children:p},u.id)})]},d.id))})]})}),t.jsx("hr",{style:{flexShrink:0,border:"none",borderTop:"1px solid #999",margin:"0"}}),t.jsxs("div",{style:{flex:"1 1 auto",overflow:"hidden"},children:[t.jsx("div",{style:{fontWeight:"bold",fontSize:"10px",marginBottom:"1mm"},children:l("roundRobin.schedule")}),t.jsx("div",{style:{columnCount:c,columnGap:"5mm",fontSize:"9px",lineHeight:"1.5"},children:s.rounds.map(d=>{const u=d.byePlayerId?n.find(p=>p.id===d.byePlayerId):null,m=d.matches.filter(p=>!p.dummy&&p.player1Id!=null&&p.player2Id!=null);return t.jsxs("div",{style:{breakInside:"avoid",marginBottom:"1.5mm"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"0.5mm"},children:[l("roundRobin.round",{n:d.roundNumber}),u!=null&&t.jsxs("span",{style:{fontWeight:"normal"},children:[" ",l("roundRobin.bye",{name:u.name})]})]}),m.map(p=>t.jsx("div",{style:{paddingLeft:"3mm"},children:on(p,n,r,a)},p.id))]},d.roundNumber)})})]})]})},ln=()=>{const{tournament:e,updateTournament:n}=ye(H.ROUND_ROBIN),[s,r]=h.useState("standings"),[a,l]=h.useState(null),[i,o]=h.useState(null),{t:c}=w();h.useEffect(()=>{if(i===null)return;const k=()=>{o(null)};return window.addEventListener("afterprint",k,{once:!0}),window.print(),()=>{window.removeEventListener("afterprint",k)}},[i]);const d=h.useCallback(()=>{e&&o({groupLabel:e.name,players:e.players,schedule:e.schedule,scoringMode:e.scoringMode??R.SETS,maxSets:e.maxSets??J})},[e]);if(!e)return null;const{schedule:u,players:m}=e,p=e.scoringMode??R.SETS,f=e.maxSets??J,x=ke(u,m,{scoringMode:p,maxSets:f}),g=Be(u),b=[{id:"standings",label:c("roundRobin.standings")},{id:"matrix",label:c("roundRobin.matrix")},{id:"schedule",label:c("roundRobin.schedule")},{id:"results",label:c("roundRobin.results")}];function I(k,y,T,A=!1){n(L=>{const P=structuredClone(L.schedule);for(const z of P.rounds){const D=z.matches.find(O=>O.id===k);if(D){D.winnerId=y,D.scores=T,D.walkover=A;break}}const C=Be(P),v=C?ke(P,L.players,{scoringMode:p,maxSets:f}):null;return{...L,schedule:P,winnerId:C?v?.[0]?.playerId??null:null,completedAt:C?new Date().toISOString():null}}),l(null)}return t.jsxs("div",{children:[g&&t.jsx(ie,{label:c("roundRobin.winner",{name:x[0]?.name??""})}),t.jsx(Z,{tabs:b,activeId:s,onChange:r}),s==="schedule"?t.jsx(Me,{schedule:u,players:m,onEditMatch:l,scoringMode:p,maxSets:f}):t.jsxs(t.Fragment,{children:[s==="standings"&&t.jsx(lt,{standings:x,scoringMode:p}),s==="matrix"&&t.jsxs("div",{className:"mt-6",children:[t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx("button",{onClick:d,title:c("roundRobin.print"),className:"p-1 rounded text-[var(--color-muted)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)] transition-colors","aria-label":c("roundRobin.print"),children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[t.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),t.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),t.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]})})}),t.jsx(ct,{schedule:u,players:m,scoringMode:p,maxSets:f})]}),s!=="standings"&&s!=="matrix"&&t.jsx("div",{className:"mt-6",children:t.jsx(ue,{results:$t(u,m,{scoringMode:p})})})]}),a&&t.jsx(oe,{match:a,players:m,scoringMode:p,maxSets:f,onSave:I,onClose:()=>{l(null)}}),(()=>{const k=document.querySelector("#print-root");return i!==null&&k!==null?qe.createPortal(t.jsx(dt,{...i}),k):null})()]})},cn=()=>{const{tournament:e,updateTournament:n}=je(),{t:s}=w(),[r,a]=h.useState(null),[l,i]=h.useState(""),[o,c]=h.useState("");if(!e)return t.jsx("div",{className:"mb-6"});const{players:d}=e;function u(f){a(f.id),i(f.name),c("")}function m(){a(null),i(""),c("")}function p(f){const x=l.trim();if(!x){c(s("tournament.nameEmpty"));return}if(d.some(g=>g.id!==f&&g.name.toLowerCase()===x.toLowerCase())){c(s("tournament.nameDuplicate"));return}n(g=>({...g,players:g.players.map(b=>b.id===f?{...b,name:x}:b)})),a(null),i(""),c("")}return t.jsxs("div",{className:"mb-6",children:[t.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-muted)] mb-2",children:[s("tournament.playersList")," (",d.length,")"]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(f=>t.jsx("div",{children:r===f.id?t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",id:`edit-player-${f.id}`,"aria-label":s("tournament.editName"),value:l,onChange:x=>{i(x.target.value),c("")},onKeyDown:x=>{x.key==="Enter"&&p(f.id),x.key==="Escape"&&m()},className:`border rounded px-2 py-1 text-sm w-32 focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] bg-[var(--color-card)] ${o?"border-[var(--color-accent-border)]":"border-[var(--color-border)]"}`}),t.jsx("button",{onClick:()=>{p(f.id)},className:"text-[var(--color-primary)] hover:text-[var(--color-primary-dark)] text-sm px-1",title:s("tournament.saveName"),children:t.jsx(wt,{className:"h-3.5 w-3.5"})}),t.jsx("button",{onClick:m,className:"text-[var(--color-faint)] hover:text-[var(--color-muted)] text-sm px-1",title:s("tournament.cancelEdit"),children:t.jsx(It,{className:"h-3.5 w-3.5"})})]}):t.jsxs("button",{type:"button",onClick:()=>{u(f)},className:"inline-flex items-center gap-2 bg-[var(--color-soft)] border border-[var(--color-border)] rounded-full px-3 py-1 text-sm text-[var(--color-text)] cursor-pointer hover:bg-[var(--color-soft)] hover:border-[var(--color-primary)] transition-colors",title:s("tournament.editName"),"aria-label":s("tournament.editName"),children:[t.jsx("span",{className:"truncate",children:f.name}),f.elo!=null&&t.jsx("span",{className:"text-xs font-normal text-[var(--color-muted)]",children:s("players.elo",{elo:f.elo})})]})},f.id))}),o&&t.jsx("p",{className:"text-[var(--color-accent)] text-xs mt-1",children:o})]})},ut=({player:e,groupLabel:n,tagType:s})=>{const{t:r}=w(),a={qualifier:"bg-[var(--color-soft)] text-[var(--color-primary-dark)]",lucky:"bg-[var(--color-accent-soft)] text-[var(--color-accent)]"},l={qualifier:r("groupStage.advancerQualifierTag"),lucky:r("groupStage.advancerLuckyTag")};return t.jsxs("li",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-[var(--color-text)]",children:e.name}),t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:r("groupStage.advancerGroupRank",{group:n,rank:e.groupRank})})]}),t.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded-full ${a[s]}`,children:l[s]})]})},dn=({qualifiers:e,groupLabelById:n})=>{const{t:s}=w();return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:s("groupStage.qualifiersTitle")}),t.jsx("ul",{className:"space-y-2",children:e.map(r=>t.jsx(ut,{player:r,groupLabel:n.get(r.groupId)??r.groupId,tagType:"qualifier"},r.id))})]})},un=({luckyLosers:e,hasLucky:n,groupLabelById:s})=>{const{t:r}=w();return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:r("groupStage.luckyLosersTitle")}),n?t.jsx("ul",{className:"space-y-2",children:e.map(a=>t.jsx(ut,{player:a,groupLabel:s.get(a.groupId)??a.groupId,tagType:"lucky"},a.id))}):t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:r("groupStage.luckyLosersNone")})]})};function mn(e){return Number.isFinite(e)?`${(e*100).toFixed(1)}%`:"0%"}function Ee(e){return Number.isFinite(e)?e.toFixed(2):"0.00"}function Oe(e){const n=Ee(e);return e>0?`+${n}`:n}function xn(e,n,s){const r=e.tiebreakDetails,a=Array.isArray(e.tiebreakApplied)?e.tiebreakApplied.filter(o=>o==="setsWonPerMatch"||o==="setDiffPerMatch"||o==="pointsDiffPerMatch"||o==="opponentAvgRank"||o==="relativeRank"||o==="fairPlay"||o==="lottery"):[],l={setsWonPerMatch:n("groupStage.luckyCriteriaSetsWon"),setDiffPerMatch:n("groupStage.luckyCriteriaSetDiff"),pointsDiffPerMatch:n("groupStage.luckyCriteriaPointsDiff"),opponentAvgRank:n("groupStage.luckyCriteriaOpponentRank"),relativeRank:n("groupStage.luckyCriteriaRelativeRank"),fairPlay:n("groupStage.luckyCriteriaFairPlay"),lottery:n("groupStage.luckyCriteriaLottery")},i={setsWonPerMatch:n("groupStage.luckyCriteriaSetsWonHelp"),setDiffPerMatch:n("groupStage.luckyCriteriaSetDiffHelp"),pointsDiffPerMatch:n("groupStage.luckyCriteriaPointsDiffHelp"),opponentAvgRank:n("groupStage.luckyCriteriaOpponentRankHelp"),relativeRank:n("groupStage.luckyCriteriaRelativeRankHelp"),fairPlay:n("groupStage.luckyCriteriaFairPlayHelp"),lottery:n("groupStage.luckyCriteriaLotteryHelp")};return a.filter(o=>s||o!=="pointsDiffPerMatch").map(o=>{let c="-";return o==="setsWonPerMatch"&&(c=Ee(r.setsWonPerMatch)),o==="setDiffPerMatch"&&(c=Oe(r.setDiffPerMatch)),o==="pointsDiffPerMatch"&&(c=Oe(r.pointsDiffPerMatch)),o==="opponentAvgRank"&&(c=Ee(r.opponentAvgRank)),o==="relativeRank"&&(c=mn(r.relativeRank)),o==="fairPlay"&&(c=r.fairPlay?n("groupStage.luckyCriteriaYes"):n("groupStage.luckyCriteriaNo")),o==="lottery"&&(c=n("groupStage.luckyCriteriaApplied")),{key:o,label:l[o],value:c,help:i[o]}})}const pn=({player:e,showBalls:n})=>{const{t:s}=w(),r=xn(e,s,n);return r.length===0?null:t.jsx("table",{className:"w-full text-[0.7rem] text-[var(--color-muted)]",children:t.jsx("tbody",{children:r.map(a=>t.jsxs("tr",{className:"border-t border-[var(--color-border-soft)]",children:[t.jsx("td",{className:"py-1 pr-2 font-medium",children:t.jsx("span",{className:"underline decoration-dotted underline-offset-2 cursor-help",title:a.help,children:a.label})}),t.jsx("td",{className:"py-1 text-right",children:a.value})]},a.key))})})},fn=({player:e,index:n,groupLabel:s,isLucky:r,showBalls:a,isExpanded:l,onToggle:i})=>{const{t:o}=w(),c=e.stats,d=r?"bg-[var(--color-accent-soft)]":"",u=a?9:8;return t.jsxs(h.Fragment,{children:[t.jsxs("tr",{className:`border-b border-[var(--color-border-soft)] ${d} cursor-pointer`,onClick:i,onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i())},role:"button",tabIndex:0,"aria-expanded":l,children:[t.jsxs("td",{className:"py-2 pr-2 text-[var(--color-faint)]",children:[t.jsx("span",{className:"mr-1 inline-flex h-3 w-3 items-center justify-center text-[var(--color-muted)]","aria-hidden":"true",children:t.jsx("svg",{viewBox:"0 0 20 20",className:`h-3 w-3 transition-transform ${l?"rotate-90":"rotate-0"}`,fill:"currentColor",children:t.jsx("path",{d:"M7.5 5.5 12.5 10 7.5 14.5"})})}),n+1]}),t.jsx("td",{className:"py-2 pr-2 font-medium text-[var(--color-text)]",children:e.name}),t.jsx("td",{className:"py-2 pr-2 text-[var(--color-muted)]",children:o("groupStage.advancerGroupRank",{group:s,rank:e.groupRank})}),t.jsx("td",{className:"py-2 pr-2 text-center",children:c.played??0}),t.jsx("td",{className:"py-2 pr-2 text-center",children:c.wins??0}),t.jsx("td",{className:"py-2 pr-2 text-center",children:c.losses??0}),t.jsxs("td",{className:"py-2 pr-2 text-center",children:[c.setsWon??0,"-",c.setsLost??0]}),a&&t.jsxs("td",{className:"py-2 pr-2 text-center",children:[c.pointsWon??0,"-",c.pointsLost??0]}),t.jsx("td",{className:"py-2 text-center font-semibold",children:c.points??0})]}),l&&t.jsx("tr",{className:`border-b border-[var(--color-border-soft)] ${d}`,children:t.jsx("td",{className:"px-2",colSpan:u,children:t.jsx(pn,{player:e,showBalls:a})})})]})},hn=({candidates:e,luckyIdSet:n,groupLabelById:s,showBalls:r,expandedId:a,onToggleExpand:l})=>{const{t:i}=w();return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] uppercase tracking-wide",children:i("groupStage.luckyCandidatesTitle")}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-[var(--color-border-soft)] text-left text-[var(--color-muted)]",children:[t.jsx("th",{className:"py-2 pr-2",children:i("standings.rank")}),t.jsx("th",{className:"py-2 pr-2",children:i("standings.player")}),t.jsx("th",{className:"py-2 pr-2",children:i("standings.group")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.played")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.wins")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.losses")}),t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.sets")}),r&&t.jsx("th",{className:"py-2 pr-2 text-center",children:i("standings.balls")}),t.jsx("th",{className:"py-2 text-center",children:i("standings.points")})]})}),t.jsx("tbody",{children:e.map((o,c)=>t.jsx(fn,{player:o,index:c,groupLabel:s.get(o.groupId)??o.groupId,isLucky:n.has(o.id),showBalls:r,isExpanded:a===o.id,onToggle:()=>{l(o.id)}},o.id))})]})})]})},bn=({qualifiers:e,luckyLosers:n,luckyCandidates:s=[],groups:r,bracketTargetSize:a,scoringMode:l=R.SETS})=>{const{t:i}=w(),[o,c]=h.useState(null),d=h.useMemo(()=>{const g=new Map;for(const[b,I]of r.entries())g.set(I.id,i("groupStage.groupTitle",{label:ge(b)}));return g},[r,i]),u=h.useMemo(()=>new Set(n.map(g=>g.id)),[n]),m=l===R.POINTS,p=n.length>0,f=s.length>0;if(e.length===0&&!p)return null;const x=g=>{c(b=>b===g?null:g)};return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4 bg-[var(--color-card)]",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:i("groupStage.advancersTitle")}),p&&t.jsx("div",{className:"text-xs text-[var(--color-muted)]",children:i("groupStage.luckyLoserNote",{target:a})}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsx(dn,{qualifiers:e,groupLabelById:d}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(un,{luckyLosers:n,hasLucky:p,groupLabelById:d}),p&&f&&t.jsx(hn,{candidates:s,luckyIdSet:u,groupLabelById:d,showBalls:m,expandedId:o,onToggleExpand:x})]})]})]})},gn=({group:e,groupIndex:n,groupPlayers:s,standings:r,qualifierCount:a,wildCardIds:l,activeTab:i,onTabChange:o,onEditMatch:c,onPrint:d,scoringMode:u,maxSets:m})=>{const{t:p}=w(),f=[{id:"standings",label:p("roundRobin.standings")},{id:"results",label:p("roundRobin.matrix")},{id:"schedule",label:p("roundRobin.schedule")}];return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 bg-[var(--color-card)]",children:[t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:p("groupStage.groupTitle",{label:ge(n)})})}),t.jsx(Z,{tabs:f,activeId:i,onChange:o}),i==="schedule"&&t.jsx(Me,{schedule:e.schedule,players:s,onEditMatch:c,scoringMode:u,maxSets:m}),i==="standings"&&t.jsx(lt,{standings:r,highlightCount:a,wildCardIds:l,scoringMode:u}),i==="results"&&t.jsxs("div",{className:"mt-6",children:[t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx("button",{onClick:d,title:p("groupStage.printGroup"),className:"p-1 rounded text-[var(--color-muted)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)] transition-colors","aria-label":p("groupStage.printGroup"),children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[t.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),t.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),t.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]})})}),t.jsx(ct,{schedule:e.schedule,players:s,scoringMode:u,maxSets:m})]})]})},jn=({groupStage:e,players:n,standingsByGroup:s,wildCardIds:r,groupTabs:a,onGroupTabChange:l,onEditMatch:i,scoringMode:o,maxSets:c})=>{const{t:d}=w(),[u,m]=h.useState(null);h.useEffect(()=>{if(u===null)return;const x=()=>{m(null)};return window.addEventListener("afterprint",x,{once:!0}),window.print(),()=>{window.removeEventListener("afterprint",x)}},[u]);const p=h.useCallback((x,g)=>{const b=e.groups.find(y=>y.id===x);if(!b)return;const I=we(b,n),k=d("groupStage.groupTitle",{label:ge(g)});m({groupLabel:k,players:I,schedule:b.schedule,scoringMode:o,maxSets:c})},[e.groups,n,o,c,d]),f=document.querySelector("#print-root");return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-6",children:e.groups.map((x,g)=>{const b=we(x,n),I=s.find(T=>T.groupId===x.id)?.standings,k=e.settings.qualifiers[g]??0,y=a[x.id]??"standings";return t.jsx(gn,{group:x,groupIndex:g,groupPlayers:b,standings:I??[],qualifierCount:k,wildCardIds:r,activeTab:y,onTabChange:T=>{l(x.id,T)},onEditMatch:T=>{i(x.id,T.id)},onPrint:()=>{p(x.id,g)},scoringMode:o,maxSets:c},x.id)})}),u!==null&&f!==null?qe.createPortal(t.jsx(dt,{...u}),f):null]})},Ge=({title:e,bracket:n,players:s,onEditMatch:r,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o})=>{const{t:c}=w();if(!n)return null;const d=n.thirdPlaceMatch??null,u=n.rounds.length;return t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:e}),t.jsx(Q,{bracket:n,players:s,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:r}),d&&(d.player1Id??d.player2Id)&&t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)] mb-2",children:c("bracket.thirdPlace")}),t.jsx(X,{match:d,players:s,wildCardIds:a,canEdit:Ue(n,d.id),onClick:()=>{r(d)},scoringMode:l,maxSets:i,roundIndex:u})]})]})},_e=({title:e,doubleElim:n,players:s,onEditMatch:r,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o})=>{const{t:c}=w();return n?t.jsxs("div",{className:"border border-[var(--color-border)] rounded-xl p-4 space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:e}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:c("doubleElim.winnersBracket")}),t.jsx(Q,{bracket:n.winners,players:s,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:d=>{r(d.id)}})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:c("doubleElim.losersBracket")}),t.jsx(Q,{bracket:n.losers,players:s,wildCardIds:a,scoringMode:l,maxSets:i,groupPlacementByPlayerId:o,onEditMatch:d=>{r(d.id)}})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs font-semibold text-[var(--color-muted)]",children:c("doubleElim.finals")}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[t.jsx(X,{match:n.finals.grandFinal,players:s,wildCardIds:a,canEdit:Y(n,n.finals.grandFinal.id),onClick:()=>{r(n.finals.grandFinal.id)},scoringMode:l,maxSets:i,roundIndex:n.winners.rounds.length}),n.finals.resetFinal.player1Id&&n.finals.resetFinal.player2Id&&t.jsx(X,{match:n.finals.resetFinal,players:s,wildCardIds:a,canEdit:Y(n,n.finals.resetFinal.id),onClick:()=>{r(n.finals.resetFinal.id)},scoringMode:l,maxSets:i,roundIndex:n.winners.rounds.length+1})]})]})]}):null},yn=({playoffs:e,isDoubleElim:n,players:s,wildCardIds:r,groupPlacementByPlayerId:a,scoringMode:l,maxSets:i,onEditMainBracketMatch:o,onEditConsolationBracketMatch:c,onEditMainDoubleElimMatch:d,onEditConsolationDoubleElimMatch:u})=>{const{t:m}=w();if(!e)return null;const p=!n&&e.mainBracket,f=n&&e.mainDoubleElim,x=!n&&e.consolationBracket,g=n&&e.consolationDoubleElim;return!p&&!f?null:t.jsxs(t.Fragment,{children:[p&&t.jsx(Ge,{title:m("groupStage.mainBracket"),bracket:e.mainBracket,players:s,wildCardIds:r,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:o}),f&&t.jsx(_e,{title:m("groupStage.mainBracket"),doubleElim:e.mainDoubleElim,players:s,wildCardIds:r,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:d}),x&&t.jsx(Ge,{title:m("groupStage.consolationBracket"),bracket:e.consolationBracket,players:s,wildCardIds:r,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:c}),g&&t.jsx(_e,{title:m("groupStage.consolationBracket"),doubleElim:e.consolationDoubleElim,players:s,wildCardIds:r,scoringMode:l,maxSets:i,groupPlacementByPlayerId:a,onEditMatch:u})]})},vn=({editing:e,activeMatch:n,activePlayers:s,scoringMode:r,groupStageMaxSets:a,bracketMaxSets:l,onSave:i,onClose:o})=>{if(!n||!e)return null;const c=e.type==="group"?a:l;return t.jsx(oe,{match:n,players:s,scoringMode:r,maxSets:c,onSave:i,onClose:o})};function Nn(e,n,s){const r=e.groups.find(a=>a.id===n);if(!r)return null;for(const a of r.schedule.rounds){const l=a.matches.find(i=>i.id===s);if(l)return l}return null}function Sn(e,n){if(!e)return null;if(e.thirdPlaceMatch?.id===n)return e.thirdPlaceMatch;for(const s of e.rounds){const r=s.find(a=>a.id===n);if(r)return r}return null}function kn(e,n){if(!e)return null;for(const s of e.winners.rounds){const r=s.find(a=>a.id===n);if(r)return r}for(const s of e.losers.rounds){const r=s.find(a=>a.id===n);if(r)return r}return e.finals.grandFinal.id===n?e.finals.grandFinal:e.finals.resetFinal.id===n?e.finals.resetFinal:null}function wn(e,n,s,r){return h.useMemo(()=>e?yt(e,n,{scoringMode:s,maxSets:r}):[],[e,n,s,r])}function In(e){return h.useMemo(()=>e?Ze(e):!1,[e])}function Tn(e,n,s,r,a){return h.useMemo(()=>!e||!n?null:vt(n,s,{scoringMode:r,maxSets:a}),[e,n,s,r,a])}function En(e){return h.useMemo(()=>e?new Set(e.luckyLosers.map(n=>n.id)):null,[e])}function Rn(e,n){return h.useMemo(()=>{if(!e||!n)return null;const s=new Map(n.groups.map((l,i)=>[l.id,ge(i)])),r=new Map,a=l=>{const i=s.get(l.groupId);!i||!l.groupRank||r.set(l.id,`${i}${l.groupRank}`)};for(const l of e.main)a(l);for(const l of e.luckyLosers)a(l);for(const l of e.consolation)a(l);return r},[e,n])}function Re(e){return e?e.rounds.some(n=>n.some(s=>s.scores.length>0||s.winnerId)):!1}function ze(e){return e?!!(Re(e.winners)||e.losers.rounds.some(n=>n.some(s=>s.scores.length>0||s.winnerId))||e.finals.grandFinal.winnerId||e.finals.resetFinal.winnerId):!1}function Cn(e,n){return e===n?!0:!e||!n?!1:e.bracketType===n.bracketType&&JSON.stringify(e.mainBracket)===JSON.stringify(n.mainBracket)&&JSON.stringify(e.mainDoubleElim)===JSON.stringify(n.mainDoubleElim)&&JSON.stringify(e.consolationBracket)===JSON.stringify(n.consolationBracket)&&JSON.stringify(e.consolationDoubleElim)===JSON.stringify(n.consolationDoubleElim)}function Mn(e){const n=e.groupStagePlayoffs??e.groupStageBrackets;return n||null}function ne(e,n){return e?n&&e.mainDoubleElim?fe(e.mainDoubleElim):e.mainBracket?pe(e.mainBracket):null:null}function Ke(e,n){return e?n?!!e.mainDoubleElim||!!e.consolationDoubleElim:!!e.mainBracket||!!e.consolationBracket:!1}function Dn(e,n){return e?n?ze(e.mainDoubleElim)||ze(e.consolationDoubleElim):Re(e.mainBracket)||Re(e.consolationBracket):!1}const Bn=()=>{const{tournament:e,updateTournament:n}=Ct(),{t:s}=w(),[r,a]=h.useState(null),[l,i]=h.useState({}),[o,c]=h.useState("tournament"),d=e?.groupStage,u=h.useMemo(()=>e?.players??[],[e?.players]),m=e?Mn(e):null,p=e?.scoringMode??R.SETS,f=e?.groupStageMaxSets??e?.maxSets??J,x=e?.bracketMaxSets??e?.maxSets??J,b=(m?.bracketType??d?.settings.bracketType??De.SINGLE_ELIM)===De.DOUBLE_ELIM,I=wn(d,u,p,f),k=In(d),y=Tn(k,d,u,p,f),T=En(y),A=Rn(y,d),L=h.useMemo(()=>e?e.winnerId?e.winnerId:ne(m,b):null,[m,e,b]),P=h.useMemo(()=>L?u.find(j=>j.id===L):null,[u,L]);h.useEffect(()=>{if(!k||!y||!d||Ke(m,b)&&Dn(m,b))return;const M=Pe(d,u,{scoringMode:p,maxSets:f});if(Cn(m,M))return;const B=ne(M,b);n(_=>({..._,groupStagePlayoffs:M,winnerId:B??null,completedAt:B?new Date().toISOString():null}))},[y,k,d,m,u,p,f,n,b,e]);const C=h.useMemo(()=>{if(!r||!d)return null;if(r.type==="group"&&r.groupId)return Nn(d,r.groupId,r.matchId);if(r.type==="mainBracket"||r.type==="consolationBracket"){const j=m?.[r.type];return Sn(j,r.matchId)}if(r.type==="mainDoubleElim"||r.type==="consolationDoubleElim"){const j=m?.[r.type];return kn(j,r.matchId)}return null},[r,d,m]),v=h.useMemo(()=>{if(!r||!d)return u;if(r.type==="group"){const j=d.groups.find(S=>S.id===r.groupId);return j?we(j,u):u}return u},[r,d,u]),z=h.useMemo(()=>{if(o!=="results")return[];let j=[],S=[];return m&&(b&&m.mainDoubleElim?j=Te(m.mainDoubleElim,u):m.mainBracket&&(j=Ie(m.mainBracket,u)),b&&m.consolationDoubleElim?S=$e(Te(m.consolationDoubleElim,u),j.length):m.consolationBracket&&(S=$e(Ie(m.consolationBracket,u),j.length))),Ce([...j,...S])},[o,m,u,b]);function D(j,S,M,B=!1){if(!d)return;const _=structuredClone(d);for(const V of _.groups)for(const mt of V.schedule.rounds){const me=mt.matches.find(xt=>xt.id===j);if(me){me.winnerId=S,me.scores=M,me.walkover=B;break}}let F=m;const q=m&&Ke(m,b);Ze(_)&&!q&&(F=Pe(_,u,{scoringMode:p,maxSets:f}));const U=ne(F,b);n(V=>({...V,groupStage:_,groupStagePlayoffs:F,winnerId:U??null,completedAt:U?new Date().toISOString():null})),a(null)}function O(j,S,M,B,_=!1){if(!m||!d)return;const F=structuredClone(m),q=F[B];if(!q)return;F[B]=S?Ve(q,j,S,M,_):Je(q,j);const U=ne(F,b);n(V=>({...V,groupStage:d,groupStagePlayoffs:F,winnerId:U??null,completedAt:U?new Date().toISOString():null})),a(null)}function K(j,S,M,B,_=!1){if(!m||!d)return;const F=structuredClone(m),q=F[B];if(!q)return;F[B]=S?Ye(q,j,S,M,_):Qe(q,j);const U=ne(F,b);n(V=>({...V,groupStage:d,groupStagePlayoffs:F,winnerId:U??null,completedAt:U?new Date().toISOString():null})),a(null)}function G(j,S,M,B){if(r)switch(r.type){case"group":{D(j,S,M,B);break}case"mainBracket":{O(j,S,M,"mainBracket",B);break}case"consolationBracket":{O(j,S,M,"consolationBracket",B);break}case"mainDoubleElim":{K(j,S,M,"mainDoubleElim",B);break}case"consolationDoubleElim":{K(j,S,M,"consolationDoubleElim",B);break}}}function ee(j,S){i(M=>({...M,[j]:S}))}function ve(j,S){a({type:"group",groupId:j,matchId:S})}const Ne=[{id:"tournament",label:s("tabs.tournament")},{id:"results",label:s("tabs.results")}];return!e||!d?null:t.jsxs("div",{className:"space-y-8",children:[P&&t.jsx(ie,{label:s("bracket.winner",{name:P.name})}),t.jsx(Z,{tabs:Ne,activeId:o,onChange:c}),o==="results"?t.jsx(ue,{results:z}):t.jsxs(t.Fragment,{children:[t.jsx(jn,{groupStage:d,players:u,standingsByGroup:I,wildCardIds:T,groupTabs:l,onGroupTabChange:ee,onEditMatch:ve,scoringMode:p,maxSets:f}),y&&t.jsx(bn,{qualifiers:y.main,luckyLosers:y.luckyLosers,luckyCandidates:y.luckyCandidates,groups:d.groups,bracketTargetSize:y.bracketTargetSize,scoringMode:p}),t.jsx(yn,{playoffs:m,isDoubleElim:b,players:u,wildCardIds:T,groupPlacementByPlayerId:A,scoringMode:p,maxSets:x,onEditMainBracketMatch:j=>{a({type:"mainBracket",matchId:j.id})},onEditConsolationBracketMatch:j=>{a({type:"consolationBracket",matchId:j.id})},onEditMainDoubleElimMatch:j=>{a({type:"mainDoubleElim",matchId:j})},onEditConsolationDoubleElimMatch:j=>{a({type:"consolationDoubleElim",matchId:j})}}),t.jsx(vn,{editing:r,activeMatch:C,activePlayers:v,scoringMode:p,groupStageMaxSets:f,bracketMaxSets:x,onSave:G,onClose:()=>{a(null)}})]})]})},Pn=({isExpanded:e})=>t.jsx("span",{className:"mr-1 inline-flex h-3 w-3 items-center justify-center text-[var(--color-muted)]","aria-hidden":"true",children:t.jsx("svg",{viewBox:"0 0 20 20",className:`h-3 w-3 transition-transform ${e?"rotate-90":"rotate-0"}`,fill:"currentColor",children:t.jsx("path",{d:"M7.5 5.5 12.5 10 7.5 14.5"})})}),Fn=["buchholz","sonnebornBerger","headToHead","setRatio","ballRatio"],Wn=({details:e,t:n,showPoints:s})=>{if(e.tiebreakApplied.length===0)return null;const r={buchholz:n("swiss.tiebreakBuchholz"),sonnebornBerger:n("swiss.tiebreakSonnebornBerger"),headToHead:n("swiss.tiebreakHeadToHead"),setRatio:n("swiss.tiebreakSetRatio"),ballRatio:n("swiss.tiebreakBallRatio")},a={buchholz:n("swiss.tiebreakBuchholzHelp"),sonnebornBerger:n("swiss.tiebreakSonnebornBergerHelp"),headToHead:n("swiss.tiebreakHeadToHeadHelp"),setRatio:n("swiss.tiebreakSetRatioHelp"),ballRatio:n("swiss.tiebreakBallRatioHelp")};function l(c){switch(c){case"buchholz":return String(e.buchholz);case"sonnebornBerger":return String(e.sonnebornBerger);case"headToHead":return String(e.headToHead);case"setRatio":return e.setRatio.toFixed(3);case"ballRatio":return e.ballRatio.toFixed(3)}}const i=new Set(e.tiebreakApplied),o=Fn.filter(c=>i.has(c)&&(s||c!=="ballRatio"));return o.length===0?null:t.jsx("table",{className:"w-full text-[0.7rem] text-[var(--color-muted)]",children:t.jsx("tbody",{children:o.map(c=>t.jsxs(W,{className:"border-t border-[var(--color-border-soft)]",children:[t.jsx(N,{className:"py-1 pr-2 font-medium p-0",children:t.jsx("span",{className:"underline decoration-dotted underline-offset-2 cursor-help",title:a[c],children:r[c]})}),t.jsx(N,{className:"py-1 text-right p-0",children:l(c)})]},c))})})},Ln=()=>{const{tournament:e,updateTournament:n}=ye(H.SWISS),[s,r]=h.useState("standings"),[a,l]=h.useState(null),[i,o]=h.useState(null),{t:c}=w();if(!e)return null;const{schedule:d,players:u}=e,m=e.scoringMode??R.SETS,p=e.maxSets??J,f=m===R.POINTS,x=Fe(d,u,{scoringMode:m,maxSets:p}),g=Nt(d),b=We(e),I=d.rounds.length,k=e.totalRounds,y=f?8:7,T=[{id:"standings",label:c("swiss.standings")},{id:"schedule",label:c("swiss.schedule")},...b?[{id:"results",label:c("swiss.results")}]:[]];function A(v,z,D,O=!1){n(K=>{const G=structuredClone(K.schedule);for(const Ne of G.rounds){const j=Ne.matches.find(S=>S.id===v);if(j){j.winnerId=z,j.scores=D,j.walkover=O;break}}const ee=We({...K,schedule:G}),ve=ee?Fe(G,K.players,{scoringMode:m,maxSets:p}):null;return{...K,schedule:G,winnerId:ee?ve?.[0]?.playerId??null:null,completedAt:ee?new Date().toISOString():null}}),l(null)}function L(){n(v=>({...v,schedule:{rounds:[...v.schedule.rounds,kt(v)]}}))}function P(v){o(z=>z===v?null:v)}const C="py-2.5 pr-3 text-xs uppercase tracking-wider font-semibold text-[var(--color-muted)]";return t.jsxs("div",{children:[b&&t.jsx(ie,{label:c("swiss.winner",{name:x[0]?.name??""})}),t.jsx(Z,{tabs:T,activeId:s,onChange:r}),s==="standings"&&t.jsxs(le,{children:[t.jsx(ce,{children:t.jsxs(W,{className:"border-b-2 border-[var(--color-border)]",children:[t.jsx(E,{className:C,children:c("standings.rank")}),t.jsx(E,{className:C,children:c("standings.player")}),t.jsx(E,{className:C,children:c("standings.wins")}),t.jsx(E,{className:C,children:c("standings.losses")}),t.jsx(E,{className:C,children:c("standings.sets")}),f&&t.jsx(E,{className:C,children:c("standings.balls")}),t.jsx(E,{className:`${C} cursor-help`,title:c("swiss.standingsBuchholzHelp"),children:c("swiss.standingsBuchholz")}),t.jsx(E,{className:C,children:"ELO"})]})}),t.jsx(de,{children:x.map((v,z)=>{const D=(v.tiebreakDetails?.tiebreakApplied.length??0)>0,O=i===v.playerId,K=G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),P(v.playerId))};return t.jsxs(h.Fragment,{children:[t.jsxs(W,{className:`transition-colors ${D?"cursor-pointer":""}`,onClick:D?()=>{P(v.playerId)}:void 0,onKeyDown:D?K:void 0,role:D?"button":void 0,tabIndex:D?0:void 0,"aria-expanded":D?O:void 0,children:[t.jsxs(N,{className:"py-2.5 pr-3 text-[var(--color-faint)] tabular-nums",children:[D&&t.jsx(Pn,{isExpanded:O}),z+1,"."]}),t.jsx(N,{className:"py-2.5 pr-3 font-medium",children:v.name}),t.jsx(N,{className:"py-2.5 pr-3 tabular-nums",children:v.wins}),t.jsx(N,{className:"py-2.5 pr-3 tabular-nums",children:v.losses}),t.jsxs(N,{className:"py-2.5 pr-3 tabular-nums",children:[v.setsWon,"-",v.setsLost]}),f&&t.jsxs(N,{className:"py-2.5 pr-3 tabular-nums",children:[v.pointsWon,"-",v.pointsLost]}),t.jsx(N,{className:"py-2.5 pr-3 tabular-nums",children:v.buchholz}),t.jsx(N,{className:"py-2.5 pr-3 tabular-nums text-[var(--color-faint)]",children:v.elo??"—"})]}),O&&v.tiebreakDetails&&t.jsx(W,{children:t.jsx(N,{className:"px-2",colSpan:y,children:t.jsx(Wn,{details:v.tiebreakDetails,t:c,showPoints:f})})})]},v.playerId)})})]}),s==="schedule"&&t.jsxs("div",{children:[t.jsx(Me,{schedule:d,players:u,onEditMatch:l,scoringMode:m,maxSets:p,roundLabelKey:"swiss.round",byeLabelKey:"swiss.bye"}),t.jsx("div",{className:"mt-4 text-sm text-[var(--color-muted)]",children:c("swiss.roundProgress",{current:I,total:k})}),g&&!b&&t.jsx("div",{className:"mt-4",children:t.jsx(re,{onClick:L,children:c("swiss.generateNextRound",{n:I+1})})})]}),s==="results"&&b&&t.jsx("div",{className:"mt-6",children:t.jsx(ue,{results:St(x)})}),a&&t.jsx(oe,{match:a,players:u,scoringMode:m,maxSets:p,onSave:A,onClose:()=>{l(null)}})]})},Hn=()=>{const{tournament:e,isLoading:n}=je(),{t:s}=w(),r=ft(),{tracker:a}=bt();return h.useEffect(()=>{a.trackPageView({})},[r,a]),gt(e?e.name:s("tournament.notFoundTitle")),n?t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-[var(--color-muted)]",children:s("tournament.loading")})}):e?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx(se,{to:"/",className:"text-sm text-[var(--color-primary)] hover:text-[var(--color-primary-dark)]",children:s("tournament.back")}),t.jsx("h1",{className:"text-2xl font-bold text-[var(--color-text)] mt-2",children:e.name}),t.jsxs("p",{className:"text-sm text-[var(--color-muted)]",children:[s(`format.${e.format}`)," ·"," ",s("tournament.players",{count:e.players.length})]})]}),t.jsx(cn,{}),e.format===H.SINGLE_ELIM&&t.jsx(Gt,{}),e.format===H.ROUND_ROBIN&&t.jsx(ln,{}),e.format===H.DOUBLE_ELIM&&t.jsx(_t,{}),e.format===H.GROUPS_TO_BRACKET&&t.jsx(Bn,{}),e.format===H.SWISS&&t.jsx(Ln,{})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center px-4",children:[t.jsx(Et,{className:"h-12 w-12 text-[var(--color-muted)] mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text)] mb-2",children:s("tournament.notFoundTitle")}),t.jsx("p",{className:"text-[var(--color-muted)] mb-6 max-w-md",children:s("tournament.notFoundDesc")}),t.jsxs("div",{className:"flex gap-3 flex-wrap justify-center",children:[t.jsx(re,{asChild:!0,children:t.jsx(se,{to:"/create",children:s("home.newTournament")})}),t.jsx(re,{variant:"primary-outlined",asChild:!0,children:t.jsx(se,{to:"/",children:s("tournament.backHome")})})]})]})},Un=()=>{const{id:e}=pt(),{t:n}=w();return e?t.jsx(Mt,{tournamentId:e,children:t.jsx(Hn,{})}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center px-4",children:[t.jsx(Tt,{className:"h-12 w-12 text-[var(--color-muted)] mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-[var(--color-text)] mb-2",children:n("tournament.notFoundTitle")}),t.jsx("p",{className:"text-[var(--color-muted)] mb-6 max-w-md",children:n("tournament.noIdDesc")}),t.jsxs("div",{className:"flex gap-3 flex-wrap justify-center",children:[t.jsx(re,{asChild:!0,children:t.jsx(se,{to:"/create",children:n("home.newTournament")})}),t.jsx(re,{variant:"primary-outlined",asChild:!0,children:t.jsx(se,{to:"/",children:n("tournament.backHome")})})]})]})};export{Un as TournamentPage};
