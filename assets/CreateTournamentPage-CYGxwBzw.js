import{j as e,u as q,h as K,r as $,i as V,k as w}from"./react-vendor-Bgs-6sV-.js";import{c as z,u as D,B as j,M as R,t as Q,D as I}from"./index-BO8dSEhX.js";import{u as X}from"./usePageTitle-TfERQYx0.js";import{B as L,S as A,F as n,p as W}from"./ConfirmModal-SLZE9rvl.js";import{I as y,C as Y,L as f,c as H,g as J,a as Z,b as ee,i as re}from"./groupStageUtils-BdiRr7gS.js";import{a as te,C as ae,X as se}from"./icons-DzhwDsxK.js";import"./notifications-t4x-TPvG.js";import"./radix-ui-CVrMEJrw.js";const M=({children:i,className:s})=>e.jsx("p",{className:z("text-sm font-medium text-[var(--color-text)] mb-1",s),children:i}),oe=({players:i,setPlayers:s,register:m,errors:b,setValue:O,useElo:v,onAddPlayer:S})=>{const{t:u}=D();function E(t){const a=i.filter(o=>o.id!==t).map((o,l)=>({...o,seed:l+1}));s(a)}function C(t){if(t===0)return;const a=[...i],o=a[t-1],l=a[t];!o||!l||(a[t-1]=l,a[t]=o,s(a.map((p,g)=>({...p,seed:g+1}))))}function N(t){if(t===i.length-1)return;const a=[...i],o=a[t],l=a[t+1];!o||!l||(a[t]=l,a[t+1]=o,s(a.map((p,g)=>({...p,seed:g+1}))))}function d(){const t=[...i];for(let a=t.length-1;a>0;a--){const o=Math.floor(Math.random()*(a+1)),l=t[a],p=t[o];!l||!p||(t[a]=p,t[o]=l)}s(t.map((a,o)=>({...a,seed:o+1})))}function T(){const t=[...i].toSorted((a,o)=>{const l=Number(a.elo),p=Number(o.elo),g=Number.isFinite(l)?l:0,_=Number.isFinite(p)?p:0;return _!==g?_-g:(a.seed??0)-(o.seed??0)});s(t.map((a,o)=>({...a,seed:o+1})))}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(M,{children:u("players.title",{count:i.length})}),i.length>1&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{type:"button",variant:"link",onClick:T,disabled:!v,className:"text-sm px-0 h-auto",children:u("players.sortByElo")}),e.jsx(j,{type:"button",variant:"link",onClick:d,className:"text-sm px-0 h-auto",children:u("players.shuffle")})]})]}),e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 sm:flex sm:gap-2",children:[e.jsx(y,{id:"player-name",type:"text","aria-label":u("players.placeholder"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),S())},placeholder:u("players.placeholder"),className:"min-w-0 sm:flex-1",...m("playerName",{validate:t=>{const a=t.trim();return a?!i.some(o=>o.name.toLowerCase()===a.toLowerCase())||u("players.errorUnique"):!0}})}),e.jsx(j,{type:"button",onClick:()=>{S()},children:u("players.add")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{id:"use-elo",checked:v,onCheckedChange:t=>{O("useElo",t===!0)}}),e.jsx(f,{htmlFor:"use-elo",className:"text-sm text-[var(--color-text)]",children:u("players.useElo")}),e.jsx(y,{id:"elo-rating",type:"number",min:"0","aria-label":u("players.eloPlaceholder"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),S())},placeholder:u("players.eloPlaceholder"),disabled:!v,className:"w-24",...m("playerElo",{valueAsNumber:!0})})]})]}),b.playerName&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm mb-2",children:b.playerName.message}),e.jsx("ul",{className:"space-y-1",children:i.map((t,a)=>e.jsxs("li",{className:"flex items-center gap-2 border border-[var(--color-border)] rounded-lg px-3 py-2 hover:border-[var(--color-border-strong)] hover:bg-[var(--color-soft)] transition-colors",children:[e.jsxs("span",{className:"text-[var(--color-faint)] text-sm w-6 text-right",children:["#",t.seed]}),e.jsx("span",{className:"flex-1 text-sm",children:t.name}),t.elo!=null&&e.jsx("span",{className:"text-xs text-[var(--color-faint)]",children:u("players.elo",{elo:t.elo})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{C(a)},disabled:a===0,className:"h-auto px-1.5 py-0.5 text-[var(--color-faint)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)]",children:e.jsx(te,{className:"h-3.5 w-3.5"})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{N(a)},disabled:a===i.length-1,className:"h-auto px-1.5 py-0.5 text-[var(--color-faint)] hover:text-[var(--color-text)] hover:bg-[var(--color-soft)]",children:e.jsx(ae,{className:"h-3.5 w-3.5"})}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{E(t.id)},className:"h-auto px-1.5 py-0.5 text-[var(--color-accent)] hover:text-[var(--color-primary-dark)] hover:bg-[var(--color-accent-soft)]",children:e.jsx(se,{className:"h-3.5 w-3.5"})})]},t.id))})]})},pe=()=>{const i=q(),{t:s}=D();X(s("create.title"));const{register:m,control:b,handleSubmit:O,setValue:v,setError:S,trigger:u,getValues:E,resetField:C,formState:{errors:N}}=K({defaultValues:{name:"",format:n.SINGLE_ELIM,scoringMode:A.SETS,maxSets:I,groupStageMaxSets:I,bracketMaxSets:I,groupCount:2,consolation:!1,bracketType:L.SINGLE_ELIM,qualifiers:[{value:2},{value:2}],playerName:"",playerElo:1e3,useElo:!1}}),[d,T]=$.useState([]),{fields:t,append:a,remove:o}=V({control:b,name:"qualifiers"}),l=w({control:b,name:"format"}),p=w({control:b,name:"scoringMode"}),g=w({control:b,name:"bracketType"}),_=w({control:b,name:"useElo"});async function G(){if(!await u("playerName"))return;const c=E("playerName").trim();if(!c)return;const h=E("playerElo"),x=E("useElo");T([...d,{id:crypto.randomUUID(),name:c,seed:d.length+1,elo:x&&Number.isFinite(h)?h:void 0}]),C("playerName"),C("playerElo")}function B(r){const c=Number.parseInt(r,10);return Number.isFinite(c)?Math.max(1,c):I}function P(r){const c=Math.max(1,Number.parseInt(r,10)||1);if(v("groupCount",c),c>t.length){const h=c-t.length;for(let x=0;x<h;x++)a({value:2})}else if(c<t.length){const h=Array.from({length:t.length-c},(x,U)=>c+U);o(h)}}const F=O(r=>{if(d.length<R){S("root",{message:s("create.errorPlayers",{minPlayers:R})});return}if(r.format===n.GROUPS_TO_BRACKET&&r.groupCount>d.length){S("root",{message:s("create.errorGroupsTooMany")});return}const c=r.qualifiers.map(k=>k.value),h={id:crypto.randomUUID(),name:r.name.trim(),scoringMode:r.scoringMode,maxSets:r.maxSets,groupStageMaxSets:r.groupStageMaxSets,bracketMaxSets:r.bracketMaxSets,players:d.map(k=>({...k})),createdAt:new Date().toISOString(),completedAt:null,winnerId:null};let x;switch(r.format){case n.SINGLE_ELIM:{x={...h,format:n.SINGLE_ELIM,bracket:ee(d)};break}case n.ROUND_ROBIN:{x={...h,format:n.ROUND_ROBIN,schedule:Z(d)};break}case n.DOUBLE_ELIM:{x={...h,format:n.DOUBLE_ELIM,doubleElim:J(d)};break}case n.GROUPS_TO_BRACKET:{const k=H(d,{groupCount:r.groupCount,qualifiers:c,consolation:r.consolation,bracketType:r.bracketType});x={...h,format:n.GROUPS_TO_BRACKET,groupStage:k,groupStagePlayoffs:null};break}default:throw new Error(`Unsupported format: ${String(r.format)}`)}const U={[n.SINGLE_ELIM]:L.SINGLE_ELIM,[n.DOUBLE_ELIM]:L.DOUBLE_ELIM,[n.GROUPS_TO_BRACKET]:r.bracketType,[n.ROUND_ROBIN]:"none"};Q({tournament_type:r.format,scoring_mode:r.scoringMode,player_count:d.length,playoff_type:U[r.format]??"none"}),W.save(x),i(`/tournament/${x.id}`)});return e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--color-text)] mb-8",children:s("create.title")}),e.jsxs("form",{onSubmit:r=>{F(r)},className:"space-y-7",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"tournament-name",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.nameLabel")}),e.jsx(y,{id:"tournament-name",type:"text",placeholder:s("create.namePlaceholder"),...m("name",{required:s("create.errorName")})}),N.name&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm mt-1",children:N.name.message})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.formatLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(n).map(r=>e.jsxs("label",{className:`flex items-center justify-center flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${l===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("format")}),s(`format.${r}`)]},r))})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.scoringLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(A).map(r=>e.jsxs("label",{className:`flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${p===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("scoringMode")}),s(r===A.SETS?"create.scoringSets":"create.scoringPoints")]},r))})]}),l!==n.GROUPS_TO_BRACKET&&e.jsxs("div",{children:[e.jsx(f,{htmlFor:"max-sets",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.maxSetsLabel")}),e.jsx(y,{id:"max-sets",type:"number",min:"1",className:"w-24",...m("maxSets",{valueAsNumber:!0,onChange:r=>{v("maxSets",B(r.target.value))}})})]}),l===n.GROUPS_TO_BRACKET&&e.jsxs("div",{className:"space-y-4 border border-[var(--color-border)] rounded-xl p-5 bg-[var(--color-soft)]",children:[e.jsx("div",{className:"text-sm font-semibold text-[var(--color-muted)]",children:s("create.groupStageTitle")}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(f,{className:"text-xs text-[var(--color-muted)]",children:[s("create.maxSetsGroupLabel"),e.jsx(y,{id:"group-stage-max-sets",type:"number",min:"1",className:"mt-1 w-24 h-8 px-2 py-1",...m("groupStageMaxSets",{valueAsNumber:!0,onChange:r=>{v("groupStageMaxSets",B(r.target.value))}})})]}),e.jsxs(f,{className:"text-xs text-[var(--color-muted)]",children:[s("create.maxSetsBracketLabel"),e.jsx(y,{id:"bracket-max-sets",type:"number",min:"1",className:"mt-1 w-24 h-8 px-2 py-1",...m("bracketMaxSets",{valueAsNumber:!0,onChange:r=>{v("bracketMaxSets",B(r.target.value))}})})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"group-count",className:"block text-sm font-medium text-[var(--color-text)] mb-1",children:s("create.groupCountLabel")}),e.jsx(y,{id:"group-count",type:"number",min:"1",className:"w-24",...m("groupCount",{valueAsNumber:!0,onChange:r=>{P(r.target.value)}})})]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.qualifiersLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.map((r,c)=>e.jsxs(f,{className:"text-xs text-[var(--color-muted)]",children:[s("create.groupLabel",{label:re(c)}),e.jsx(y,{type:"number",min:"0",className:"mt-1 w-full h-8 px-2 py-1",...m(`qualifiers.${c}.value`,{valueAsNumber:!0})})]},r.id))})]}),e.jsxs(f,{className:"flex items-center gap-2 text-sm text-[var(--color-text)]",children:[e.jsx("input",{id:"consolation",type:"checkbox",...m("consolation")}),s("create.consolationLabel")]}),e.jsxs("div",{children:[e.jsx(M,{children:s("create.bracketTypeLabel")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:gap-3",children:Object.values(L).map(r=>e.jsxs("label",{className:`flex-1 text-center px-4 py-2 rounded-lg border text-sm cursor-pointer transition-colors ${g===r?"bg-[var(--color-primary)] text-[var(--color-surface)] border-[var(--color-primary)] shadow-sm":"text-[var(--color-muted)] border-[var(--color-border)] hover:border-[var(--color-primary)]"}`,children:[e.jsx("input",{type:"radio",value:r,className:"sr-only",...m("bracketType")}),s(r===L.SINGLE_ELIM?"create.bracketTypeSingle":"create.bracketTypeDouble")]},r))})]})]}),e.jsx(oe,{players:d,setPlayers:T,register:m,errors:N,setValue:v,useElo:_,onAddPlayer:()=>{G()}}),N.root&&e.jsx("p",{className:"text-[var(--color-accent)] text-sm",children:N.root.message}),e.jsx(j,{type:"submit",className:"w-full bg-[var(--color-primary)] text-[var(--color-surface)] py-3 rounded-lg font-medium shadow-sm hover:shadow-md hover:bg-[var(--color-primary-dark)] active:scale-[0.99]",children:s("create.submit")})]})]})};export{pe as CreateTournamentPage};
